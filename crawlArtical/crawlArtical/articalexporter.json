[
{"title": "可能是迄今为止最好的 GitHub 代码浏览插件", "creat_time": "2017-07-30", "praise_count": "1", "bookmark_count": 1, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.geeksense.cn/plugin/\">geeksense</a>   </div><p>【伯乐在线转注】：以前曾介绍过一个 Chrome 插件 <a href=\"http://t.cn/RPZJZfD\" target=\"_blank\">Octotree</a>。安装之后，浏览托管在 Github上的项目，可看到左侧的树形结构，更方便查看代码。今天这篇文章介绍另外一个同类插接。</p>\n<hr>\n<p>GitHub是很多开发者远(tong)程(xing)协(jiao)作(you)的重要工具，其社交化编码的理念伴随着开源运动改变着整个开发社区的生态，无数优质项目依托GitHub在全球开源开发者的参与下蓬勃发展。</p>\n<p><strong>不过，讲真，你有在GitHub上好好读过代码吗？</strong></p>\n<p>对于大部分人来说恐怕是没有，GitHub作为一款基于Git的代码管理工具和协同工具是很优秀的，然而作为代码浏览和搜索工具，就和IDE差的很远了。不然为什么到今天GitHub连个侧栏的文件树没有，很多开发者要专门去下载浏览器插件才能有文件树？为什么你还是需要git clone到本地在把代码装到你的IDE里才能愉快的阅读代码？是不是有想过如果能像IDE那样在GitHub上浏览代码多好？</p>\n<p>今天我们就来介绍一款Chrome浏览器插件Insight.io，让你能像在GitHub上像你的IDE里一样浏览和搜索代码，让你的Github就像穿上了钢铁侠的战衣。</p>\n<p><img id=\"pic\" class=\"\" src=\"http://wx2.sinaimg.cn/large/7cc829d3gy1fhzg5vidjjg20dq094wp8.gif\"></p>\n<h2 id=\"\">功能总览</h2>\n<p><a href=\"https://chrome.google.com/webstore/detail/insightio/pmhfgjjhhomfplgmbalncpcohgeijonh\">下载安装</a>后，打开一个GitHub上的项目，会看到左边有个侧边栏，是不是已经有了自己在IDE里面的感觉了？插件提供以下功能</p>\n<ul>\n<li><strong>跳转到定义</strong></li>\n<li><strong>查找引用</strong></li>\n<li><strong>目录树功能</strong></li>\n<li><strong>基于符号的代码搜索</strong></li>\n</ul>\n<p><img src=\"http://wx3.sinaimg.cn/large/7cc829d3gy1fhzg5waddog21410osb29.gif\" alt=\"Glance\"></p>\n<p> </p>\n<h2 id=\"\">交叉引用</h2>\n<p>用<a href=\"https://github.com/apache/spark\">Apache Spark</a>做例子，悬浮在某个节点(类，方法，变量等)上就可以看到相应的类型和文档说明。点击左边的结构(Structure)按钮就可以看到改文件的类结构，包括成员变量，成员函数等，点击也可以跳到相应的行。</p>\n<p><img src=\"http://wx3.sinaimg.cn/large/7cc829d3gy1fhzg5y5wqwg21400ot1l0.gif\" alt=\"Cross Reference\"></p>\n<h2 id=\"\">查找引用</h2>\n<p>点击任何节点的用例就能跳到这个类，方法或者变量定义的地方（类似于IDE中的Ctrl + click）。</p>\n<p>点击类，方法和变量的定义节点，则可以找出所有该节点的使用例子。其中使用例子又会以被引用(Referenced At), 继承 (Inherit), 被继承(Inherited By), 重写(Override)等类型进一步分类方便查找。如果结果太多，用例的右上方也会有支持regular expression的文本框可以用来过滤出感兴趣的文件。</p>\n<p><img src=\"http://wx3.sinaimg.cn/large/7cc829d3gy1fhzg5zayzeg21650q4kjn.gif\" alt=\"Find References\"></p>\n<h2 id=\"\">目录树</h2>\n<p>点击文件(File)按钮你会看到树状的目录结构，忘记GitHub上切换文件的痛苦吧，文件树让你轻松的在项目之内的文件中自如切换。</p>\n<p>对于私有项目需要点击下方的<strong>Sign In</strong>按钮并到insight.io上导入私有项目文件树才会生效。</p>\n<p><img src=\"http://wx4.sinaimg.cn/large/7cc829d3gy1fhzg60wyodg21420othdv.gif\" alt=\"Directory Tree\"></p>\n<h2 id=\"\">代码搜索</h2>\n<p>GitHub只支持纯文本搜索，这时常让搜索代码变得很困难，特别是当你想搜的关键词是常用词的时候，大量的无用结果会让搜索功能完全不可用。而是用Insight.io插件，点击搜索(Search)按钮可以按类名，方法名，变量名，文件名等等搜索代码，并且有自动补全功能。试试在Insight.io和GitHub原生搜索上搜一下RDD.map对比下搜索结果吧？</p>\n<p><img src=\"http://wx2.sinaimg.cn/large/7cc829d3gy1fhzg62hd81g21660q44qr.gif\" alt=\"Code Search\"></p>\n<h2 id=\"insightio\">跳转到Insight.io</h2>\n<p>你也可以一键点击跳转到Insight.io上获得更好的浏览体验。</p>\n<p><img src=\"http://wx2.sinaimg.cn/large/7cc829d3gy1fhzg645xmfg21410oru0y.gif\" alt=\"View on insight.io\"></p>\n<h2 id=\"insightio\">提交项目给Insight.io</h2>\n<p>Insight.io目前收录了2000多个最活跃的开源项目，包括<a href=\"https://github.com/apache/kafka\">Apache Kafka</a>, <a href=\"https://github.com/torvalds/linux\">Linux-kernel</a>这样的大型项目，也有像<a href=\"https://github.com/daimajia/AndroidSwipeLayout\">AndroidSwipeLayout</a>这样优质的个人项目。如果你需要的项目并未被我们收录，点击<strong>Information</strong>栏下的<strong>Request Analyze</strong>就可以提交你目前正在浏览的项目了。</p>\n<p><img src=\"http://wx3.sinaimg.cn/large/7cc829d3gy1fhzg65lh83g213y0oru0x.gif\" alt=\"Request Analyze\"></p>\n<h2 id=\"\">快捷键</h2>\n<p>用快捷键可以快速打开关闭插件功能:</p>\n<ul>\n<li><strong>文件树</strong>: <code>⌘+⇧+f</code></li>\n<li><strong>类结构</strong>: <code>⌘+⇧+o</code></li>\n<li><strong>信息</strong>: <code>⌘+⇧+i</code></li>\n<li><strong>搜索</strong>: <code>⌘+⇧+s</code></li>\n</ul>\n<hr>\n<p><a href=\"https://chrome.google.com/webstore/detail/insightio-for-github/pmhfgjjhhomfplgmbalncpcohgeijonh/\" target=\"_blank\">插件下载传送门</a></p>\n<p>目前插件支持的语言有Java, C/C++, Scala, Python和Ruby。想跟开发团队吐个槽或者点个赞？想知道最好的编程语言PHP什么时候支持？想知道怎么让公司代码库也能用上Insight.io？欢迎邮件到 support@insight.io 。想实时吐槽的也可以加入我们的gitter房间</p>\n<p><a href=\"https://gitter.im/Insight-io/Lobby\"><img title=\"\" src=\"https://badges.gitter.im/Insight-io/Lobby.png\" alt=\"Gitter chat\"></a></p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112011\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112011votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112011\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "post_url": "http://blog.jobbole.com/112011/", "tag_name": "工具与资源，Github", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2013/03/124.jpg"], "url_object_id": "5e8243d793df35a9502c06640a79ceee"},
{"title": "反转技术面试！还有这样的操作？", "creat_time": "2017-07-30", "praise_count": "3", "bookmark_count": 0, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/q4000052677\">听风</a> 翻译，<a href=\"http://www.jobbole.com/members/scbzyhx\">yhx</a> 校稿。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://aphyr.com/posts/340-acing-the-technical-interview\">Kyle Kingsbury</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p><span style=\"color: #339966\">假想面试的时候用 Clojure 做题，狠狠地鄙视了一下不懂 Clojure、且高傲无知的面试官，然后潇洒地离去。</span></p>\n<hr>\n<p>如果你打算找一份程序员的工作，那么你必须要通过白板面试。 作为工程师，模拟白板面试也经常是我们早上例行公事的一部分，同时还需要在星光层（astral plane）上打开一个漂亮的网格状的 xterms 窗口，并且在每个邻近的目录中不由自主地运行 ls 命令，以防事情在昨晚有什么变化。</p>\n<p>这不亚于在厨房后面的那个抽屉里，搞一次天翻地覆地搜查。而那个抽屉里存放着各种各样的法兰盘、螺丝刀和从各种家用电器上掉下来多年的各种配饰或零件。现在谁也不知道这些东西原来是做什么用的，或许从来就没知道过，尽管如此，我们还必须小心翼翼的对待它们。</p>\n<p>下面我将通过一个常见的面试题，向你演示一下白板面试：反转链表。</p>\n<p>首先，我们需要一个链表。清除 xterms 中不需要的工作区，然后在两个括号的作用域中写上必要的元素和通配符。这样我们就从无到有创建出了一个链表。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-597dbc33782cf672465192\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Clojure</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n(defn cons [h t] #(if % h t))</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-597dbc33782cf672465192-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-597dbc33782cf672465192-1\"><span class=\"crayon-o\">(</span><span class=\"crayon-st\">defn</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">cons</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">h</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">t</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">#</span><span class=\"crayon-o\">(</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">h</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">t</span><span class=\"crayon-o\">)</span><span class=\"crayon-o\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>“那不是一个链表，那只是一条 if 语句。”面试官说。</p>\n<p>“ 这不就是一个另类点的链表吗？”你回答到，同时翻了一个白眼。</p>\n<p><img class=\"aligncenter\" src=\"http://wx2.sinaimg.cn/mw690/63918611gy1fhqlozoo7jg208c08adx1.gif\" width=\"300\" height=\"298\"></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-597dbc33782d8648656085\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Clojure</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nuser=&gt; (def x (cons 1 (cons 2 nil)))\r\n#'user/x\r\nuser=&gt; (x true)\r\n1\r\nuser=&gt; ((x false) true)\r\n2</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-597dbc33782d8648656085-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597dbc33782d8648656085-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-597dbc33782d8648656085-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597dbc33782d8648656085-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-597dbc33782d8648656085-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597dbc33782d8648656085-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-597dbc33782d8648656085-1\"><span class=\"crayon-i\">user</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">(</span><span class=\"crayon-st\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">(</span><span class=\"crayon-st\">cons</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">(</span><span class=\"crayon-st\">cons</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">nil</span><span class=\"crayon-o\">)</span><span class=\"crayon-o\">)</span><span class=\"crayon-o\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597dbc33782d8648656085-2\"><span class=\"crayon-o\">#</span>'<span class=\"crayon-i\">user</span><span class=\"crayon-st\">/</span><span class=\"crayon-i\">x</span></div><div class=\"crayon-line\" id=\"crayon-597dbc33782d8648656085-3\"><span class=\"crayon-i\">user</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">(</span><span class=\"crayon-k\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">true</span><span class=\"crayon-o\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597dbc33782d8648656085-4\"><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-597dbc33782d8648656085-5\"><span class=\"crayon-i\">user</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">(</span><span class=\"crayon-o\">(</span><span class=\"crayon-k\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">false</span><span class=\"crayon-o\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">true</span><span class=\"crayon-o\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597dbc33782d8648656085-6\"><span class=\"crayon-cn\">2</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0015 seconds] -->\r\n<p>“x 到底是什么？”面试官尽量让自己看些来友善些。答案就在 REPL，但不要被它一时误导了，它们可不是你的朋友。你在前台的“誓言”，不允许你使用它。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-597dbc33782dd506453000\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Clojure</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nuser=&gt; x\r\n#object[user$cons$cell__4431 0x3b89cc1c \"user$cons$cell__4431@3b89cc1c\"]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-597dbc33782dd506453000-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597dbc33782dd506453000-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-597dbc33782dd506453000-1\"><span class=\"crayon-i\">user</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">x</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597dbc33782dd506453000-2\"><span class=\"crayon-o\">#</span><span class=\"crayon-i\">object</span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">user</span><span class=\"crayon-sy\">$</span><span class=\"crayon-st\">cons</span><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">cell</span><span class=\"crayon-sy\">_</span><span class=\"crayon-sy\">_</span>4431<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0x3b89cc1c</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"user$cons$cell__4431@3b89cc1c\"</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>“了解一个事物最好的方式，就是对它命名。”你回答到。恰当的名字具备魔力。由 Ursula K. Le Guin 发明的 K 语言是最古老和最精练的形式语言之一。一旦你使用某个字符对程序进行自定义命名，意味着你将不能再使用这个字符元素。 你自定义的缩写名称会记录在程序的内存中。</p>\n<p>“呃，好吧，你怎么从这个链表里面取出一个元素呢？” 面试官又问。</p>\n<p><img class=\"aligncenter\" src=\"http://wx4.sinaimg.cn/mw690/63918611gy1fhqls12mmhj20dw07hn4u.jpg\" width=\"500\" height=\"269\"></p>\n<p>那些巧妙的表达式在你脑海中逐一呈现，仿佛红地毯在你光着的双脚下慢慢展开； 犹如昨晚观看奥斯卡颁奖典礼时，你憧憬着不同的明星来亲吻你；又好像你住在瑟略岛（Sørøya ）山脉之上，月亮就是你的爱人。 除了边界检查，你在第一时间写出了正确的代码：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-597dbc33782e1187967929\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Clojure</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n(defn nth [l n]\r\n  (when l (if (= 0 n)\r\n            (l true)\r\n            (recur (l false) (dec n)))))</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-597dbc33782e1187967929-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597dbc33782e1187967929-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-597dbc33782e1187967929-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597dbc33782e1187967929-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-597dbc33782e1187967929-1\"><span class=\"crayon-o\">(</span><span class=\"crayon-st\">defn</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">nth</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">n</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597dbc33782e1187967929-2\"><span class=\"crayon-h\">  </span><span class=\"crayon-o\">(</span><span class=\"crayon-st\">when</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">(</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">(</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">n</span><span class=\"crayon-o\">)</span></div><div class=\"crayon-line\" id=\"crayon-597dbc33782e1187967929-3\"><span class=\"crayon-h\">            </span><span class=\"crayon-o\">(</span><span class=\"crayon-k\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">true</span><span class=\"crayon-o\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597dbc33782e1187967929-4\"><span class=\"crayon-h\">            </span><span class=\"crayon-o\">(</span><span class=\"crayon-st\">recur</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">(</span><span class=\"crayon-k\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">false</span><span class=\"crayon-o\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">(</span><span class=\"crayon-st\">dec</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">n</span><span class=\"crayon-o\">)</span><span class=\"crayon-o\">)</span><span class=\"crayon-o\">)</span><span class=\"crayon-o\">)</span><span class=\"crayon-o\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0014 seconds] -->\r\n<p>“你能不能给我写一个正常的链表吗？就像 Python 中的那样？”</p>\n<p>你咬紧牙关，气愤地在地板上直跺脚，但还是写了一个排版良好的打印函数。 此刻，你的手掌仿佛充满了老茧，你的眼皮仿佛沾满了冰霜、以及烟灰黑色的雪花。 每个函数都是要付出代价的，当然，除非它是无副作用的纯函数。</p>\n<p><img id=\"pic\" class=\"aligncenter\" src=\"http://wx4.sinaimg.cn/large/63918611gy1fhqlxfkc84j20b408cq2z.jpg\"></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-597dbc33782e4085866938\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Clojure</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n(defn prn-list [l]\r\n  (print \"(\")\r\n  (loop [l l]\r\n    (if (nil? l)\r\n      (print \")n\")\r\n      (do (print (l true))\r\n          (when (l false)\r\n            (print \" \"))\r\n          (recur (l false))))))</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-597dbc33782e4085866938-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597dbc33782e4085866938-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-597dbc33782e4085866938-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597dbc33782e4085866938-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-597dbc33782e4085866938-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597dbc33782e4085866938-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-597dbc33782e4085866938-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597dbc33782e4085866938-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-597dbc33782e4085866938-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-597dbc33782e4085866938-1\"><span class=\"crayon-o\">(</span><span class=\"crayon-st\">defn</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">prn</span><span class=\"crayon-st\">-</span><span class=\"crayon-st\">list</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">l</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597dbc33782e4085866938-2\"><span class=\"crayon-h\">  </span><span class=\"crayon-o\">(</span><span class=\"crayon-st\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"(\"</span><span class=\"crayon-o\">)</span></div><div class=\"crayon-line\" id=\"crayon-597dbc33782e4085866938-3\"><span class=\"crayon-h\">  </span><span class=\"crayon-o\">(</span><span class=\"crayon-st\">loop</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">l</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597dbc33782e4085866938-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">(</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">(</span><span class=\"crayon-k\">nil</span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">l</span><span class=\"crayon-o\">)</span></div><div class=\"crayon-line\" id=\"crayon-597dbc33782e4085866938-5\"><span class=\"crayon-h\">      </span><span class=\"crayon-o\">(</span><span class=\"crayon-st\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\")n\"</span><span class=\"crayon-o\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597dbc33782e4085866938-6\"><span class=\"crayon-h\">      </span><span class=\"crayon-o\">(</span><span class=\"crayon-st\">do</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">(</span><span class=\"crayon-st\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">(</span><span class=\"crayon-k\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">true</span><span class=\"crayon-o\">)</span><span class=\"crayon-o\">)</span></div><div class=\"crayon-line\" id=\"crayon-597dbc33782e4085866938-7\"><span class=\"crayon-h\">          </span><span class=\"crayon-o\">(</span><span class=\"crayon-st\">when</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">(</span><span class=\"crayon-k\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">false</span><span class=\"crayon-o\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597dbc33782e4085866938-8\"><span class=\"crayon-h\">            </span><span class=\"crayon-o\">(</span><span class=\"crayon-st\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\" \"</span><span class=\"crayon-o\">)</span><span class=\"crayon-o\">)</span></div><div class=\"crayon-line\" id=\"crayon-597dbc33782e4085866938-9\"><span class=\"crayon-h\">          </span><span class=\"crayon-o\">(</span><span class=\"crayon-st\">recur</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">(</span><span class=\"crayon-k\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">false</span><span class=\"crayon-o\">)</span><span class=\"crayon-o\">)</span><span class=\"crayon-o\">)</span><span class=\"crayon-o\">)</span><span class=\"crayon-o\">)</span><span class=\"crayon-o\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0020 seconds] -->\r\n<p>白板面试时根本没有多余的时间去描述变量、写示例或文档注释。在白板面试中，时间就是一切。你就假装你是一名 Haskell 程序员，正当着你奶奶的面继续完成下面的代码。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-597dbc33782e8016066897\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Clojure</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nuser=&gt; (prn-list (cons 1 (cons 2 (cons 3 nil))))\r\n(1 2 3)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-597dbc33782e8016066897-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597dbc33782e8016066897-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-597dbc33782e8016066897-1\"><span class=\"crayon-i\">user</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">(</span><span class=\"crayon-st\">prn</span><span class=\"crayon-st\">-</span><span class=\"crayon-st\">list</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">(</span><span class=\"crayon-st\">cons</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">(</span><span class=\"crayon-st\">cons</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">(</span><span class=\"crayon-st\">cons</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">nil</span><span class=\"crayon-o\">)</span><span class=\"crayon-o\">)</span><span class=\"crayon-o\">)</span><span class=\"crayon-o\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597dbc33782e8016066897-2\"><span class=\"crayon-o\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-o\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p>面试官笑了，安心了。 至少此时，代码输出的链表仍是正序的。“那么，要反转这个链表，你需要……”</p>\n<p>你抓住了他的手，然后在白板上写代码，那感觉就像在用古老的语言吟诵诗句。而此时此刻，他的大脑却一片混乱，好像松了发条的疯狂乱撞的钟，又仿佛心脏上爬过绦虫，砰砰直跳的心脏恨不得逃出胸腔。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-597dbc33782eb069210918\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Clojure</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n(defn reverse [l]\r\n  (loop [r nil, l l]\r\n    (if l\r\n      (recur (cons (l true) r) (l false))\r\n      r)))\r\n\r\nuser=&gt; (prn-list (reverse (cons 1 (cons 2 (cons 3 nil)))))\r\n(3 2 1)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-597dbc33782eb069210918-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597dbc33782eb069210918-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-597dbc33782eb069210918-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597dbc33782eb069210918-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-597dbc33782eb069210918-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597dbc33782eb069210918-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-597dbc33782eb069210918-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597dbc33782eb069210918-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-597dbc33782eb069210918-1\"><span class=\"crayon-o\">(</span><span class=\"crayon-st\">defn</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">reverse</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">l</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597dbc33782eb069210918-2\"><span class=\"crayon-h\">  </span><span class=\"crayon-o\">(</span><span class=\"crayon-st\">loop</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">r</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">nil</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">l</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-597dbc33782eb069210918-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">(</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">l</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597dbc33782eb069210918-4\"><span class=\"crayon-h\">      </span><span class=\"crayon-o\">(</span><span class=\"crayon-st\">recur</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">(</span><span class=\"crayon-st\">cons</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">(</span><span class=\"crayon-k\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">true</span><span class=\"crayon-o\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">r</span><span class=\"crayon-o\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">(</span><span class=\"crayon-k\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">false</span><span class=\"crayon-o\">)</span><span class=\"crayon-o\">)</span></div><div class=\"crayon-line\" id=\"crayon-597dbc33782eb069210918-5\"><span class=\"crayon-h\">      </span><span class=\"crayon-i\">r</span><span class=\"crayon-o\">)</span><span class=\"crayon-o\">)</span><span class=\"crayon-o\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597dbc33782eb069210918-6\"> </div><div class=\"crayon-line\" id=\"crayon-597dbc33782eb069210918-7\"><span class=\"crayon-i\">user</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">(</span><span class=\"crayon-st\">prn</span><span class=\"crayon-st\">-</span><span class=\"crayon-st\">list</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">(</span><span class=\"crayon-st\">reverse</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">(</span><span class=\"crayon-st\">cons</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">(</span><span class=\"crayon-st\">cons</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">(</span><span class=\"crayon-st\">cons</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">nil</span><span class=\"crayon-o\">)</span><span class=\"crayon-o\">)</span><span class=\"crayon-o\">)</span><span class=\"crayon-o\">)</span><span class=\"crayon-o\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597dbc33782eb069210918-8\"><span class=\"crayon-o\">(</span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0024 seconds] -->\r\n<p>当你松开他的手时，他结结巴巴地说了些有礼貌的话，然后把连帽衫的拉链拉上假装以抵御寒冷。这里将会有其它的面试会议，但你已经不需要参加了。他用锐利的眼光朝你所在的地方看了一眼。</p>\n<p>当然，他们会拒绝你，并且总是装着极其难为情地说，你不符合他们的公司文化。乘风归去吧。此地不属于你。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111889\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111889votetotal\">3</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111889\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/q4000052677\">听风</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/q4000052677\">\r\n\t\t\t<img src=\"http://q.qlogo.cn/qqapp/208656/9538B04AD8C6883F49C38BC8ECDDAF3C/100\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            简介还没来得及写 :）        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/q4000052677\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/q4000052677/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/q4000052677/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 22</a>        </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "post_url": "http://blog.jobbole.com/111889/", "tag_name": "职场，技术面试，职场", "front_image_url": ["http://wx4.sinaimg.cn/mw690/63918611gy1fhqls12mmhj20dw07hn4u.jpg"], "url_object_id": "25cdb73013451e3d2f61f6cc3d6759e7"},
{"title": "程序员之间的 N 层鄙视网", "creat_time": "2017-07-30", "praise_count": "7", "bookmark_count": 4, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"\">CatchShot</a>   </div><p>有人的地方就有江湖。程序员，是一个知识、智商、都异于常规行业的群体。自傲，清高，闷骚，也属于这个群体鲜明标签。</p>\n<p>程序员有时候很自我，这样就给自己一个盲目的优越感。特别在与其他程序员对比的时候，他总能找到在一两个地方优于你的地方，所以，程序员之间的鄙视网络，在程序员这个职位诞生之日起，就慢慢的形成了。</p>\n<p>时至今日，这张鄙视网络已经相当的庞大。互联网的江湖中，有好事者开始归纳这张网，现在我们就来看看这张日益巨大的鄙视网。</p>\n<p><img title=\"图0：程序员之间的十八层鄙视网络\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/5042be614d564104e6abff9d60b74424.jpg\" alt=\"图0：程序员之间的十八层鄙视网络\"></p>\n<p><img title=\"图1：程序员之间的十八层鄙视网络\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/9be03e45f9c9394775c39ea3dcb081f5.jpg\" alt=\"图1：程序员之间的十八层鄙视网络\"></p>\n<p><img title=\"图2：程序员之间的十八层鄙视网络\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/480754675738b67ad7ae3e2949393d5d.jpg\" alt=\"图2：程序员之间的十八层鄙视网络\"></p>\n<p><img title=\"图3：程序员之间的十八层鄙视网络\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/f39623c25fb96e5c33838562ca979955.jpg\" alt=\"图3：程序员之间的十八层鄙视网络\"></p>\n<p><img class=\"alignnone\" src=\"http://wx4.sinaimg.cn/mw690/7cc829d3gy1fhrbemwgsij20go07mmxn.jpg\" width=\"600\" height=\"274\"></p>\n<p><img title=\"图5：程序员之间的十八层鄙视网络\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/f71f261ee07d4ae68811ba8984c5bbca.jpg\" alt=\"图5：程序员之间的十八层鄙视网络\"></p>\n<p><img title=\"图6：程序员之间的十八层鄙视网络\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/4b6d9bfeaa47d08e5a6c831b61f5126d.jpg\" alt=\"图6：程序员之间的十八层鄙视网络\"></p>\n<p><img title=\"图7：程序员之间的十八层鄙视网络\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/557f1fc15a91cb3b642e8a0067d68802.jpg\" alt=\"图7：程序员之间的十八层鄙视网络\"></p>\n<p><img title=\"图8：程序员之间的十八层鄙视网络\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/e47d0b440956c2e60401fe7cf04c1a8a.jpg\" alt=\"图8：程序员之间的十八层鄙视网络\"></p>\n<p><img title=\"图9：程序员之间的十八层鄙视网络\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/bbb4da59f1ef5e2df8fac5c9dcb91038.jpg\" alt=\"图9：程序员之间的十八层鄙视网络\"></p>\n<p><img title=\"图10：程序员之间的十八层鄙视网络\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/d2533f84335c10e36bf8e52e7ae434ad.jpg\" alt=\"图10：程序员之间的十八层鄙视网络\"></p>\n<p><img title=\"图11：程序员之间的十八层鄙视网络\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/6f24fa523abd09103d082d8dff7077f1.jpg\" alt=\"图11：程序员之间的十八层鄙视网络\"></p>\n<p><img title=\"图12：程序员之间的十八层鄙视网络\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/1c58fb20f86d4337ea5f0489abcc18e7.jpg\" alt=\"图12：程序员之间的十八层鄙视网络\"></p>\n<p><img title=\"图13：程序员之间的十八层鄙视网络\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/88db446e732da4c31c3cae98f6979b6e.jpg\" alt=\"图13：程序员之间的十八层鄙视网络\"></p>\n<p><img title=\"图14：程序员之间的十八层鄙视网络\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/f17aa010b0dd6196521546234e547b02.jpg\" alt=\"图14：程序员之间的十八层鄙视网络\"></p>\n<p><img title=\"图15：程序员之间的十八层鄙视网络\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/29c576dcbe282cd302f17dec6c25b098.jpg\" alt=\"图15：程序员之间的十八层鄙视网络\"></p>\n<p><img title=\"图16：程序员之间的十八层鄙视网络\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/5c1f66baed364a4b698298630753b458.jpg\" alt=\"图16：程序员之间的十八层鄙视网络\"></p>\n<p>时代在发展，技术也在发展，唯一不变的，是人与人之间的江湖，程序员们，将这种江湖诙谐的发展了下去，期待以后更多层的程序员鄙视网。</p>\n<p> </p>\n<p style=\"text-align: center\">—【分隔线】—</p>\n<p>【伯乐在线 补充】：① 尽管原文没有说明改编来源，但应该是改编自一位台湾博主的文章《<a href=\"http://mp.weixin.qq.com/s?__biz=MjM5OTA1MDUyMA==&amp;mid=405595221&amp;idx=1&amp;sn=357da8e3285f4dc82cdd8721a2bf5d6c&amp;scene=21#wechat_redirect\" target=\"_blank\">软件工程师的鄙视链</a>》。</p>\n<p>② 不过这篇图文貌似忘了还有一种鄙视链：</p>\n<p><strong><img class=\"alignnone size-full wp-image-111981\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/d0d02c341e4dcd8dfdfffcb1b37b9e11.png\" alt=\"Screenshot 2017-07-21_17-30-14\"></strong></p>\n<p> </p>\n<p> </p>\n<p><strong><img class=\"alignnone size-full wp-image-111980\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/f7e1de78dfd636859fdae27cbe176a35.png\" alt=\"8472-1F630105T9\"></strong></p>\n<p><strong>扎心了么？</strong></p>\n<p>不用心痛，我们老早就发起了<a href=\"http://date.jobbole.com/4164/\" target=\"_blank\">「面向对象」征友活动</a>。除了发单身妹子，现在也可以发男生啦。</p>\n<p style=\"text-align: center\"><strong>关注底下<strong>的</strong>面向对象微信公号</strong><br>\n关注后发送  <strong>案例</strong>  看脱单案例</p>\n<p><img class=\"alignnone aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2015/02/5d683ab1ce9e4dd6d3e0ffb190c19ddd.jpg\" width=\"133\" height=\"136\"></p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111968\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111968votetotal\">7</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111968\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 4 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 12 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "post_url": "http://blog.jobbole.com/111968/", "tag_name": "趣文小说，程序员，趣文", "front_image_url": ["http://wx4.sinaimg.cn/mw690/7cc829d3gy1fhrc09kvxmj20d4076mx9.jpg"], "url_object_id": "9707cd355560fc32276fe92a578ac3ad"},
{"title": "避免持续集成（CI）成为一个安全隐患", "creat_time": "2017-07-30", "praise_count": "1", "bookmark_count": 1, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文作者： <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/thoughtworkschina\">ThoughtWorks</a> 。未经作者许可，禁止转载！<br>欢迎加入伯乐在线 <a href=\"http://blog.jobbole.com/99322\" target=\"_blank\">专栏作者</a>。</div><div>\n<h3>背景</h3>\n<p>最近临时交接了一个客户测试环境和产品环境的维护工作。交接的客户资产包含：代码库、生产环境主机、测试环境主机、搭建在测试环境主机上的持续集成服务器以及对应的账号密码。这个持续集成服务器采用Jenkins搭建，并且可以用来部署测试环境和生产环境的应用。</p>\n<p>不久，接到了客户的一个维护请求：把最新的生产环境数据同步到测试环境里。</p>\n<p><a href=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/07/1-Jenkins.jpg\"><img src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/07/1-Jenkins.jpg\" alt=\"\" width=\"940\" height=\"556\"></a></p>\n<p>这个维护任务需要通过SSH登录到测试环境主机上进行操作。测试主机是通过authorized_keys进行SSH认证的，只要你自己的ssh-key被添加到了主机上，就可以实现无密码登录。这样有两个好处：一方面维护人员无需使用密码，避免了生产环境密码的泄露。另一方面可以按需吊销不再使用的客户端，及时回收权限。所以我需要把自己的sshpublickey交给管理员，让他把我的key加到可访问列表里。</p>\n<p>悲剧的是，前管理员告诉我，他的key因为更换电脑的关系没有及时更新。所以，他也无法登录主机。而且之前参与维护的其它管理员的key也都失效了，这意味着我们失去了对主机的控制。此时，我手上只有登录Jenkins的的用户名和密码，于是一个邪恶的想法就诞生了：</p>\n<p><strong>既然Jenkins可以执行脚本，那么我是否可以通过Jenkins把我的key注入进去？</strong></p>\n<p><a href=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/07/2-sshpublickey.jpg\"><img src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/07/2-sshpublickey-1024x620.jpg\" alt=\"\" width=\"700\" height=\"424\"></a></p>\n<p>于是我把ExecuteShell的Job变成了我的命令行，通过运行日志得知了宿主用户的文件目录信息。然后把自己的sshpublickey加到了登录列表里（此处省略敏感信息）：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-597d9031db369218126908\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsudo sh -c“cp~/.ssh/authorized_keys~/.ssh/authorized_keys.bak”\r\n\r\nsudo sh -c\"echo‘{我的sshpublickey}’&gt;&gt;~/.ssh/authorized_keys\"\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-597d9031db369218126908-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597d9031db369218126908-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-597d9031db369218126908-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597d9031db369218126908-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-597d9031db369218126908-1\"><span class=\"crayon-e\">sudo </span><span class=\"crayon-v\">sh</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">c</span>“<span class=\"crayon-v\">cp</span><span class=\"crayon-o\">~</span><span class=\"crayon-o\">/</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">ssh</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">authorized_keys</span><span class=\"crayon-o\">~</span><span class=\"crayon-o\">/</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">ssh</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">authorized_keys</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">bak</span>”</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597d9031db369218126908-2\"> </div><div class=\"crayon-line\" id=\"crayon-597d9031db369218126908-3\"><span class=\"crayon-e\">sudo </span><span class=\"crayon-v\">sh</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">c</span><span class=\"crayon-s\">\"echo‘{我的sshpublickey}’&gt;&gt;~/.ssh/authorized_keys\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597d9031db369218126908-4\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>It works !</p>\n<p>我成功的登录了机器，但这却暴露了一个问题：持续集成服务器成为了一个安全隐患。</p>\n<p><strong>首先</strong>，持续集成服务器可以执行代码。这就意味着它有可能执行有害代码。</p>\n<p><strong>其次</strong>，持续集成服务器缺乏足够的用户鉴权，这很有可能导致未授权用户访问。</p>\n<p>无权限控制的服务器+可以执行代码=裸奔的肉鸡</p>\n<p>那么，如何构建一个更安全的持续集成服务器服务器？</p>\n<h3>rootless原则</h3>\n<blockquote><p>“神操纵着万物，你感觉得到他，但永远看不见他。”——《圣经·希伯来书11:27》</p></blockquote>\n<p>在服务器的世界里，root用户就是神，拥有至高的权力和力量。如果有人获得了“神之力”，后果可能不堪设想。</p>\n<p><a href=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/07/3-inconceivable.jpg\"><img src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/07/3-inconceivable-1024x574.jpg\" alt=\"\" width=\"700\" height=\"392\"></a></p>\n<p>无论是Web服务器、数据库服务器还是持续集成服务器。都是这个世界里的二等公民，权限和力量都应该受到约束。执行的时候应该受到控制。</p>\n<p>此外，应该极力避免sudo的滥用，尤其是对那些从外部访问的用户。很多情况下，为了操作方便，很多用户都有sudo的权限。但这恰恰造成了低权限用户通过提升自己的访问权限进行有害操作。</p>\n<p>在上述的故事里，因为没有对Jenkins的主机用户做有效隔离，导致了我可以用sudo注入自己的key获得机器的访问权限。</p>\n<h3>沙盒隔离原则</h3>\n<p>因为持续集成服务器会执行脚本或运行程序，而这些程序和脚本有可能是存在恶意代码的。所以，对应的任务应该在隔离的安全沙盒中执行，例如：受限的用户，受限的权限，受限的空间。</p>\n<p>在上述的故事里，我就通过CI执行了一段不安全的脚本成功获得了登录主机的权限。</p>\n<p>如果这些任务在隔离并受控的Docker容器里执行，那么会安全得多。</p>\n<p>当然，也可以考虑采用TravisCI这样的第三方持续集成服务来保证安全性。</p>\n<h3>备份和备份核查原则</h3>\n<p>在上述故事里，因为缺乏有效的备份机制，导致了所有人都无法访问主机。此外，我在修改authorized_keys的时候先进行了备份。这样，如果我注入失败，还可以还原。</p>\n<p><a href=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/07/4-authorized_keys.jpg\"><img src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/07/4-authorized_keys-1024x610.jpg\" alt=\"\" width=\"700\" height=\"417\"></a></p>\n<p>这里的备份，不光是对配置、数据的备份，还有岗位的备份。</p>\n<p>如果管理员有备份，完全不会出现无法登陆的事情。</p>\n<p>如果有备份QA服务器，完全可以不需要当前的QA服务器。</p>\n<p>在做任何变更前，都应该做好备份以及还原的准备。因为任何变更都会带来“蝴蝶效应”。</p>\n<p>但是，光备份是不够的。如果备份不能有效还原，那和没有备份没有什么区别。所以，要定时的进行备份恢复测试。确保备份在各种情况下可用。</p>\n<h3>多重要素身份验证原则</h3>\n<p>上述的持续集成服务器是暴露在互联网中的，任何一个人访问到这个站点，通过一定程度的密码破解，就可以获得这个持续集成服务器的访问控制权限。从而可以做出上述的操作。</p>\n<p>所以，有了用户名和密码，并不一定是可信用户。还需要通过更多的手段，诸如手机短信验证码或者第三方认证集成来验证用户的身份。</p>\n<h3>关键操作手动验证原则</h3>\n<p>试想一下，如果在上述的例子中我并没有服务器的访问权限。而是通过提交未经审查的代码自动运行测试脚本。实际上也会造成同样的效果。</p>\n<p>有时候我们会为了方便，让持续集成服务器自动触发测试。但是，恰恰是这种“方便”带来了额外的安全隐患。而这样的方便，不光方便了自己，也方便了恶意入侵者。</p>\n<p>所以，不能为了方便而留下安全隐患。在关键操作上设置为手动操作，并通过一定机制保证关键操作的可靠性才是最佳实践。</p>\n<p><a href=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/07/5-reliability-1.jpg\"><img src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/07/5-reliability-1-1024x627.jpg\" alt=\"\" width=\"700\" height=\"429\"></a></p>\n<h3>构建安全<strong>CI</strong>的几个实践：</h3>\n<p>采用<a href=\"https://jpetazzo.github.io/2015/09/03/do-not-use-docker-in-docker-for-ci/\">Sibling</a>的方式在Docker里运行任务。</p>\n<p>账户密码管理统一采用LDAP认证，如果过期则从外部修改。</p>\n<p>CI的登录权限和其它的认证方式（比如GitHub、Okta等）集成起来。并用组限制登录。</p>\n<p>对于生产环境的CI，通过更加细粒度的权限限制来隔离一些危险操作。</p>\n<h3>官方的安全指南</h3>\n<p>不少持续集成工具的官方都提供了最佳实践以及安全指南帮助我们构建持续集成服务器。请务必在构建持续集成服务器前阅读并理解这些安全实践和措施，并遵照安全最佳实践构建持续集成服务器：</p>\n<p><strong>Jenkins最佳实践：</strong><a href=\"https://wiki.jenkins-ci.org/display/JENKINS/Jenkins+Best+Practices\">https://wiki.jenkins-ci.org/display/JENKINS/Jenkins+Best+Practices</a></p>\n<p><strong>Jenkins官方安全指南：</strong><a href=\"https://wiki.jenkins-ci.org/display/JENKINS/Securing+Jenkins\">https://wiki.jenkins-ci.org/display/JENKINS/Securing+Jenkins</a></p>\n<h3>如果没有这些如果</h3>\n<p>上面提到了太多的如果。如果这些“如果”能发生在事前，这些问题就不会产生。持续集成本身是开发的最佳</p>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111988\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111988votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111988\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/thoughtworkschina\">ThoughtWorks</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/thoughtworkschina\">\r\n\t\t\t<img src=\"http://tp3.sinaimg.cn/1774908135/180/0/1\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            ThoughtWorks是一家全球IT咨询公司，追求卓越软件质量，致力于科技驱动商业变革。擅长构建定制化软件产品，帮助客户快速将概念转化为价值。同时为客户提供用户体验设计、技术战略咨询、组织转型等咨询服务。        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/thoughtworkschina\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/thoughtworkschina/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/thoughtworkschina/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 62</a> · <a title=\"我的网站\" target=\"_blank\" href=\"http://insights.thoughtworkers.org/\"><i class=\"fa fa-link\"></i></a> <a title=\"微博主页\" target=\"_blank\" href=\"http://weibo.com/thoughtworkschina\"><i class=\"fa fa-weibo\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "post_url": "http://blog.jobbole.com/111988/", "tag_name": "IT技术，安全，持续集成", "front_image_url": ["http://insights.thoughtworkers.org/wp-content/uploads/2017/07/1-Jenkins.jpg"], "url_object_id": "c81dc3f7bed223d8482970ff37b9fbd5"},
{"title": "数据库压缩技术探索", "creat_time": "2017-07-30", "praise_count": "1", "bookmark_count": 1, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.iteye.com/news/32473\">首发《程序员》杂志</a>   </div><div>\n<blockquote>作者：雷鹏，Terark核心技术发明人。曾就职奇虎360，负责搜索引擎核心研发；曾就职Yahoo！北研所负责搜索广告、广告交易（AdExchange）等项目。在数据库、高性能计算、分布式、系统架构上都深有造诣。</blockquote>\n</div>\n<p>作为数据库，在系统资源（CPU、内存、SSD、磁盘等）一定的前提下，我们希望：</p>\n<ul>\n<li><strong>存储的数据更多：</strong>采用压缩，这个世界上有各种各样的压缩算法；</li>\n<li><strong>访问的速度更快：</strong>更快的压缩（写）/解压（读）算法、更大的缓存。</li>\n</ul>\n<p>几乎所有压缩算法都严重依赖上下文：</p>\n<ul>\n<li>位置相邻的数据，一般情况下相关性更高，内在冗余度更大；</li>\n<li>上下文越大，压缩率的上限越大（有极限值）。</li>\n</ul>\n<p><strong>块压缩</strong></p>\n<p><strong>传统数据库中的块压缩技术</strong></p>\n<p>对于普通的以数据块/文件为单位的压缩，传统的（流式）数据压缩算法工作得不错，时间长了，大家也都习惯了这种数据压缩的模式。基于这种模式的数据压缩算法层出不穷，不断有新的算法实现。包括使用最广泛的gzip、bzip2、Google的Snappy、新秀Zstd等。</p>\n<ul>\n<li>gzip几乎在在所有平台上都有支持，并且也已经成为一个行业标准，压缩率、压缩速度、解压速度都比较均衡；</li>\n<li>bzip2是基于BWT变换的一种压缩，本质是上对输入分块，每个块单独压缩，优点是压缩率很高，但压缩和解压速度都比较慢；</li>\n<li>Snappy是Google出品，优点是压缩和解压都很快，缺点是压缩率比较低，适用于对压缩率要求不高的实时压缩场景；</li>\n<li>LZ4是Snappy一个强有力的竞争对手，速度比Snappy更快，特别是解压速度；</li>\n<li>Zstd是一个压缩新秀，压缩率比LZ4和Snappy都高不少，压缩和解压速度略低；相比gzip，压缩率不相上下，但压缩/解压速度要高很多。</li>\n</ul>\n<p>对于数据库，在计算机世界的太古代，为I/O优化的Btree一直是不可撼动的，为磁盘优化的Btree block/page size比较大，正好让传统数据压缩算法能得到较大的上下文，于是，基于block/page的压缩也就自然而然地应用到了各种数据库中。在这个蛮荒时代，内存的性能、容量与磁盘的性能、容量泾渭分明，各种应用对性能的需求也比较小，大家都相安无事。</p>\n<p>现在，我们有了SSD、PCIe SSD、3D XPoint等，内存也越来越大，块压缩的缺点也日益突出：</p>\n<ul>\n<li>块选小了，压缩率不够；块选大了，性能没法忍；</li>\n<li>更致命的是，块压缩节省的只是更大更便宜的磁盘、SSD；</li>\n<li>更贵更小的内存不但没有节省，反而更浪费了（双缓存问题）。</li>\n</ul>\n<p>于是，对于很多实时性要求较高的应用，只能关闭压缩。</p>\n<p><strong>块压缩的原理</strong></p>\n<p>使用通用压缩技术（Snappy、LZ4、zip、bzip2、Zstd等），按块/页（block/page）进行压缩（块尺寸通常是4KB~32KB，以压缩率著称的TokuDB块尺寸是2MB~4MB），这个块是逻辑块，而不是内存分页、块设备概念中的那种物理块。</p>\n<p>启用压缩时，随之而来的是访问速度下降，这是因为：</p>\n<ul>\n<li>写入时，很多条记录被打包在一起压缩成一个个的块，增大块尺寸，压缩算法可以获得更大的上下文，从而提高压缩率；相反地，减小块尺寸，会降低压缩率。</li>\n<li>读取时，即便是读取很短的数据，也需要先把整个块解压，再去读取解压后的数据。这样，块尺寸越大，同一个块内包含的记录数目越多。为读取一条数据，所做的不必要解压就也就越多，性能也就越差。相反地，块尺寸越小，性能也就越好。</li>\n</ul>\n<p>一旦启用压缩，为了缓解以上问题，传统数据库一般都需要比较大的专用缓存，用来缓存解压后的数据，这样可以大幅提高热数据的访问性能，但又引起了双缓存的空间占用问题：一是操作系统缓存中的压缩数据；二是专用缓存（例如RocksDB中的DBCache）中解压后的数据。还有一个同样很严重的问题：专用缓存终归是缓存，当缓存未命中时，仍需要解压整个块，这就是慢Query问题的一个主要来源（慢Query的另一个主要来源是在操作系统缓存未命中时）。</p>\n<p>这些都导致现有传统数据库在访问速度和空间占用上是一个此消彼长、无法彻底解决的问题，只能采取一些折衷。</p>\n<p><strong>RocksDB 的块压缩</strong></p>\n<p>以RocksDB为例，RocksDB中的BlockBasedTable就是一个块压缩的SSTable，使用块压缩，索引只定位到块，块的尺寸在dboption里设定，一个块中包含多条（key，value）数据，例如M条，这样索引的尺寸就减小到了1/M：</p>\n<ul>\n<li>M越大，索引的尺寸越小；</li>\n<li>M越大，Block的尺寸越大，压缩算法（gzip、Snappy等）可以获得的上下文也越大，压缩率也就越高。</li>\n</ul>\n<p>创建BlockBasedTable时，Key Value被逐条填入buffer，当buffer尺寸达到预定大小（块尺寸，当然，一般buffer尺寸不会精确地刚好等于预设的块尺寸），就将buffer压缩并写入BlockBasedTable文件，并记录文件偏移和buffer中的第一个Key（创建index要用），如果单条数据太大，比预设的块尺寸还大，这条数据就单独占一个块（单条数据不管多大也不会分割成多个块）。所有Key Value写完以后，根据之前记录的每个块的起始Key和文件偏移，创建一个索引。所以在BlockBasedTable文件中，数据在前，索引在后，文件末尾包含元信息（作用相当于常用的FileHeader，只是位置在文件末尾，所以叫footer）。</p>\n<p>搜索时，先使用searchkey找到searchkey所在的block，然后到DB Cache中搜索这个块，找到后就进一步在块中搜索searchkey，如果找不到，就从磁盘/SSD读取这个块，解压后放入DB Cache。RocksDB中的DB Cache有多种实现，常用的包括LRU Cache，另外还有Clock Cache、Counting Cache（用来统计Cache命中率等），还有其他一些特殊的Cache。</p>\n<p>一般情况下，操作系统会有文件缓存，所以同一份数据可能既在DB Cache中（解压后的数据），又在操作系统Cache中（压缩的数据）。这样会造成内存浪费，所以RocksDB提供了一个折衷：在dboption中设置DIRECT_IO选项，绕过操作系统Cache，这样就只有DB Cache，可以节省一部分内存，但在一定程度上会降低性能。</p>\n<p><strong>传统非主流压缩：FM-Index</strong></p>\n<p>FM-Index的全名是Full Text Matching Index，属于Succinct Data Structure家族，对数据有一定的压缩能力，并且可以直接在压缩的数据上执行搜索和访问。</p>\n<p>FM-Index的功能非常丰富，历史也已经相当悠久，不算是一种新技术，在一些特殊场景下也已经得到了广泛应用，但是因为各种原因，一直不温不火。最近几年，FM-Index开始有些活跃，首先是GitHub上有个大牛实现了全套Succinct算法，其中包括FM-Index，其次Berkeley的Succinct项目也使用了FM-Index。</p>\n<p>FM-Index属于Offline算法（一次性压缩所有数据，压缩好之后不可修改），一般基于BWT变换（BWT变换基于后缀数组），压缩好的FM-Index支持以下两个最主要的操作：</p>\n<ul>\n<li>data = extract(offset, length)</li>\n<li>{offset} = search(string) ，返回多个匹配string的位置/偏移（offset）</li>\n</ul>\n<p>FM-Index还支持更多其他操作，感兴趣的朋友可以进一步调研。</p>\n<p>但是，在笔者看来，FM-Index有几个致命的缺点：</p>\n<ul>\n<li>实现太复杂（这一点可以被少数大牛们克服，不提也罢）；</li>\n<li>压缩率不高（比流式压缩例如gzip差太多）；</li>\n<li>搜索（search）和访问（extract）速度都很慢（在2016年最快的CPU i7-6700K上，单线程吞吐率不超过7MB/sec）；</li>\n<li>压缩过程又慢又耗内存（Berkeley的Succinct压缩过程内存消耗是源数据的50倍以上）；</li>\n<li>数据模型是Flat Text，不是数据库的KeyValue模型。</li>\n</ul>\n<p>可以用一种简单的方式把Flat Model转化成KeyValue Model：挑选一个在Key和Value中都不会出现的字符“#”（如果无法找出这样的字符，需要进行转义编码），每个Key前后都插入该字符，Key之后紧邻的就是Value。如此，search(#key#)返回了#key#出现的位置，我们就能很容易地拿到Value了。</p>\n<p>Berkeley的Succinc项目在FM-Index的Flat Text模型上实现了更丰富的行列（Row-Column）模型，付出了巨大的努力，达到了一定的效果，但离实用还相差太远。</p>\n<p>感兴趣的朋友可以仔细调研下FM-Index，以验证笔者的总结与判断。</p>\n<p><strong>Terark的可检索压缩（Searchable Compression）</strong></p>\n<p>Terark公司提出了“可检索压缩（Searchable Compression）”的概念，其核心也是直接在压缩的数据上执行搜索（search）和访问（extract），但数据模型本身就是KeyValue模型，根据其测试报告，速度要比FM-Index快得多（两个数量级），具体阐述：</p>\n<ul>\n<li>摒弃传统数据库的块压缩技术，采用全局压缩；</li>\n<li>对Key和Value使用不同的全局压缩技术；</li>\n<li>对Key使用有搜索功能的全局压缩技术COIndex（对应FM-Index的search）；</li>\n<li>对Value使用可定点访问的全局压缩技术PA-Zip（对应FM-Index的extract）。</li>\n</ul>\n<p><strong>对Key的压缩：CO-Index</strong></p>\n<p>我们需要对Key进行索引，才能有效地进行搜索，并访问需要的数据。</p>\n<p>普通的索引技术，索引的尺寸相对于索引中原始Key的尺寸要大很多，有些索引使用前缀压缩，能在一定程度上缓解索引的膨胀，但仍然无法解决索引占用内存过大的问题。</p>\n<p>我们提出了CO-Index（Compressed Ordered Index）的概念，并且通过一种叫做Nested Succinct Trie的数据结构实践了这一概念。</p>\n<p>较之传统实现索引的数据结构，Nested Succinct Trie的空间占用小十几倍甚至几十倍。而在保持该压缩率的同时，还支持丰富的搜索功能：</p>\n<ul>\n<li>精确搜索；</li>\n<li>范围搜索；</li>\n<li>顺序遍历；</li>\n<li>前缀搜索；</li>\n<li>正则表达式搜索（不是逐条遍历）。</li>\n</ul>\n<p>与FM-Index相比，CO-Index也有其优势（假定FM-Index中所有的数据都是Key）。</p>\n<div><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/0457b02458b4a0ba39b8c6364b7c78d4.png\"></div>\n<div style=\"text-align: center\">表1 FM-Index对比CO-Index</div>\n<p><strong>CO-Index的原理</strong></p>\n<p>实际上我们实现了很多种CO-Index，其中Nested Succinct Trie是适用性最广的一种，在这里对其原理做一个简单介绍：</p>\n<p><strong>Succinct Data Structure介绍</strong></p>\n<p>Succinct Data Structure是一种能够在接近于信息论下限的空间内来表达对象的技术，通常使用位图来表示，用位图上的rank和select来定位。</p>\n<p>虽然能够极大降低内存占用量，但实现起来较为复杂，并且性能低很多（时间复杂度的常数项很大）。目前开源的有SDSL-Lite，我们则使用自己实现的Rank-Select，性能也高于开源实现。</p>\n<p><strong>以二叉树为例</strong></p>\n<p>传统的表现形式是一个结点中包含两个指针：struct Node { Node *left, *right; };</p>\n<p>每个结点占用 2ptr，如果我们对传统方法进行优化，结点指针用最小的bits数来表达，N个结点就需要2*[log2(N)]个bits。</p>\n<ul>\n<li>对比传统基本版和传统优化版，假设共有216个结点（包括null结点），传统优化版需要2 bytes，传统基本版需要4/8 bytes。</li>\n<li>对比传统优化版和Succinct，假设共有10亿(~230)个结点。</li>\n<li>传统优化版每个指针占用[log2(230)]=30bits，总内存占用：($frac{2*30}{8}$)*230≈ 7.5GB。</li>\n<li>使用Succinct，占用：($frac{2.5}{8}$)*230≈ 312.5MB(每个结点2.5 bits，其中0.5bits是 rank-select 索引占用的空间）。</li>\n</ul>\n<p><strong>Succinct Tree</strong></p>\n<p>Succinct Tree有很多种表达方式，这里列出常见的两种：</p>\n<div><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/42bb4fdda5077930596850352a5d5ab8.png\"></div>\n<div style=\"text-align: center\">图1 Succinct Tree表达方式示例</div>\n<p><strong>Succinct Trie = Succinct Tree + Trie Label</strong></p>\n<p>Trie可以用来实现Index，图2这个Succinct Trie用的是LOUDS表达方式，其中保存了hat、is、it、a、四个Key。</p>\n<p><strong>Patricia Trie加嵌套</strong></p>\n<p>仅使用Succinct技术，压缩率远远不够，所以又应用了路径压缩和嵌套。这样一来，压缩率就上了一个新台阶。</p>\n<p>把上面这些技术综合到一起，就是我们的Nest Succinct Trie。</p>\n<p><strong>对Value的压缩: PA-Zip</strong></p>\n<p>我们研发了一种叫做PA-Zip (Point Accessible Zip)的压缩技术：每条数据关联一个ID，数据压缩好之后，就可以用相应的ID访问那条数据。这里，ID就是那个Point，所以叫做Point Accessible Zip。</p>\n<p>PA-Zip对整个数据库中的所有Value（KeyValue数据库中所有Value的集合）进行全局压缩，而不是按block/page进行压缩。这是针对数据库的需求（KeyValue 模型），专门设计的一个压缩算法，用来解决传统数据库压缩的问题：</p>\n<ul>\n<li>压缩率更高，没有双缓存的问题，只要把压缩后的数据装进内存，不需要专用缓存，可以按ID直接读取单条数据，如果把这种读取单条数据看作是一种解压，那么：</li>\n<li>按ID顺序解压时，解压速度（Throughput）一般在500MB每秒（单线程），最高达到约7GB/s，适合离线分析性需求，传统数据库压缩也能做到这一点；</li>\n<li>按ID随机解压时，解压速度一般在300MB每秒（单线程），最高达到约3GB/s，适合在线服务需求，这一点完胜传统数据库压缩：按随机解压300MB/s算，如果每条记录平均长度1K，相当于QPS = 30万；如果每条记录平均长度300个字节，相当于QPS = 100万；</li>\n<li>预热（warmup），在某些特殊场景下，数据库可能需要预热。因为去掉了专用缓存，TerarkDB的预热相对简单高效，只要把mmap的内存预热一下（避免Page Fault即可），数据库加载成功后就是预热好的，这个预热的Throughput就是SSD连续读的IO性能（较新的SSD读性能超过3GB/s）。</li>\n</ul>\n<p>与FM-Index相比，PA-Zip解决的是FM-Index的extract操作，但性能和压缩率都要好得多：</p>\n<div><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/899986dec4eb1f141407f572b05c511f.png\"></div>\n<div style=\"text-align: center\">表2 FM-Index对比PA-Zip</div>\n<p><strong>结合Key与Value</strong></p>\n<p>Key以全局压缩的形式保存在CO-Index中，Value以全局压缩的形式保存在 PA-Zip中。搜索一个Key，会得到一个内部ID，根据这个ID，去PA-Zip中定点访问该ID对应的Value，整个过程中只触碰需要的数据，不需要触碰其他数据。</p>\n<p>如此无需专用缓存（例如RocksDB中的DBCache），仅使用mmap，完美配合文件系统缓存，整个DB只有mmap的文件系统缓存这一层缓存，再加上超高的压缩率，大幅降低了内存用量，并且极大简化了系统的复杂性，最终完成数据库性能的大幅提升，从而同时实现了超高的压缩率和超高的随机读性能。</p>\n<p>从更高的哲学层面看，我们的存储引擎很像是用构造法推导出来的，因为CO-Index和PA-Zip紧密配合，完美匹配KeyValue模型，功能上“刚好够用”，性能上压榨硬件极限，压缩率逼近信息论的下限。相比其他方案：</p>\n<ul>\n<ul>\n<li>传统块压缩是从通用的流式压缩衍生而来，流式压缩的功能非常有限，只有压缩和解压两个操作，对太小的数据块没有压缩效果，也无法压缩数据块之间的冗余。把它用到数据库上，需要大量的工程努力，就像给汽车装上飞机机翼，然后要让它飞起来。</li>\n<li>相比FM-Index，情况则相反，FM-Index的功能非常丰富，它就必然要为此付出一些代价——压缩率和性能。而在KeyValue模型中，我们只需要它那些丰富功能的一个非常小的子集（还要经过适配和转化），其他更多的功能毫无用武之地，却仍然要付出那些代价，就像我们花了很高的代价造了一架飞机，却把它按在地上，只用轮子跑，当汽车用。</li>\n</ul>\n</ul>\n<div><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/0fadbdd0670c36a88f53a624790ad3bb.png\"></div>\n<div style=\"text-align: center\">图2 用LOUDS方式表达的Succinct Tree</div>\n<p> </p>\n<div><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/7be742bb10ad455007a1e6e8ca885fe4.png\"></div>\n<div style=\"text-align: center\">图3 路径压缩与嵌套</div>\n<p><strong>附录</strong></p>\n<p><strong>压缩率&amp;性能测试比较</strong></p>\n<p><strong>数据集：Amazon movie data</strong></p>\n<p>Amazon movie data (~8 million reviews)，数据集的总大小约为9GB, 记录数大约为800万条，平均每条数据长度大约1K。</p>\n<p>Benchmark代码开源：参见<a href=\"https://github.com/Terark/terarkdb-benchmark/tree/master/doc/movies\" target=\"_blank\">Github仓库</a>。<br>\n压缩率（见图4）</p>\n<div><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/02b6b59e468b97bc09a4d6ce30dd5eb2.png\"></div>\n<div style=\"text-align: center\">图4 压缩率对比</div>\n<p>随机读（见图5）</p>\n<div><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/33436d4c3c3bdef34dcbd58741d80380.png\"></div>\n<div style=\"text-align: center\">图5 随机读性能对比</div>\n<p>这是在内存足够的情况下，各个存储引擎的性能。<br>\n延迟曲线（见图6）</p>\n<div><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/75f6ac41648016d57f8c64747e19c235.png\"></div>\n<div style=\"text-align: center\">图6 延迟曲线对比</div>\n<p><strong>数据集：Wikipedia英文版</strong></p>\n<p>Wikipedia英文版的所有文本数据，109G，压缩到23G。</p>\n<p><strong>数据集：TPC-H</strong></p>\n<p>在TPC-H的lineitem数据上，使用TerarkDB和原版RocksDB（BlockBasedTable）进行对比测试：</p>\n<div><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/2ea750214ac1a02595cc67c794e35b20.png\"></div>\n<div style=\"text-align: center\">表3 TerarkDB与原版RocksDB对比测试</div>\n<p><strong>API 接口</strong></p>\n<p><strong>TerarkDB = Terark SSTable + RocksDB</strong></p>\n<p>RocksDB最初是Facebook对Google的LevelDB的一个fork，编程接口上兼容LevelDB，并增加了很多改进。</p>\n<p>RocksDB对我们有用的地方在于其SSTable可以plugin，所以我们实现了一个RocksDB的SSTable，将我们的技术优势通过RocksDB发挥出来。</p>\n<p>虽然RocksDB提供了一个相对完整的KeyValueDB框架，但要完全适配我们特有的技术，仍有一些欠缺，所以需要对RocksDB本身也做一些修改。将来可能有一天我们会将自己的修改提交到RocksDB官方版。</p>\n<p>Github链接：<a href=\"https://github.com/Terark/terarkdb\" target=\"_blank\">TerarkDB</a>（<a href=\"https://github.com/Terark/terarkdb\" target=\"_blank\">https://github.com/Terark/terarkdb</a>），TerarkDB包括两部分：</p>\n<ul>\n<li>terark-zip-rocksdb（<a href=\"https://github.com/terark/terark-zip-rocksdb\" target=\"_blank\">https://github.com/terark/terark-zip-rocksdb</a>），（Terark SSTable forrocksdb）</li>\n<li>Terark fork rocksdb（<a href=\"https://github.com/Terark/rocksdb\" target=\"_blank\">https://github.com/Terark/rocksdb</a>），（必须使用这个修改版的rocksdb）</li>\n</ul>\n<p>为了更好的兼容性，TerarkDB对RocksDB的API没有做任何修改，为了进一步方便用户使用TerarkDB，我们甚至提供了一种方式：程序无需重新编译，只需要替换 librocksdb.so并设置几个环境变量，就能体验TerarkDB。</p>\n<p>如果用户需要更精细的控制，可以使用C++ API详细配置TerarkDB的各种选项。</p>\n<p>目前大家可以免费试用，可以做性能评测，但是不能用于production，因为试用版会随机删掉0.1%的数据。</p>\n<p><strong>Terark命令行工具集</strong></p>\n<p>我们提供了一组命令行工具，这些工具可以将输入数据压缩成不同的形式，压缩后的文件可以使用Terark API或（该工具集中的）其他命令行工具解压或定点访问。</p>\n<p>详情参见<a href=\"https://github.com/Terark/terark-wiki-zh_cn\" target=\"_blank\">Terark wiki中文版</a>（<a href=\"https://github.com/Terark/terark-wiki-zh_cn\" target=\"_blank\">https://github.com/Terark/terark-wiki-zh_cn</a>）。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111930\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111930votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111930\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "post_url": "http://blog.jobbole.com/111930/", "tag_name": "IT技术，数据库", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2016/04/6e6cabd45d6fb2d059e608a9ff5b97e4.jpg"], "url_object_id": "9ce14fbc71c2b3562272365d741946ba"},
{"title": "移花接木：针对OAuth2的攻击", "creat_time": "2017-07-30", "praise_count": "2", "bookmark_count": 3, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文作者： <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/thoughtworkschina\">ThoughtWorks</a> 。未经作者许可，禁止转载！<br>欢迎加入伯乐在线 <a href=\"http://blog.jobbole.com/99322\" target=\"_blank\">专栏作者</a>。</div><p>作为第三方应用，为了提升用户体验，往往会提供第三方社交账号登录或者绑定的功能，这背后使用到的关键技术是OAuth认证。想要在自己的应用里集成OAuth不是难事儿，各大社交网站都提供了详尽的文档指南。</p>\n<div>\n<p>OAuth的复杂度比较高，有不少安全方面的坑，开发者在使用过程中一不注意可能就会掉进去，比如说不正确的使用OAuth2可能会遭遇到CSRF攻击。本文将对这个安全风险做一个通俗易懂的解释。 老司机发车前的特别提醒：阅读本文需要你对OAuth2有一些了解，可以参考文末的链接。</p>\n<h3>1. OAuth2 授权模式回顾</h3>\n<p>在开始之前，让我们先来回顾一下OAuth2中最典型的Authorization Code 授权模式，其大致流程如下：</p>\n<p><a href=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/07/1-OAuth2-Authorization-Code-Flow.png\"><img src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/07/1-OAuth2-Authorization-Code-Flow.png\" alt=\"\" width=\"768\" height=\"734\"></a></p>\n<p>图1：OAuth2 Authorization Code Flow</p>\n<p>我们把OAuth2的整个认证过程大致分为三个阶段。第一阶段主要是向用户取得授权许可，对应图中的第1、2、3步；第二阶段主要是申请访问令牌（access_token），对应图中的第4、5步；第三阶段就是使用access_token获取用户数据。</p>\n<p>这一过程中涉及了不少敏感参数和数据，例如client_secret相当于是第三方应用自己的密码，access_token某种程度上来讲就是用户的session id。由于这些参数以及数据极其特殊，我们当然得确保它们的安全性，HTTPS加密传输以及安全存储是必不可少的防护手段。不过仅仅做到这些是远远不够的，在这个流程里存在一个弱点，容易被攻击者利用进行CSRF攻击。</p>\n<h3>2. 针对OAuth2的CSRF攻击</h3>\n<h4>2.1 攻击流程</h4>\n<p>让我们来看一个针对OAuth2的CSRF攻击的例子。假设有用户张三，和攻击者李四，还有一个第三方Web应用Tonr，它集成了第三方社交账号登录，并且允许用户将社交账号和Tonr中的账号进行绑定。此外还有一个OAuth2服务提供者Sparklr。</p>\n<p><a href=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/07/2-CSRF-attack.png\"><img src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/07/2-CSRF-attack.png\" alt=\"\" width=\"768\" height=\"250\"></a></p>\n<p>图2：模拟攻击案例中涉及的角色</p>\n<p>Step 1. 攻击者李四登录Tonr网站，并且选择绑定自己的Sparklr账号。</p>\n<p>Step 2. Tonr网站将李四重定向到Sparklr，由于他之前已经登录过Sparklr，所以Sparklr直接向他显示“是否授权Tonr访问”的页面。</p>\n<p>Step 3. 李四在点击”同意授权“之后，截获Sparklr服务器返回的含有Authorization Code参数的HTTP响应。</p>\n<p>Step 4. 李四精心构造一个Web页面，它会触发Tonr网站向Sparklr发起令牌申请的请求，而这个请求中的Authorization Code参数正是上一步截获到的code。</p>\n<p>Step 5. 李四将这个Web页面放到互联网上，等待或者诱骗受害者张三来访问。</p>\n<p>Step 6. 张三之前登录了Tonr网站，只是没有把自己的账号和其他社交账号绑定起来。在张三访问了李四准备的这个Web页面后，令牌申请流程在张三的浏览器里被顺利触发，Tonr网站从Sparklr那里获取到access_token，但是这个token以及通过它进一步获取到的用户信息却都是攻击者李四的。</p>\n<p>Step 7. Tonr网站将李四的Sparklr账号同张三的Tonr账号关联绑定起来，从此以后，李四就可以用自己的Sparklr账号通过OAuth登录到张三在Tonr网站中的账号，堂而皇之的冒充张三的身份执行各种操作。</p>\n<p>等等，这一切发生得太快，还没看清楚李四怎么就登录到张三的账号里去了。没关系，让我们从几个不同的角度来看看这当中发生了什么。</p>\n<h4>2.2 受害者张三(Resource Owner)视角</h4>\n<p>受害者张三访问了一个Web页面，然后，就没有然后了，他在Tonr网站上的账号就和攻击者李四在Sparklr上的账号绑定到了一起。伪造的请求是经过精心构造的，令牌申请这一过程在张三的浏览器里是非常隐蔽的被触发的，换句话讲就是，他根本不知道这背后发生了什么。</p>\n<h4>2.3 Tonr网站(Client)视角</h4>\n<p>从Tonr网站来看，它收到的所有请求看上去都是正常的。首先它收到了一个HTTP请求，其代表着当前用户张三在Sparklr网站上已经做了“同意授权”操作。其内容如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-597dce8fe2c62621055939\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nGET /bindingCallback?code=AUTHORIZATION_CODE\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-597dce8fe2c62621055939-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597dce8fe2c62621055939-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-597dce8fe2c62621055939-1\"><span class=\"crayon-v\">GET</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bindingCallback</span><span class=\"crayon-sy\">?</span><span class=\"crayon-v\">code</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">AUTHORIZATION</span><span class=\"crayon-sy\">_</span>CODE</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597dce8fe2c62621055939-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>不过需要注意的是，URL里的code不是当前受害者张三的Authorization Code，而是攻击者李四的。</p>\n<p>当Tonr收到这样的请求时，它以为张三已经同意授权（但实际上这个请求是李四伪造的），于是就发起后续的令牌申请请求，用收到的Authorization Code向Sparklr换取access_token，只不过最后拿到的是攻击者李四的 access_token。</p>\n<p>最后，Tonr网站把攻击者李四的access_token和当前受害者张三在Tonr网站上的账号进行关联绑定。</p>\n<h4>2.4 Sparklr网站(OAuth2服务提供者)视角</h4>\n<p>Sparklr网站也是一脸茫然的样子，因为在它看来，自己收到的授权请求，以及后续的令牌申请请求都是正常的，或者说它无法得知接收到的这些请求之间的关联关系，而且也无法区别出这些请求到底是来自张三本人，还是由李四伪造出来的。因此只要自己收到的参数是正确有效的，那就提供正常的认证服务，仅此而已。</p>\n<h4>2.5 攻击者李四视角</h4>\n<p>李四伪造了一个用户授权成功的请求，并且将其中的Authorization Code参数替换成了自己提前获取到的code。这样，当受害者张三的浏览器被欺骗从而发起令牌申请请求时，实际上是在用张三在Tonr网站上的账号和李四在Sparklr网站上的账号做绑定。</p>\n<p>攻击完成后，李四在Tonr网站上可以通过自己在Sparklr网站的账号进行登录，而且登录进入的是张三在Tonr网站上的账号。而张三通过自己在Tonr网站上的账号登录进去之后，看到的是李四在Sparklr网站上的数据。</p>\n<h4>2.6 上帝视角</h4>\n<p>从整体上来看，这次攻击的时序图应该是下面这个样子的：</p>\n<p><a href=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/07/3-Sparklr.png\"><img src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/07/3-Sparklr.png\" alt=\"\" width=\"768\" height=\"734\"></a></p>\n<p>图3：攻击时序图示</p>\n<h3>3. 漏洞的本质</h3>\n<p>这个问题的关键点在于，OAuth2的认证流程是分为好几步来完成的，在图1中的第4步，第三方应用在收到一个GET请求时，除了能知道当前用户的cookie，以及URL中的Authorization Code之外，难以分辨出这个请求到底是用户本人的意愿，还是攻击者利用用户的身份伪造出来的请求。 于是乎，攻击者就能使用移花接木的手段，提前准备一个含有自己的Authorization Code的请求，并让受害者的浏览器来接着完成后续的令牌申请流程。</p>\n<h3>4. 前提条件</h3>\n<p>尽管这个攻击既巧妙又隐蔽，但是要成功进行这样的CSRF攻击也是需要满足一定前提条件的。</p>\n<p>首先，在攻击过程中，受害者张三在Tonr网站上的用户会话(User Session)必须是有效的，也就是说，张三在受到攻击前已经登录了Tonr网站。</p>\n<p>其次，整个攻击必须在短时间内完成，因为OAuth2提供者颁发的Authorization Code有效期很短，OAuth2官方推荐的时间是不大于10分钟，而一旦Authorization Code过期那么后续的攻击也就不能进行下去了。</p>\n<p>最后，一个Authorization Code只能被使用一次，如果OAuth2提供者收到重复的Authorization Code，它会拒绝当前的令牌申请请求。不止如此，根据OAuth2官方推荐，它还可以把和这个已经使用过的Authorization Code相关联的access_token全部撤销掉，进一步降低安全风险。</p>\n<h3>5. 防御办法</h3>\n<p>要防止这样的攻击其实很容易，作为第三方应用的开发者，只需在OAuth认证过程中加入state参数，并验证它的参数值即可。具体细节如下：</p>\n<ul>\n<li>在将用户重定向到OAuth2的Authorization Endpoint去的时候，为用户生成一个随机的字符串，并作为state参数加入到URL中。</li>\n<li>在收到OAuth2服务提供者返回的Authorization Code请求的时候，验证接收到的state参数值。如果是正确合法的请求，那么此时接受到的参数值应该和上一步提到的为该用户生成的state参数值完全一致，否则就是异常请求。</li>\n<li>state参数值需要具备下面几个特性：\n<ul>\n<li>不可预测性：足够的随机，使得攻击者难以猜到正确的参数值</li>\n<li>关联性：state参数值和当前用户会话（user session）是相互关联的</li>\n<li>唯一性：每个用户，甚至每次请求生成的state参数值都是唯一的</li>\n<li>时效性：state参数一旦被使用则立即失效</li>\n</ul>\n</li>\n</ul>\n<h3>6. 总结</h3>\n<p>要避免遭受本文提到的CSRF攻击问题，需要第三方应用正确的使用state参数，然而纵观各大OAuth服务提供者，在其开发文档里都没有明确把state参数和CSRF攻击联系起来，仅仅只是像下面这样一句话带过：</p>\n<p><em>“参数：state</em></p>\n<p><em>是否必须：否</em></p>\n<p><em>说明：重定向后会带上state参数，开发者可以填写a-zA-Z0-9的参数值，最多128字节”</em></p>\n<p>让事情变得更糟糕的是，state是可选参数，因此更容易被开发者忽略，造成安全风险。此外，本文中的攻击非常巧妙，可以悄无声息的攻陷受害者的账号，难以被察觉到。</p>\n<p>作为第三方应用的开发者，我们除了参考OAuth2服务提供者的开发文档之外，还应当加深自己对OAuth2的理解，尽可能的避开这些安全的坑。 而作为OAuth2服务提供者，也应当承担起提醒开发者注意防范安全风险的责任。</p>\n<p>参考资料</p>\n<ul>\n<li><a href=\"https://aaronparecki.com/oauth-2-simplified/\">OAuth2 Simplified</a></li>\n<li><a href=\"https://tools.ietf.org/html/rfc6749\">OAuth2 Authorization Framework RFC6749</a></li>\n</ul>\n<div></div>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111926\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111926votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111926\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 3 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/thoughtworkschina\">ThoughtWorks</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/thoughtworkschina\">\r\n\t\t\t<img src=\"http://tp3.sinaimg.cn/1774908135/180/0/1\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            ThoughtWorks是一家全球IT咨询公司，追求卓越软件质量，致力于科技驱动商业变革。擅长构建定制化软件产品，帮助客户快速将概念转化为价值。同时为客户提供用户体验设计、技术战略咨询、组织转型等咨询服务。        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/thoughtworkschina\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/thoughtworkschina/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/thoughtworkschina/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 62</a> · <a title=\"我的网站\" target=\"_blank\" href=\"http://insights.thoughtworkers.org/\"><i class=\"fa fa-link\"></i></a> <a title=\"微博主页\" target=\"_blank\" href=\"http://weibo.com/thoughtworkschina\"><i class=\"fa fa-weibo\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "post_url": "http://blog.jobbole.com/111926/", "tag_name": "IT技术，OAuth2", "front_image_url": ["http://insights.thoughtworkers.org/wp-content/uploads/2017/07/1-OAuth2-Authorization-Code-Flow.png"], "url_object_id": "366f225c06e5d219f2213ca1330cfce3"},
{"title": "Linux Bash 提示符的一些骚操作", "creat_time": "2017-07-30", "praise_count": "1", "bookmark_count": 5, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://opensource.com/article/17/7/bash-prompt-tips-and-tricks\">Dave Neary</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-8711-1.html\">Linux中国/toyijiu</a>   </div><p>当你在 Linux 环境下打开一个 Shell 终端时，会看到命令行中出现了类似下面的一个 Bash 提示符：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-597dde2341aa5355344260\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n[user@$host ~]$</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-597dde2341aa5355344260-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-597dde2341aa5355344260-1\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">@</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">host</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">$</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>你知道命令行提示符其实是可以自己设置添加许多非常有用的信息的吗？在这篇文章中我就会教你如何自定义自己的 Bash 命令行提示符，想看的话就接着看吧~</p>\n<h3 id=\"toc_1\">如何设置 Bash 提示符</h3>\n<p>Bash 提示符是通过环境变量 <code>PS1</code> （提示符字符串 1Prompt String 1） 来设置的，它用于交互式 shell 提示符。当然如果你需要更多的输入才能完成一个 Bash 命令时，<code>PS2</code> 环境变量就是用来设置多行提示符的：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-597dde2341aaf550350542\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n[dneary@dhcp-41-137 ~]$ export PS1=\"[Linux Rulez]$ \"\r\n[Linux Rulez] export PS2=\"... \"\r\n[Linux Rulez] if true; then\r\n... echo \"Success!\"\r\n... fi\r\nSuccess!</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-597dde2341aaf550350542-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597dde2341aaf550350542-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-597dde2341aaf550350542-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597dde2341aaf550350542-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-597dde2341aaf550350542-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597dde2341aaf550350542-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-597dde2341aaf550350542-1\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">dneary</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">dhcp</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">41</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">137</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">export </span><span class=\"crayon-v\">PS1</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"[Linux Rulez]$ \"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597dde2341aaf550350542-2\"><span class=\"crayon-sy\">[</span><span class=\"crayon-e\">Linux </span><span class=\"crayon-v\">Rulez</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">export </span><span class=\"crayon-v\">PS2</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"... \"</span></div><div class=\"crayon-line\" id=\"crayon-597dde2341aaf550350542-3\"><span class=\"crayon-sy\">[</span><span class=\"crayon-e\">Linux </span><span class=\"crayon-v\">Rulez</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597dde2341aaf550350542-4\"><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Success!\"</span></div><div class=\"crayon-line\" id=\"crayon-597dde2341aaf550350542-5\"><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fi</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597dde2341aaf550350542-6\"><span class=\"crayon-v\">Success</span><span class=\"crayon-o\">!</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p></p>\n<h3 id=\"toc_2\">在哪里设置 PS1 的值？</h3>\n<p><code>PS1</code> 就是一个普通的环境变量，系统默认值设置在 <code>/etc/bashrc</code> 中，在我的系统中，默认提示符通过以下命令来设置的：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-597dde2341ab4208651978\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n[ \"$PS1\" = \"\\\\s-\\\\v\\\\\\$ \" ] &amp;&amp; PS1=\"[\\u@\\h \\W]\\\\$ \"</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-597dde2341ab4208651978-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-597dde2341ab4208651978-1\"><span class=\"crayon-sy\">[</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"$PS1\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"\\\\s-\\\\v\\\\\\$ \"</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">PS1</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"[\\u@\\h \\W]\\\\$ \"</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>它判断 <code>PS1</code> 是否是系统的默认值 <code>\\s-\\v$</code> ，如果是的话则将值设置为 <code>[\\u@\\h \\W]\\$</code>。（LCTT 译注：注意命令中用 <code>\\</code> 做了转义。）</p>\n<p>但如果你想要自定义提示符，不应该修改 <code>/etc/bashrc</code> ，而是应该在你的主目录下将自定义命令加到 <code>.bashrc</code> 文件中。</p>\n<h3 id=\"toc_3\">上面提到的 <code>\\u</code>、<code>\\h</code>、<code>\\W</code>、<code>\\s</code> 和 <code>\\v</code> 是什么意思？</h3>\n<p>在 <code>man bash</code> 中的 PROMPTING 章节中，你能够找到所有 <code>PS1</code> 和 <code>PS2</code> 相关的特殊字符的描述，以下是一些比较常用的：</p>\n<ul>\n<li><code>\\u</code>：用户名</li>\n<li><code>\\h</code>：短主机名</li>\n<li><code>\\W</code>：当前你所在的目录的名称（basename），<code>~</code> 表示你的主目录</li>\n<li><code>\\s</code>：Shell 名字（bash 或者 sh，取决于你的 Shell 的名字是什么）</li>\n<li><code>\\v</code>：Shell 的版本号</li>\n</ul>\n<h3 id=\"toc_4\">还有哪些特殊的字符串可以用在提示符当中</h3>\n<p>除了上面这些，还有很多有用的字符串可以用在提示符当中：</p>\n<ul>\n<li><code>\\d</code>：将日期扩展成 “Tue Jun 27” 这种格式</li>\n<li><code>\\D{fmt}</code>：允许自定义日期格式——可通过 <code>man strftime</code> 来获得更多信息</li>\n<li><code>\\D{%c}</code>：获得本地化的日期和时间</li>\n<li><code>\\n</code>：换行（参考下面的多行提示符）</li>\n<li><code>\\w</code>：显示当前工作目录的完整路径</li>\n<li><code>\\H</code>：当前工作机器的完整主机名</li>\n</ul>\n<p>除了以上这些，你还可以在 Bash 的 man 页面的 PROMPTING 部分找到更多的特殊字符和它的用处。</p>\n<h3 id=\"toc_5\">多行提示符</h3>\n<p>如果你的提示符过长（比如说你想包括 <code>\\H</code> 、<code>\\w</code> 或完整的日期时间时 ），想将提示符切成两行，可以使用 <code>\\n</code> 将提示符切断成两行显示，比如下面的多行的例子会在第一行显示日期、时间和当前工作目录，第二行显示用户名和主机名：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-597dde2341ab9802140780\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nPS1=\"\\D{%c} \\w\\n[\\u@\\H]$ \"</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-597dde2341ab9802140780-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-597dde2341ab9802140780-1\"><span class=\"crayon-v\">PS1</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"\\D{%c} \\w\\n[\\u@\\H]$ \"</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p></p>\n<h3 id=\"toc_6\">还能再好玩点吗？</h3>\n<p>人们偶尔也想将提示符变成彩色的。虽然我觉得彩色提示符让人分心、易怒，但是也许你很喜欢。如果我们想将日期变成红色的，目录变成青蓝色，用户名搞一个黄色背景，你可以这样做：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/e93d223f94256801e7b835a1d8a8fd6a.png\"><img class=\"alignnone size-full wp-image-111975\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/e93d223f94256801e7b835a1d8a8fd6a.png\" alt=\"QQ截图20170721114211\"></a></p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/6b40448b267a67ff6bfa9118492cf7f4.png\"><img class=\"alignnone size-full wp-image-111986\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/6b40448b267a67ff6bfa9118492cf7f4.png\" alt=\"QQ截图20170722114539\"></a></p>\n<p>你可以在 <a class=\"ext\" href=\"http://tldp.org/HOWTO/Bash-Prompt-HOWTO/x329.html\" target=\"_blank\" rel=\"external nofollow\">Bash prompt HOWTO</a> 这里找到更多的颜色代码，甚至可以让字符反相和闪烁！我不知道为什么地球人会有这种想法，但是你可以这么干！</p>\n<p>所以你最喜欢的自定义提示符是什么样子的呢？有没有让你抓狂的自定义提示符呢？请在评论里告诉我吧~</p>\n<p>作者简介：</p>\n<p>Dave Neary – Dave Neary 是红帽开源和标准化团队成员，帮助开源项目对红帽的成功至关重要。自从在 1999 年为 GIMP 提交了第一个补丁以来，他一直带着各种不同的帽子，在开源的世界徜徉。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111971\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111971votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111971\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 5 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "post_url": "http://blog.jobbole.com/111971/", "tag_name": "IT技术，Linux", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/10/23426c26d6b88a782a1d894de8e89bca.jpg"], "url_object_id": "8d8f78aafcb5a019513c49f2cd214efb"},
{"title": "10小时到10分钟，一步步优化巨量关键词的匹配", "creat_time": "2017-07-30", "praise_count": "1", "bookmark_count": 2, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.cnblogs.com/zhenbianshu/p/7197349.html\">枕边书</a>   </div><div>\n<h2 id=\"toc_0\">问题由来</h2>\n<p>前些天工作中遇到一个问题：</p>\n<blockquote><p>有 60万 条短消息记录日志，每条约 50 字，5万 关键词，长度 2-8 字，绝大部分为中文。要求将这 60万 条记录中包含的关键词全部提取出来并统计各关键词的命中次数。</p></blockquote>\n<p>本文完整介绍了我的实现方式，看我如何将需要运行十小时的任务优化到十分钟以内。虽然实现语言是 PHP，但本文介绍的更多的思想，应该能给大家一些帮助。</p>\n<h2 id=\"toc_1\">原始 – grep</h2>\n<h3 id=\"toc_2\">设计</h3>\n<p>一开始接到任务的时候，我的小心思立刻转了起来，<strong>日志 + 关键词 + 统计</strong>，我没有想到自己写代码实现，而是首先想到了 linux 下常用的日志统计命令 <span style=\"color: #ff0000;\"><code>grep</code></span>。</p>\n<p><span style=\"color: #ff0000;\"><code>grep</code></span>命令的用法不再多提，使用 <span style=\"color: #ff0000;\"><code>grep 'keyword' | wc -l</code></span> 可以很方便地进行统计关键词命中的信息条数，而php的 <span style=\"color: #ff0000;\"><code>exec()</code></span> 函数允许我们直接调用 linux 的 shell 命令，虽然这样执行危险命令时会有安全隐患。</p>\n<h3 id=\"toc_3\">代码</h3>\n<p>上伪代码：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-597dc95bb3d6d456668134\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nforeach ($word_list as $keyword) {\r\n    $count = intval(exec(\"grep '{$keyword}' file.log | wc -l\"));\r\n    record($keyword, $count);\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-597dc95bb3d6d456668134-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597dc95bb3d6d456668134-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-597dc95bb3d6d456668134-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597dc95bb3d6d456668134-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-597dc95bb3d6d456668134-1\"><span class=\"crayon-st\">foreach</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-e\">word_list </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">keyword</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597dc95bb3d6d456668134-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">count</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">intval</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">exec</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"grep '{$keyword}' file.log | wc -l\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-597dc95bb3d6d456668134-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">record</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">keyword</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">count</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597dc95bb3d6d456668134-4\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p>在一台老机器上跑的，话说老机器效率真的差，跑了6小时。估计最新机器2-3小时吧，后面的优化都使用的新机器，而且需求又有变动，正文才刚刚开始。</p>\n<p><em>原始，原始在想法和方法</em>。</p>\n<h2 id=\"toc_4\">进化 – 正则</h2>\n<h3 id=\"toc_5\">设计</h3>\n<p>交了差之后，第二天产品又提出了新的想法，说以后想把某数据源接入进来，消息以数据流的形式传递，而不再是文件了。而且还要求了消息统计的实时性，一下把我想把数据写到文件再统计的想法也推翻了，为了方案的可扩展性，现在的统计对象不再是一个整体，而是要考虑拿n个单条的消息来匹配了。</p>\n<p>这时，略懵的我只好祭出了最传统的工具- 正则。正则的实现也不难，各个语言也都封装好了正则匹配函数，重点是模式(pattern)的构建。</p>\n<p>当然这里的模式构建也不难，<span style=\"color: #ff0000;\"><code>/keyword1|keword2|.../</code></span>，用<span style=\"color: #ff0000;\"><code>|</code></span>将关键词连接起来即可。</p>\n<h3 id=\"toc_6\">正则小坑</h3>\n<p>这里介绍两个使用中遇到的小坑：</p>\n<ul>\n<li>正则模式长度太长导致匹配失败：PHP 的正则有回溯限制，以防止消耗掉所有的进程可用堆栈, 最终导致 php 崩溃。太长的模式会导致 PHP 检测到回溯过多，中断匹配，经测试默认设置时最大模式长度为 32000 字节 左右。php.ini 内 <span style=\"color: #ff0000;\"><code>pcre.backtrack_limit</code></span> 参数为最大回溯次数限制，默认值为 1000000，修改或 <span style=\"color: #ff0000;\"><code>php.ini</code></span> 或在脚本开始时使用 <span style=\"color: #ff0000;\"><code>ini_set(‘pcre.backtrack_limit’, n);</code></span> 将其设置为一个较大的数可以提高单次匹配最大模式长度。当然也可以将关键词分批统计（我用了这个=_=）。</li>\n<li>模式中含有特殊字符导致大量warning：匹配过程中发现 PHP 报出大量 warning：<span style=\"color: #ff0000;\"><code>unknown modifier <strong>乱码</strong></code></span>，仔细检查发现关键词中有<span style=\"color: #ff0000;\"><code>/</code></span>字符，可以使用<span style=\"color: #ff0000;\"><code>preg_quote()</code></span>函数过滤一遍关键词即可。</li>\n</ul>\n<h3 id=\"toc_7\">代码</h3>\n<p>上伪代码：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-597dc95bb3d79642789253\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$end = 0;\r\n$step = 1500;\r\n$pattern = array();\r\n// 先将pattern 拆成多个小块\r\nwhile ($end &lt; count($word_list)) {\r\n    $tmp_arr = array_slice($word_list, $end, $step);\r\n    $end += $step;\r\n    $item = implode('|', $tmp_arr);\r\n    $pattern[] = preg_quote($item);\r\n}\r\n\r\n$content = file_get_contents($log_file);\r\n$lines = explode(\"\\n\", $content);\r\nforeach ($lines as $line) {\r\n    // 使用各小块pattern分别匹配\r\n    for ($i = 0; $i &lt; count($pattern); $i++) {\r\n        preg_match_all(\"/{$pattern[$i]}/\", $line, $match);\r\n    }\r\n    $match = array_unique(array_filter($match));\r\n    dealResult($match);\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-597dc95bb3d79642789253-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597dc95bb3d79642789253-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-597dc95bb3d79642789253-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597dc95bb3d79642789253-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-597dc95bb3d79642789253-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597dc95bb3d79642789253-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-597dc95bb3d79642789253-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597dc95bb3d79642789253-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-597dc95bb3d79642789253-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597dc95bb3d79642789253-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-597dc95bb3d79642789253-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597dc95bb3d79642789253-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-597dc95bb3d79642789253-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597dc95bb3d79642789253-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-597dc95bb3d79642789253-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597dc95bb3d79642789253-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-597dc95bb3d79642789253-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597dc95bb3d79642789253-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-597dc95bb3d79642789253-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597dc95bb3d79642789253-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-597dc95bb3d79642789253-21\">21</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-597dc95bb3d79642789253-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-st\">end</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597dc95bb3d79642789253-2\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">step</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1500</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-597dc95bb3d79642789253-3\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">pattern</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597dc95bb3d79642789253-4\"><span class=\"crayon-c\">// 先将pattern 拆成多个小块</span></div><div class=\"crayon-line\" id=\"crayon-597dc95bb3d79642789253-5\"><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-st\">end</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">count</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">word_list</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597dc95bb3d79642789253-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">tmp_arr</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">array_slice</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">word_list</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-st\">end</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">step</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-597dc95bb3d79642789253-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-st\">end</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">step</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597dc95bb3d79642789253-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">item</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">implode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'|'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">tmp_arr</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-597dc95bb3d79642789253-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">pattern</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">preg_quote</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">item</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597dc95bb3d79642789253-10\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-597dc95bb3d79642789253-11\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597dc95bb3d79642789253-12\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">content</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">file_get_contents</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">log_file</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-597dc95bb3d79642789253-13\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">lines</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">explode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"\\n\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">content</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597dc95bb3d79642789253-14\"><span class=\"crayon-st\">foreach</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-e\">lines </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">line</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-597dc95bb3d79642789253-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// 使用各小块pattern分别匹配</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597dc95bb3d79642789253-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">count</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">pattern</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-597dc95bb3d79642789253-17\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">preg_match_all</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"/{$pattern[$i]}/\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">line</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">match</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597dc95bb3d79642789253-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-597dc95bb3d79642789253-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">match</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">array_unique</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">array_filter</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">match</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597dc95bb3d79642789253-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">dealResult</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">match</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-597dc95bb3d79642789253-21\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0040 seconds] -->\r\n<p>为了完成任务，硬着头皮进程跑了一夜。当第二天我发现跑了近十个小时的时候内心是崩溃的。。。太慢了，完全达不到使用要求，这时，我已经开始考虑改换方法了。</p>\n<p>当产品又改换了关键词策略，替换了一些关键词，要求重新运行一遍，并表示还会继续优化关键词时，我完全否定了现有方案。绝对不能用关键词去匹配信息，这样一条一条用全部关键词去匹配，效率实在是不可忍受。</p>\n<p><em>进化，需求和实现的进化</em></p>\n<h2 id=\"toc_8\">觉醒 – 拆词</h2>\n<h3 id=\"toc_9\">设计</h3>\n<p>我终于开始意识到要拿信息去关键词里对比。如果我用关键词为键建立一个 hash 表，用信息里的词去 hash 表里查找，如果查到就认为匹配命中，这样不是能达到 O(1) 的效率了么？</p>\n<p>可是一条短消息，我如何把它拆分为刚好的词去匹配呢，分词？分词也是需要时间的，而且我的关键词都是些无语义的词，构建词库、使用分词工具又是很大的问题，最终我想到 <span style=\"color: #ff0000;\"><code>拆词</code></span>。</p>\n<p>为什么叫拆词呢，我考虑以蛮力将一句话拆分为<span style=\"color: #ff0000;\"><code><strong>所有可能</strong>的</code></span>词。如（<strong><span style=\"color: #ff0000;\"><code>我是好人）</code></span></strong>就可以拆成（<strong><span style=\"color: #ff0000;\"><code>我是、是好、好人、我是好、是好人、我是好人）</code></span></strong>等词，我的关键词长度为 2-8，所以可拆词个数会随着句子长度迅速增加。不过，可以用标点符号、空格、语气词（如<span style=\"color: #ff0000;\"><code>的、是</code></span>等）作为分隔将句子拆成小短语再进行拆词，会大大减少拆出的词量。</p>\n<p>其实分词并没有完整实现就被后一个方法替代了，只是一个极具实现可能的构想，写这篇文章时用伪代码实现了一下，供大家参考，即使不用在匹配关键词，用在其他地方也是有可能的。</p>\n<h3>代码</h3>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-597dc95bb3d7f275162469\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$str_list = getStrList($msg);\r\nforeach ($str_list as $str) {\r\n    $keywords = getKeywords($str);\r\n    foreach ($keywords as $keyword) {\r\n        // 直接通过PHP数组的哈希实现来进行快速查找\r\n        if (isset($word_list[$keyword])) {\r\n            record($keyword);\r\n        }\r\n    }\r\n}\r\n/**\r\n * 从消息中拆出短句子\r\n */\r\nfunction getStrList($msg) {\r\n    $str_list = array();\r\n    $seperators = array('，', '。', '的', ...);\r\n\r\n    $words = preg_split('/(?&lt;!^)(?!$)/u', $msg);\r\n    $str = array();\r\n    foreach ($words as $word) {\r\n        if (in_array($word, $seperators)) {\r\n            $str_list[] = $str;\r\n            $str = array();\r\n        } else {\r\n            $str[] = $word;\r\n        }\r\n    }\r\n\r\n    return array_filter($str_list);\r\n}\r\n\r\n/**\r\n * 从短句中取出各个词\r\n */\r\nfunction getKeywords($str) {\r\n    if (count($str) &lt; 2) {\r\n        return array();\r\n    }\r\n\r\n    $keywords = array();\r\n    for ($i = 0; $i &lt; count($str); $i++) {\r\n        for ($j = 2; $j &lt; 9; $j++) {\r\n            $keywords[] = array_slice($str, $i, $j); // todo 限制一下不要超过数组最大长度\r\n        }\r\n    }\r\n\r\n    return $keywords;\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-597dc95bb3d7f275162469-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597dc95bb3d7f275162469-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-597dc95bb3d7f275162469-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597dc95bb3d7f275162469-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-597dc95bb3d7f275162469-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597dc95bb3d7f275162469-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-597dc95bb3d7f275162469-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597dc95bb3d7f275162469-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-597dc95bb3d7f275162469-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597dc95bb3d7f275162469-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-597dc95bb3d7f275162469-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597dc95bb3d7f275162469-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-597dc95bb3d7f275162469-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597dc95bb3d7f275162469-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-597dc95bb3d7f275162469-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597dc95bb3d7f275162469-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-597dc95bb3d7f275162469-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597dc95bb3d7f275162469-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-597dc95bb3d7f275162469-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597dc95bb3d7f275162469-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-597dc95bb3d7f275162469-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597dc95bb3d7f275162469-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-597dc95bb3d7f275162469-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597dc95bb3d7f275162469-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-597dc95bb3d7f275162469-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597dc95bb3d7f275162469-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-597dc95bb3d7f275162469-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597dc95bb3d7f275162469-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-597dc95bb3d7f275162469-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597dc95bb3d7f275162469-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-597dc95bb3d7f275162469-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597dc95bb3d7f275162469-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-597dc95bb3d7f275162469-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597dc95bb3d7f275162469-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-597dc95bb3d7f275162469-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597dc95bb3d7f275162469-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-597dc95bb3d7f275162469-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597dc95bb3d7f275162469-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-597dc95bb3d7f275162469-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597dc95bb3d7f275162469-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-597dc95bb3d7f275162469-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597dc95bb3d7f275162469-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-597dc95bb3d7f275162469-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597dc95bb3d7f275162469-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-597dc95bb3d7f275162469-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597dc95bb3d7f275162469-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-597dc95bb3d7f275162469-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597dc95bb3d7f275162469-48\">48</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-597dc95bb3d7f275162469-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">str_list</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getStrList</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">msg</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597dc95bb3d7f275162469-2\"><span class=\"crayon-st\">foreach</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-e\">str_list </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">str</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-597dc95bb3d7f275162469-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">keywords</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getKeywords</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">str</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597dc95bb3d7f275162469-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">foreach</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-e\">keywords </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">keyword</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-597dc95bb3d7f275162469-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// 直接通过PHP数组的哈希实现来进行快速查找</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597dc95bb3d7f275162469-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">isset</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">word_list</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">keyword</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-597dc95bb3d7f275162469-7\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">record</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">keyword</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597dc95bb3d7f275162469-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-597dc95bb3d7f275162469-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597dc95bb3d7f275162469-10\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-597dc95bb3d7f275162469-11\"><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597dc95bb3d7f275162469-12\"><span class=\"crayon-c\"> * 从消息中拆出短句子</span></div><div class=\"crayon-line\" id=\"crayon-597dc95bb3d7f275162469-13\"><span class=\"crayon-c\"> */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597dc95bb3d7f275162469-14\"><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getStrList</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">msg</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-597dc95bb3d7f275162469-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">str_list</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597dc95bb3d7f275162469-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">seperators</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'，'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'。'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'的'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-597dc95bb3d7f275162469-17\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597dc95bb3d7f275162469-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">words</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">preg_split</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'/(?&lt;!^)(?!$)/u'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">msg</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-597dc95bb3d7f275162469-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">str</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597dc95bb3d7f275162469-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">foreach</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-e\">words </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-t\">word</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-597dc95bb3d7f275162469-21\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">in_array</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-t\">word</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">seperators</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597dc95bb3d7f275162469-22\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">str_list</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">str</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-597dc95bb3d7f275162469-23\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">str</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597dc95bb3d7f275162469-24\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-597dc95bb3d7f275162469-25\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">str</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-t\">word</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597dc95bb3d7f275162469-26\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-597dc95bb3d7f275162469-27\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597dc95bb3d7f275162469-28\"> </div><div class=\"crayon-line\" id=\"crayon-597dc95bb3d7f275162469-29\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">array_filter</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">str_list</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597dc95bb3d7f275162469-30\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-597dc95bb3d7f275162469-31\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597dc95bb3d7f275162469-32\"><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line\" id=\"crayon-597dc95bb3d7f275162469-33\"><span class=\"crayon-c\"> * 从短句中取出各个词</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597dc95bb3d7f275162469-34\"><span class=\"crayon-c\"> */</span></div><div class=\"crayon-line\" id=\"crayon-597dc95bb3d7f275162469-35\"><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getKeywords</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">str</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597dc95bb3d7f275162469-36\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">count</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">str</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-597dc95bb3d7f275162469-37\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597dc95bb3d7f275162469-38\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-597dc95bb3d7f275162469-39\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597dc95bb3d7f275162469-40\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">keywords</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-597dc95bb3d7f275162469-41\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">count</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">str</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597dc95bb3d7f275162469-42\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">j</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">j</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">9</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">j</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-597dc95bb3d7f275162469-43\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">keywords</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">array_slice</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">str</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">j</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// todo 限制一下不要超过数组最大长度</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597dc95bb3d7f275162469-44\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-597dc95bb3d7f275162469-45\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597dc95bb3d7f275162469-46\"> </div><div class=\"crayon-line\" id=\"crayon-597dc95bb3d7f275162469-47\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">keywords</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597dc95bb3d7f275162469-48\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0069 seconds] -->\r\n<p></p>\n<h3 id=\"toc_11\">结果</h3>\n<p>我们知道一个 <span style=\"color: #ff0000;\"><code>utf-8</code></span> 的中文字符要占用三个字节，为了拆分出包含中英文的每一个字符，使用简单的 <span style=\"color: #ff0000;\"><code>split()</code></span> 函数是做不到的。</p>\n<p>这里使用了 <span style=\"color: #ff0000;\"><span style=\"color: #ff0000;\"><code>preg_split('/(?&lt;!^)(?!$)/u', $msg)</code></span></span> 是通过正则匹配到两个字符之间的<span style=\"color: #ff0000;\"><code>''</code></span>来将两个字符拆散，而两个括号里的 <span style=\"color: #ff0000;\"><code>(?&lt;!^)(?!$)</code></span> 是分别用来限定捕获组不是第一个，也不是最后一个（不使用这两个捕获组限定符也是可以的，直接使用<span style=\"color: #ff0000;\"><code>//</code></span>作为模式会导致拆分结果在前后各多出一个空字符串项）。  捕获组的概念和用法可见我之前的博客 <a href=\"http://www.cnblogs.com/zhenbianshu/p/4941964.html\">PHP正则中的捕获组与非捕获组</a></p>\n<p>由于没有真正实现，也不知道效率如何。估算每个短句长度约为 10 字左右时，每条短消息约50字左右，会拆出 200 个词。虽然它会拆出很多无意义的词，但我相信效率绝不会低，由于其 hash 的高效率，甚至我觉得会可能比终极方法效率要高。</p>\n<p>最终没有使用此方案是因为它对句子要求较高，拆词时的分隔符也不好确定，最重要的是它不够优雅。。。这个方法我不太想去实现，统计标识和语气词等活显得略为笨重，而且感觉拆出很多无意义的词感觉效率浪费得厉害。</p>\n<p><em>觉醒，意识和思路的觉醒</em></p>\n<h2 id=\"toc_12\">终级 – Trie树</h2>\n<h3 id=\"toc_13\">trie树</h3>\n<p>于是我又来找谷哥帮忙了，搜索大量数据匹配，有人提出了 使用 trie 树的方式，没想到刚学习的 trie 树的就派上了用场。我上上篇文章刚介绍了 trie 树，在<a href=\"http://www.cnblogs.com/zhenbianshu/p/7061550.html\">空间索引 – 四叉树</a> 里<span style=\"color: #ff0000;\"><code>字典树</code></span>这一小节，大家可以查看一下。</p>\n<p>当然也为懒人复制了一遍我当时的解释(看过的可以跳过这一小节了)。</p>\n<blockquote><p>字典树，又称前缀树或 trie 树，是一种有序树，用于保存关联数组，其中的键通常是字符串。与二叉查找树不同，键不是直接保存在节点中，而是由节点在树中的位置决定。一个节点的所有子孙都有相同的前缀，也就是这个节点对应的字符串，而根节点对应空字符串。</p></blockquote>\n<p>我们可以类比字典的特性：我们在字典里通过拼音查找晃(<span style=\"color: #ff0000;\"><code>huang</code></span>)这个字的时候，我们会发现它的附近都是读音为<span style=\"color: #ff0000;\"><code>huang</code></span>的，可能是声调有区别，再往前翻，我们会看到读音前缀为<span style=\"color: #ff0000;\"><code>huan</code></span>的字，再往前，是读音前缀为<span style=\"color: #ff0000;\"><code>hua</code></span>的字… 取它们的读音前缀分别为 <span style=\"color: #ff0000;\"><code>h qu hua huan huang</code></span>。我们在查找时，根据 <span style=\"color: #ff0000;\"><code>abc...xyz</code></span> 的顺序找到<span style=\"color: #ff0000;\"><code>h</code></span>前缀的部分，再根据 <span style=\"color: #ff0000;\"><code>ha he hu</code></span>找到 <span style=\"color: #ff0000;\"><code>hu</code></span> 前缀的部分…最后找到 <span style=\"color: #ff0000;\"><code>huang</code></span>，我们会发现，越往后其读音前缀越长，查找也越精确，这种类似于字典的树结构就是字典树，也是前缀树。</p>\n<h2 id=\"toc_14\">设计</h2>\n<p>那么 trie 树怎么实现关键字的匹配呢? 这里以一幅图来讲解 trie 树匹配的过程。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/513742e19f31c6296f72381e383f60ea.png\"><img class=\"aligncenter wp-image-111935 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/513742e19f31c6296f72381e383f60ea.png\" alt=\"1\" width=\"396\" height=\"493\"></a></p>\n<p>其中要点：</p>\n<h4 id=\"toc_15\">构造trie树</h4>\n<ol>\n<li>将关键词用上面介绍的<span style=\"color: #ff0000;\"><code>preg_split()</code></span>函数拆分为单个字符。如<span style=\"color: #ff0000;\"><code>科学家</code></span>就拆分为<span style=\"color: #ff0000;\"><code>科、学、家</code></span>三个字符。</li>\n<li>在最后一个字符后添加一个特殊字符<span style=\"color: #ff0000;\"><code>`</code></span>，此字符作为一个关键词的结尾（图中的粉红三角），以此字符来标识查到了一个关键词（不然，我们不知道匹配到<span style=\"color: #ff0000;\"><code>科、学</code></span>两个字符时算不算匹配成功）。</li>\n<li>检查根部是否有第一个字符(<span style=\"font-family: Monaco, Consolas, 'Andale Mono', 'DejaVu Sans Mono', monospace;\">科</span>)节点，如果有了此节点，到<code style=\"font-weight: bold;\">步骤4</code>。 如果还没有，在根部添加值为<code style=\"font-weight: bold;\">科</code>的节点。</li>\n<li>依次检查并添加<span style=\"color: #ff0000;\"><code>学、家</code></span> 两个节点。</li>\n<li>在结尾添加 <span style=\"color: #ff0000;\"><code>`</code></span> 节点，并继续下一个关键词的插入。</li>\n</ol>\n<h4 id=\"toc_16\">匹配</h4>\n<p>然后我们以 <span style=\"color: #ff0000;\"><code><strong>这位科学家很了不起</strong>！</code></span>为例来发起匹配。</p>\n<ul>\n<li>首先我们将句子拆分为单个字符 <strong><span style=\"color: #ff0000;\"><code>这、位</code></span><span style=\"color: #ff0000;\"><code>、...</code></span>；</strong></li>\n<li>从根查询第一个字符<span style=\"color: #ff0000;\"><code>这</code></span>，并没有以这个字符开头的关键词，将字符“指针”向后移，直到找到根下有的字符节点<strong><span style=\"color: #ff0000;\"><code>科</code></span></strong>;</li>\n<li>接着在节点<span style=\"color: #ff0000;\"><code>科</code></span>下寻找值为 <strong><span style=\"color: #ff0000;\"><code>学</code></span></strong>节点，找到时，结果子树的深度已经到了2，关键词的最短长度是2，此时需要在<span style=\"color: #ff0000;\"><code>学</code></span>结点下查找是否有<span style=\"color: #ff0000;\"><span style=\"color: #ff0000;\"><code>`</code></span></span>，找到意味着匹配成功，返回关键词，并将字符“指针”后移，如果找不到则继续在此结点下寻找下一个字符。</li>\n<li>如此遍历，直到最后，返回所有匹配结果。</li>\n</ul>\n<h3 id=\"toc_17\">代码</h3>\n<p>完整代码我已经放到了GitHub上：<a href=\"https://github.com/zhenbianshu/DataStructureAndAlgorithm/blob/master/keyword_match_trie.php\">Trie-GitHub-zhenbianshu</a>，这里放上核心。</p>\n<p>首先是数据结构树结点的设计，当然它也是重中之重：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-597dc95bb3d87646863765\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$node = array(\r\n    'depth' =&gt; $depth, // 深度，用以判断已命中的字数\r\n    'next' =&gt; array(\r\n        $val =&gt; $node, // 这里借用php数组的哈希底层实现，加速子结点的查找\r\n        ...\r\n    ),\r\n);</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-597dc95bb3d87646863765-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597dc95bb3d87646863765-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-597dc95bb3d87646863765-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597dc95bb3d87646863765-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-597dc95bb3d87646863765-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597dc95bb3d87646863765-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-597dc95bb3d87646863765-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-597dc95bb3d87646863765-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">node</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597dc95bb3d87646863765-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'depth'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">depth</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 深度，用以判断已命中的字数</span></div><div class=\"crayon-line\" id=\"crayon-597dc95bb3d87646863765-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'next'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597dc95bb3d87646863765-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">val</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 这里借用php数组的哈希底层实现，加速子结点的查找</span></div><div class=\"crayon-line\" id=\"crayon-597dc95bb3d87646863765-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597dc95bb3d87646863765-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-597dc95bb3d87646863765-7\"><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>然后是树构建时子结点的插入：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-597dc95bb3d8b513608315\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n// 这里要往节点内插入子节点，所以将它以引用方式传入\r\nprivate function insert(&amp;$node, $words) {\r\n         if (empty($words)) {\r\n            return;\r\n        }\r\n        $word = array_shift($words);\r\n        // 如果子结点已存在，向子结点内继续插入\r\n        if (isset($node['next'][$word])) {\r\n            $this-&gt;insert($node['next'][$word], $words);\r\n        } else {\r\n            // 子结点不存在时，构造子结点插入结果\r\n            $tmp_node = array(\r\n                'depth' =&gt; $node['depth'] + 1,\r\n                'next' =&gt; array(),\r\n            );\r\n            $node['next'][$word] = $tmp_node;\r\n            $this-&gt;insert($node['next'][$word], $words);\r\n        }\r\n    }</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-597dc95bb3d8b513608315-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597dc95bb3d8b513608315-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-597dc95bb3d8b513608315-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597dc95bb3d8b513608315-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-597dc95bb3d8b513608315-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597dc95bb3d8b513608315-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-597dc95bb3d8b513608315-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597dc95bb3d8b513608315-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-597dc95bb3d8b513608315-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597dc95bb3d8b513608315-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-597dc95bb3d8b513608315-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597dc95bb3d8b513608315-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-597dc95bb3d8b513608315-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597dc95bb3d8b513608315-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-597dc95bb3d8b513608315-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597dc95bb3d8b513608315-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-597dc95bb3d8b513608315-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597dc95bb3d8b513608315-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-597dc95bb3d8b513608315-19\">19</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-597dc95bb3d8b513608315-1\"><span class=\"crayon-c\">// 这里要往节点内插入子节点，所以将它以引用方式传入</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597dc95bb3d8b513608315-2\"><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">insert</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">words</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-597dc95bb3d8b513608315-3\"><span class=\"crayon-h\">         </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">empty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">words</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597dc95bb3d8b513608315-4\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-597dc95bb3d8b513608315-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597dc95bb3d8b513608315-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-t\">word</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">array_shift</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">words</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-597dc95bb3d8b513608315-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// 如果子结点已存在，向子结点内继续插入</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597dc95bb3d8b513608315-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">isset</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'next'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">$</span><span class=\"crayon-t\">word</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-597dc95bb3d8b513608315-9\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">insert</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'next'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">$</span><span class=\"crayon-t\">word</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">words</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597dc95bb3d8b513608315-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-597dc95bb3d8b513608315-11\"><span class=\"crayon-h\">            </span><span class=\"crayon-c\">// 子结点不存在时，构造子结点插入结果</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597dc95bb3d8b513608315-12\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">tmp_node</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line\" id=\"crayon-597dc95bb3d8b513608315-13\"><span class=\"crayon-h\">                </span><span class=\"crayon-s\">'depth'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'depth'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597dc95bb3d8b513608315-14\"><span class=\"crayon-h\">                </span><span class=\"crayon-s\">'next'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-597dc95bb3d8b513608315-15\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597dc95bb3d8b513608315-16\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'next'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">$</span><span class=\"crayon-t\">word</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">tmp_node</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-597dc95bb3d8b513608315-17\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">insert</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'next'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">$</span><span class=\"crayon-t\">word</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">words</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597dc95bb3d8b513608315-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-597dc95bb3d8b513608315-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0034 seconds] -->\r\n<p>最后是查询时的操作：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-597dc95bb3d8f485542815\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n// 这里也可以使用一个全局变量来存储已匹配到的字符，以替换$matched\r\nprivate function query($node, $words, &amp;$matched) {\r\n        $word = array_shift($words);\r\n        if (isset($node['next'][$word])) {\r\n            // 如果存在对应子结点，将它放到结果集里\r\n            array_push($matched, $word);\r\n            // 深度到达最短关键词时，即可判断是否到词尾了\r\n            if ($node['next'] &gt; 1 &amp;&amp; isset($node['next'][$word]['next']['`'])) {\r\n                return true;\r\n            }\r\n            return $this-&gt;query($node['next'][$word], $words, $matched);\r\n        } else {\r\n            $matched = array();\r\n            return false;\r\n        }\r\n    }</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-597dc95bb3d8f485542815-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597dc95bb3d8f485542815-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-597dc95bb3d8f485542815-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597dc95bb3d8f485542815-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-597dc95bb3d8f485542815-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597dc95bb3d8f485542815-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-597dc95bb3d8f485542815-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597dc95bb3d8f485542815-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-597dc95bb3d8f485542815-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597dc95bb3d8f485542815-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-597dc95bb3d8f485542815-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597dc95bb3d8f485542815-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-597dc95bb3d8f485542815-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597dc95bb3d8f485542815-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-597dc95bb3d8f485542815-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597dc95bb3d8f485542815-16\">16</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-597dc95bb3d8f485542815-1\"><span class=\"crayon-c\">// 这里也可以使用一个全局变量来存储已匹配到的字符，以替换$matched</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597dc95bb3d8f485542815-2\"><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">query</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">words</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">matched</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-597dc95bb3d8f485542815-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-t\">word</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">array_shift</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">words</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597dc95bb3d8f485542815-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">isset</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'next'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">$</span><span class=\"crayon-t\">word</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-597dc95bb3d8f485542815-5\"><span class=\"crayon-h\">            </span><span class=\"crayon-c\">// 如果存在对应子结点，将它放到结果集里</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597dc95bb3d8f485542815-6\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">array_push</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">matched</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-t\">word</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-597dc95bb3d8f485542815-7\"><span class=\"crayon-h\">            </span><span class=\"crayon-c\">// 深度到达最短关键词时，即可判断是否到词尾了</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597dc95bb3d8f485542815-8\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'next'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">isset</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'next'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">$</span><span class=\"crayon-t\">word</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'next'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'`'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-597dc95bb3d8f485542815-9\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597dc95bb3d8f485542815-10\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-597dc95bb3d8f485542815-11\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">query</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'next'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">$</span><span class=\"crayon-t\">word</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">words</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">matched</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597dc95bb3d8f485542815-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-597dc95bb3d8f485542815-13\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">matched</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597dc95bb3d8f485542815-14\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-597dc95bb3d8f485542815-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597dc95bb3d8f485542815-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0032 seconds] -->\r\n<p></p>\n<h3 id=\"toc_18\">结果</h3>\n<p>结果当然是喜人的，如此匹配，处理一千条数据只需要3秒左右。找了 Java 的同事试了下，Java 处理一千条数据只需要1秒。</p>\n<p>这里来分析一下为什么这种方法这么快：</p>\n<ul>\n<li>正则匹配：要用所有的关键词去信息里匹配匹配次数是 <span style=\"color: #ff0000;\"><code>key_len * msg_len</code></span>，当然正则会进行优化，但基础这样，再优化效率可想而知。</li>\n<li>而 trie 树效率最差的时候是<strong> <span style=\"color: #ff0000;\"><code>msg_len * 9(最长关键词长度 + 1个特殊字符)</code></span>次 hash</strong> 查找，即最长关键词类似 <span style=\"color: #ff0000;\"><code>AAA</code></span>，信息内容为 <span style=\"color: #ff0000;\"><code>AAA...</code></span>时，而这种情况的概率可想而知。</li>\n</ul>\n<p>至此方法的优化到此结束，从每秒钟匹配 10 个，到 300 个，30 倍的性能提升还是巨大的。</p>\n<p><em>终级，却不一定是终极</em></p>\n<h2 id=\"toc_19\">他径 – 多进程</h2>\n<h3 id=\"toc_20\">设计</h3>\n<p>匹配方法的优化结束了，开头说的优化到十分钟以内的目标还没有实现，这时候就要考虑一些其他方法了。</p>\n<p>我们一提到高效，必然想到的是 <span style=\"color: #ff0000;\"><code>并发</code></span>，那么接下来的优化就要从并发说起。PHP 是单线程的（虽然也有不好用的多线程扩展），这没啥好的解决办法，并发方向只好从多进程进行了。</p>\n<p>那么一个日志文件，用多个进程怎么读呢？这里当然也提供几个方案：</p>\n<ul>\n<li>进程内添加日志行数计数器，各个进程支持传入参数 n，进程只处理第 行数<span style=\"color: #ff0000;\"><code> % n = n</code></span> 的日志，这种 hack 的反向分布式我已经用得很熟练了，哈哈。这种方法需要进程传参数，还需要每个进程都分配读取整个日志的的内存，而且也不够优雅。</li>\n<li>使用 linux 的 <span style=\"color: #ff0000;\"><code>split -l n file.log output_pre</code></span> 命令，将文件分割为每份为 n 行的文件，然后用多个进程去读取多个文件。此方法的缺点就是不灵活，想换一下进程数时需要重新切分文件。</li>\n<li>使用 Redis 的 list 队列临时存储日志，开启多个进程消费队列。此方法需要另外向 Redis 内写入数据，多了一个步骤，但它扩展灵活，而且代码简单优雅。</li>\n</ul>\n<p>最终使用了第三种方式来进行。</p>\n<h3 id=\"toc_21\">结果</h3>\n<p>这种方式虽然也会有瓶颈，最后应该会落在 Redis 的网络 IO 上。我也没有闲心开 n 个进程去挑战公司 Redis 的性能，运行 10 个进程三四分钟就完成了统计。即使再加上 Redis 写入的耗时，10分钟以内也妥妥的。</p>\n<p>一开始产品对匹配速度已经有了小时级的定位了，当我 10 分钟就拿出了新的日志匹配结果，看到产品惊讶的表情，心里也是略爽的，哈哈~</p>\n<p><em>他径，也能帮你走得更远</em></p>\n<h2 id=\"toc_22\">总结</h2>\n<p>解决问题的方法有很多种，我认为在解决各种问题之前，要了解很多种知识，即使只知道它的作用。就像一个工具架，你要先把工具尽量摆得多，才能在遇到问题时选取一个最合适的。接着当然要把这些工具用是纯熟了，这样才能使用它们去解决一些怪异问题。</p>\n<p>工欲善其事，必先利其器，要想解决性能问题，掌握系统级的方法还略显不够，有时候换一种数据结构或算法，效果可能会更好。感觉自己在这方面还略显薄弱，慢慢加强吧，各位也共勉。</p>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111934\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111934votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111934\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "post_url": "http://blog.jobbole.com/111934/", "tag_name": "IT技术，php，正则表达式", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/07/513742e19f31c6296f72381e383f60ea.png"], "url_object_id": "69121d473d20cb45ed412306e1883d3f"},
{"title": "编程、出书、赛车……DHH 是如何兼顾这一切的？", "creat_time": "2017-07-30", "praise_count": "1", "bookmark_count": 5, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/zhj318\">飞哥的咖啡</a> 翻译，<a href=\"http://www.jobbole.com/members/hanxiaomax\">艾凌风</a> 校稿。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://m.signalvnoise.com/manufacturing-quality-time-fe043fa7b7a1#.7w18xpuzd\">DHH</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>【伯乐在线导读】：《<a href=\"http://blog.jobbole.com/111892/\" target=\"_blank\">代码写的好，出过畅销书，还拿过赛车冠军，这是一种什么体验？</a>》这篇文章中已经介绍了 DHH。他既是 Ruby On Rails 之父，BaseCamp 的 CTO，又是一个家庭主男，业余还会参加赛车比赛，还爱好摄影，那他是如何兼顾着这一切的呢？</p>\n<p>的确也经常有人问他这个问题。不了解他的人，觉得他一定有些秘密或窍门。每晚只睡 5 小时？还是持续几个月每天工作 12 小时？还是其他什么的。</p>\n<p>2015 年 12 月 30 日，DHH 专门写了一篇文章，分享了他的答案。</p>\n<p><img id=\"pic\" class=\"aligncenter\" src=\"http://wx3.sinaimg.cn/large/7cc829d3gy1fhns9sfhyuj20rs0fu75o.jpg\" width=\"600\" height=\"342\"></p>\n<p style=\"text-align: left;\">“高效能人群”的共同点仅仅是他们更加努力地工作，通常像超人似的。对单一事物的关注/专注，是驱使他们工作到晚上 11 点的动力。而媒体喜欢报道他们这样那样的非凡毅力和决心。</p>\n<p>但我不吃这一套，我通常每晚的睡眠时间是 8.5 至 9 小时，并每周 40 小时。我不想在工作上花更多的时间。</p>\n<p><span style=\"color: #ff0000;\"><strong>如果一定要我说有什么技巧，那就是我追求每个小时的质量</strong></span>。不过这不代表着「<strong>时间管理</strong>」，该词出现于上世纪 90 年代，意思是将每个小时切分到最后一分钟，以压榨提高每秒的生产力峰值。但时间管理确实说明了一件事：<strong>每个小时的价值不尽相同</strong>。</p>\n<p>如果一小时充满了压力、中断、缺觉或者疲惫，在这种状态下工作，你对不起这一小时中的每一分钟。因为它是低质量的一小时。如果妄想通过这样低质时间能够做出好东西，明显非常愚蠢。因为你最终也只能「<strong>垃圾进来，垃圾出去</strong>」。</p>\n<p><strong>每周工作 40 小时，是一个王者的固守。</strong>在这样的前提下，我认为几乎可以完成所有的东西。当然了，前提是你没有把时间浪费在会议、一心多用或定义不清的问题上。这些都是吞噬时间的黑洞，深不见底。</p>\n<p>好吧，即便没有黑洞，但也有物理极限的（ 1 天只有 24 小时），我相信很多人都觉得自己是时间的穷人！如果花了时间但一事无成，你不能怪我，而我也不怪自己。<span style=\"color: #000000;\">怜悯是我们仅剩的借口了。</span></p>\n<p>自我保护或让别人帮你，也许能给你带来暂时的舒适，但从长久来看，它掩盖不了缺乏理想的窘境。面对失败，放弃是一种应对的机制。</p>\n<p>你需要的是一套精细的技术，需要积极努力地提高时间的纯度和质量。以下是我使用的几个小窍门：</p>\n<h3>1、我真的需要参与其中吗？</h3>\n<p>贪婪的好奇心会让你无休止地卷入各种讨论、决定和事件中，尽管是否有你，那些事可能区别都不大。</p>\n<p>你提出的想法或经验，“可能”对他人有用，但你也同样剥夺了他人自由思考的权利，这点可能让你难以接受。</p>\n<p>目前看来，略读邮件、拒绝会议邀请、不要在聊天中发表你的看法，这些举措可能还挺深奥的。但通过努力克制自己、避免插嘴和介入合作，能够让你集中时间花在少量的事上，以取得更重要的进展。</p>\n<h3>2、这个/这事还能等等吗？</h3>\n<p>有些问题需要今天处理掉，否则就是明天的麻烦。你最好马上处理掉那些问题，虽然它们通常只占少数。大多数的问题和机会值得从现在起，花上一天、一周甚至一月的时间来处理。</p>\n<p>将手上的事先搁置一边，可能等你回头再看的时候，它就不是事儿了。是不是很棒？！这些是不需要立刻做的工作，或者只是一开始认为非常重要，实则不然。</p>\n<p>花在解决问题上的时间越长，你会对这个问题有着更深入的了解。随着空闲时间的投入，解决问题的痛苦将大大减少。</p>\n<h3>3、我能放弃吗？</h3>\n<p>浪费了高质量时间的代价，往往最终浪费了一天的时间。而错误估计了问题的深度，也是工作和生活中的一个常见过失。</p>\n<p>当意识到现在的问题比当初预期的更难，却不承认解决问题需要花费比原计划更多的时间，结果通常是越陷越深，从而浪费更多的时间。</p>\n<p>学会放弃是一项关键的技能，能够让你专注于剩下的时间。只有失败者才会在<strong>沉没成本</strong>上下赌注。</p>\n<blockquote><p>伯乐在线补充：<strong>沉没成本</strong>是指由于过去的决策已经发生了的，而不能由现在或将来的任何决策改变的成本。人们在决定是否去做一件事情的时候，不仅是看这件事对自己有没有好处，而且也看过去是不是已经在这件事情上有过投入。我们把这些已经发生不可收回的支出，如时间、金钱、精力等称为“沉没成本”（Sunk Cost）。在经济学和商业决策制定过程中会用到“沉没成本”的概念，代指已经付出且不可收回的成本。沉没成本常用来和可变成本作比较，可变成本可以被改变，而沉没成本则不能被改变。</p></blockquote>\n<h3>4、我准备好了吗？</h3>\n<p>有时，问题需要更多的时间来发酵，你也需要更多的时间来成长。你我都做不到能够同时解决所有的问题。</p>\n<p>如果我本周适合写作，那完成新网站的拷贝工作会是一个好选择，但安排下个季度的工作情况则不是一个好的时机。如果我本周手指发痒想写代码，那正好可以尝试解决那个困扰了我一个月的 bug，但是却不适合做一对一面试。</p>\n<p>我们的情绪会如潮水般上下起伏，在激情和消沉之间摇摆不定。顺势而为要比逆势前行轻松得多。就像上文的例子一样，大多数事情都可以推延到合适的情绪下再做。</p>\n<p>即使你掌握了强大的技巧，让每一个小时都更有价值，失败仍然不可避免。原因也许只是本周所有要做的工作并不能激起你的激情。一旦激情消失，你会倍感失落。</p>\n<p>知道真相或许会给你巨大的心理安慰：每个人都会经历低潮，尽管大部分人都不承认这一点。即使有着经过打磨的高品质时间，我仍然经常生产出垃圾，比我预期得还要多。就是这么回事儿！</p>\n<p>长久来看，关键在于你要不断提高时间的质量，即使没有得到一个好的结果，也不要给自己过多的压力。</p>\n<p>一旦你建立了对高质量时间的正确认识和积极态度，我相信你就不会一味地追求更多的时间。高质量的四个连续小时和几天的垃圾（低质量）时间完全不可同日而语，两者相差悬殊。</p>\n<p>即便你对时间进行压缩以获取更多的时间，你可能也就多了 20% 到 50% 的时间；但对拥有的时间进行规划和打磨，你可能会得到 200% 到 500% 的额外价值。<span style=\"color: #ff0000;\"><strong>这才是真正的 10 倍效率！</strong></span></p>\n<p><strong>兼顾一切的窍门是停止兼顾。</strong></p>\n<p> </p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111888\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111888votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111888\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 5 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/zhj318\">飞哥的咖啡</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/zhj318\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2016/09/9667abaa540914200edd449974fb5538.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            我见青山多妩媚，料青山见我应如是        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/zhj318\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/zhj318/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/zhj318/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 28</a> · <a title=\"QQ：574375911\" target=\"_blank\" href=\"#\"><i class=\"fa fa-qq\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "post_url": "http://blog.jobbole.com/111888/", "tag_name": "职场，DHH", "front_image_url": ["http://wx3.sinaimg.cn/large/7cc829d3gy1fhns9sfhyuj20rs0fu75o.jpg"], "url_object_id": "32fb6fb546aac0808415e5f45c8f324a"},
{"title": "Facebook 这类网站如何处理数十亿请求并保持高可用性的？", "creat_time": "2017-07-30", "praise_count": "1", "bookmark_count": 6, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/snowhere\">孙腾浩</a> 翻译。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://blog.vivekpanyam.com/scaling-a-web-service-load-balancing/\">Vivek Panyam</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>Facebook 这类网站如何处理数十亿请求并保持高可用性呢，答案是负载均衡，本文将对其一探究竟。</p>\n<h3>什么是负载均衡</h3>\n<p>负载均衡是许多协同工作资源（通常是计算机）的分配策略。它们通常用于提高容量和可靠性。</p>\n<p>为了便于讨论负载均衡，对于服务扩展我假设以下两点：</p>\n<ul>\n<li>我可以运行任意数量实例</li>\n<li>任何请求可以到达任意实例</li>\n</ul>\n<p>第一个假设表明服务是无状态的（或者像 Redis 集群一样可以共享状态）。第二个假设实际中并不是必须的（比如粘性负载均衡），但在这片文章中做这样的假设便于讨论。</p>\n<p>下面是我将要讨论的负载均衡技术：</p>\n<ol>\n<li>应用层（OSI 第七层）负载均衡（HTTP、HTTPS、WS）</li>\n<li>传输层（OSI 第四层）负载均衡（TCP、UDP）</li>\n<li>网络层（OSI 第三层）负载均衡</li>\n<li>DNS 负载均衡</li>\n<li>多个子域手动负载均衡</li>\n<li>任播（Anycast）</li>\n</ol>\n<p>最后还有一些其他知识点：</p>\n<ul>\n<li>延迟和吞吐量</li>\n<li>服务器直接返回</li>\n</ul>\n<p>这些技术大致按照「网站流量增大时需要的操作步骤」排序。比如，应用层的负载均衡是首先要做的事（远远早于任播）。前三条技术提高吞吐量和可用性，但存在单点故障。其余的三条技术在提高吞吐量的同时避免了单点故障。</p>\n<p>为了帮助我们理解负载均衡，我们来看一个简单的服务扩展。</p>\n<p>注意：每种扩展技术都采用了非技术的比喻（在商店购物）。这些比喻仅仅是描述技术背后的思想，并不完全准确。</p>\n<h3>服务</h3>\n<p>我们假设我们正在构建大规模的服务。就像下图所示：</p>\n<p><img class=\"aligncenter\" src=\"https://blog.vivekpanyam.com/content/images/2016/02/Service-1.png\" alt=\"\"></p>\n<p>这个系统并不能处理大量通信，并且如果它宕机，整个应用就停了。</p>\n<h4>比喻：</h4>\n<ul>\n<li>你走向商店唯一一条结账的队伍。</li>\n<li>你购买你的商品，如果那里没有收银员，你无法完成购买。</li>\n</ul>\n<h3>应用层（OSI 第七层）负载均衡</h3>\n<p>为了承载更大的通信量，首先用到的就是应用层负载均衡。应用层是 OSI 第七层。它包括 HTTP、HTTPS 和 WebSockets。一款非常流行又久经考验的应用层负载均衡器就是 Nginx。让我们看看它如何帮助我们扩展服务：</p>\n<p><img src=\"https://blog.vivekpanyam.com/content/images/2016/02/L7LB.png\" alt=\"\"></p>\n<p>请注意，通过这种技术，我们能负载均衡数十或上百服务器实例。上面图片只展示两个作为例子。</p>\n<h4>比喻</h4>\n<ul>\n<li>商店员工引领你到一个特别的（有收银员的）结账队伍</li>\n<li>你购买你的商品</li>\n</ul>\n<h4>工具：</h4>\n<ul>\n<li>Nginx</li>\n<li>HAProxy</li>\n</ul>\n<h4>注意：</h4>\n<ul>\n<li>我们要在这里停止使用 SSL（分发时不用 SSL)</li>\n</ul>\n<h3>传输层（OSI 第四层）负载均衡（TCP、UDP）</h3>\n<p>上一条技术帮助我们承载大量通信，但如果我们需要承载更大的通信量，传输层负载均衡非常有用。传输层是 OSI 第四层，包括 TCP 和 UDP。流行的传输层负载均衡器有 HAProxy（这个也用于应用层负载均衡）和 IPVS。让我们看看它们如何帮助我们扩展服务：</p>\n<p><img src=\"https://blog.vivekpanyam.com/content/images/2016/02/L4LB.png\" alt=\"\"></p>\n<p>应用层负载均衡+传输层负载均衡能处理大多数情况下的通信量。然而我们我们仍要担心可用性。单点故障有可能出现在传输层的负载均衡器。我们在下面一节的 DNS 负载均衡解决这个问题。</p>\n<h4>比喻：</h4>\n<ul>\n<li>根据客户会员卡卡号有不同结账区域。举个例子，如果你的会员卡卡号是偶数，去电器区附近的结账台，否则就去食品区附近的结账台。</li>\n<li>一旦你到达正确的结账区域，商店员工引领你到一个特别的结账队伍</li>\n<li>你购买你的商品</li>\n</ul>\n<h4>工具：</h4>\n<ul>\n<li>HAProxy</li>\n<li>IPVS</li>\n</ul>\n<h3>网络层（OSI 第三层）负载均衡</h3>\n<p>如果我们要继续扩展，我们需要增加网络层负载均衡。这比上面两条技术更复杂。网络层是 OSI 第三层，包括 IPv4 和 IPv6。下面是网络层负载均衡：</p>\n<p><img src=\"https://blog.vivekpanyam.com/content/images/2016/02/L3LB.png\" alt=\"\"></p>\n<p>为了搞清楚它如何工作，我们需要一点等价路由的知识（ECMP）。当有多条等价链路到达相同地址时，我们使用等价路由。简单来说，它允许路由器或交换机通过不同链接发送数据包（支持高吞吐量），最终到达同一地址。</p>\n<p>我们可以利用这一点来实现网络层负载均衡，因为在我们看来，每个传输层负载均衡器是相同的。这意味着我们可以把从网络层负载均衡器到传输层负载均衡器的链接看做相同目的地的链路。如果我们把所有负载均衡器绑定到相同 IP 地址，我们可以使用等价路由在传输层负载均衡器之间分配通信。</p>\n<h4>比喻：</h4>\n<ul>\n<li>街对面有两家彼此分开却又一模一样的商店，你去哪一家完全取决于你的习惯。</li>\n<li>一旦你到达了商店，根据客户会员卡卡号有不同结账区域。举个例子，如果你的会员卡卡号是偶数，去电器区附近的结账台，否则就去食品区附近的结账台。</li>\n<li>一旦你到达正确的结账区域，商店员工引领你到一个特别的结账队伍</li>\n<li>你购买你的商品</li>\n</ul>\n<h4>工具：</h4>\n<ul>\n<li>通常在机柜里交换机内部的硬件中处理。</li>\n</ul>\n<h4>太长不阅：</h4>\n<ul>\n<li>除非你的服务规模相当大或有自己的硬件，否则你不需要它。</li>\n</ul>\n<h3>DNS 负载均衡</h3>\n<p>DNS 是将名称转换为 IP 地址的系统。举个例子，它可以把 example.com 转换为 93.184.216.34 。它当然也可以返回多个 IP 地址，像下面这样：</p>\n<p><img class=\"aligncenter\" src=\"https://blog.vivekpanyam.com/content/images/2016/02/Screen-Shot-2016-02-04-at-3-25-32-AM.png\" alt=\"\"></p>\n<p>如果返回了多个 IP，客户端通常会使用第一个可用的地址（然而一些应用只看第一个返回的 IP）。</p>\n<p>目前有很多 DNS 负载均衡技术，比如 GeoDNS 和轮询调度（round-robin）。GeoDNS 基于不同请求者而返回不同响应。这让我们可以将客户端路由到其最近的服务器或数据中心。轮询调度会循环所有可用的 IP 地址，对于每个响应会返回不同的 IP。如果多个 IP 可用，这两种技术仅仅改变响应里的 IP 顺序。</p>\n<p>下图展示 DNS 负载均衡如何工作：</p>\n<p><img src=\"https://blog.vivekpanyam.com/content/images/2016/02/DNS.png\" alt=\"\"></p>\n<p>在这个例子中，不同的用户被路由到不同的服务集群（随机或基于地理位置）。</p>\n<p>现在这里不再有单点故障的可能性（假设有多台 DNS 服务器）。为了进一步提高可靠性，我们可以在不同数据中心运行多个服务集群。</p>\n<h4>比喻：</h4>\n<ul>\n<li>你在网上查询购物中心，返回的列表把最近的购物中心放在第一个。你查看通往每个购物中心的路，然后选择列表中第一个营业的购物中心。</li>\n<li>街对面有两家彼此分开却又一模一样的商店，你去哪一家完全取决于你的习惯。</li>\n<li>一旦你到达了商店，根据客户会员卡卡号有不同结账区域。举个例子，如果你的会员卡卡号是偶数，去电器区附近的结账台，否则就去食品区附近的结账台。</li>\n<li>一旦你到达正确的结账区域，商店员工引领你到一个特别的结账队伍</li>\n<li>你购买你的商品</li>\n</ul>\n<h3>手动负载均衡和路由</h3>\n<p>如果你的内容在许多数据中心或服务间共享，而我们需要路由到其中特定的一个，那么这条技术就很有用了。比如 <code>cat.jpg</code> 储存在伦敦的集群中，但其他集群中没有。相似的，<code>dog.jpg</code> 储存在纽约的集群中，其他数据中心或集群中没有。举个例子，这很可能发生在内容刚刚上传，还未在数据中心之间复制的时候。</p>\n<p>然而，用户获取内容时不应该等待复制完成。这意味着我们的应用需要临时把所有 <code>cat.jpg</code> 请求发送到伦敦，所有 <code>dog.jpg</code> 请求发送到纽约。所以我们需要用 <code>https://lon-1e.static.example.net/cat.jpg</code> 代替 <code>https://cdn.example.net/cat.jpg</code>。对 <code>dog.jpg</code> 来说也一样。</p>\n<p>为了实现这一点，我们需要为每个数据中心设置子域（最好细分到每个集群每台机器）。除了上面的 DNS 负载均衡，这一点也很有必要。</p>\n<p>注意：我们的应用需要保持追踪内容的位置，以便重写请求。</p>\n<h4>比喻：</h4>\n<ul>\n<li>你拨打公司电话询问哪个购物中心提供猫粮。</li>\n<li>你查看列表上的购物中心路线，然后选择第一个营业的。</li>\n<li>街对面有两家彼此分开却又一模一样的商店，你去哪一家完全取决于你的习惯。</li>\n<li>一旦你到达了商店，根据客户会员卡卡号有不同结账区域。举个例子，如果你的会员卡卡号是偶数，去电器区附近的结账台，否则就去食品区附近的结账台。</li>\n<li>一旦你到达正确的结账区域，商店员工引领你到一个特别的结账队伍</li>\n<li>你购买你的商品</li>\n</ul>\n<h3>任播（Anycast）</h3>\n<p>这篇文章讨论的最后一种技术就是任播。首先来看一点背景知识：</p>\n<p>大多数网路使用单播。这本质上意味着每台计算机拥有独一无二的 IP 地址。有另一种称为任播的理论。通过任播，一些机器可以使用相同的 IP 地址和路由，并把请求发送到最近的一台机器。我们可以把这种技术和上面所讲的技术结合起来，构建出高可靠性和可用性，能承载巨大通信量的系统。</p>\n<p>任播根本上来说是允许互联网为我们处理部分负载均衡。</p>\n<h4>比喻：</h4>\n<ul>\n<li>你告诉别人你打算去商店，他们把你带到最近的位置。</li>\n<li>街对面有两家彼此分开却又一模一样的商店，你去哪一家完全取决于你的习惯。</li>\n<li>一旦你到达了商店，根据客户会员卡卡号有不同结账区域。举个例子，如果你的会员卡卡号是偶数，去电器区附近的结账台，否则就去食品区附近的结账台。</li>\n<li>一旦你到达正确的结账区域，商店员工引领你到一个特别的结账队伍</li>\n<li>你购买你的商品</li>\n</ul>\n<h3>杂项</h3>\n<h4>延迟和吞吐量</h4>\n<p>顺便一提的是，这些技术也可以提升低延迟服务的吞吐量。增加服务数量而不是让每个服务处理更多的通信。这样我们就可以得到低延迟、高吞吐量的系统。</p>\n<h4>服务器直接返回</h4>\n<p>在传统负载均衡系统中，请求穿过负载均衡的所有层级，响应也同样穿过它们。降低负载均衡通信量的一个优化点就是服务器直接返回。这意味着服务端的响应不通过负载均衡。如果服务端的响应十分巨大，这点尤其有用。</p>\n\r\n        \r\n            <blockquote class=\"rewards\">\n        <p><strong>打赏支持我翻译更多好文章，谢谢！</strong></p>\n        <a href=\"#rewardbox\" id=\"rewards-button\" class=\"fancybox\"><span class=\"btn-bluet-blue href-style\"><i class=\"fa fa-jpy\"></i> 打赏译者</span></a>\n    </blockquote>\n\n    <div id=\"rewardbox\">\n        <h4>打赏支持我翻译更多好文章，谢谢！</h4>\n                <p>任选一种支付方式</p>\n                <p>\n                        <img src=\"http://jbcdn2.b0.upaiyun.com/2017/01/5085cce1bd4e144b7d148079a34b20c1.jpg\">\n            \n                            <img src=\"http://jbcdn2.b0.upaiyun.com/2017/01/02b09a29fdb3ab5fe03d4bd1afe95664.jpg\">\n                    </p>\n    </div>\n\n    \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111996\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111996votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111996\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 6 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/snowhere\">孙腾浩</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/snowhere\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2017/06/47765e50cfb7c4e598e72d893ab4f62f.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            毕业于郑州大学软件工程专业，身为 Java 程序猿却同样热爱着 JavaScript 。为了兴趣而写代码，做自己喜欢做的事。Keep coding ... Stay Cool ...        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/snowhere\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/snowhere/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/snowhere/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 16</a> · <a title=\"我的网站\" target=\"_blank\" href=\"http://snowhere.me/\"><i class=\"fa fa-link\"></i></a> <a title=\"GitHub主页\" target=\"_blank\" href=\"https://github.com/Snowhere/\"><i class=\"fa fa-github\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "post_url": "http://blog.jobbole.com/111996/", "tag_name": "IT技术，Web，负载均衡", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/03/912be8d20ca700194c3aced111cc833d1.jpg"], "url_object_id": "2e20cef128b8ada5093512d12980db03"},
{"title": "教你如何比谷歌搜索更快速有效地利用 man", "creat_time": "2017-07-30", "praise_count": "1", "bookmark_count": 2, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://opensource.com/article/17/7/using-man-pages\">Greg Pittman</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-8722-1.html\">Linux中国/toyijiu</a>   </div><blockquote><p>Linux 的帮助手册其实拥有很多有用的信息，而且比你想象中更容易使用</p></blockquote>\n<p>我们通常通过 google 来查询 Linux 中的命令说明，但是其实还有一个更好的办法：那就是通过 Linux 自带的 <strong>man 帮助页</strong>来查询命令详尽完整的使用说明。</p>\n<p>man 页面的历史本身比 Linux 还长，可以追溯到 Unix 早期那个年代。 通过<a href=\"https://en.wikipedia.org/wiki/Man_page\">这个 Wikipedia</a> 可以知道，Dennis Ritchie 和 Ken Thompson 在 1971 年写了第一个 man 帮助页，那个年代的计算器使用的还是像烤箱一样的计算机，个人电脑还未出世。man 帮助页也有它自己的一套设计精炼的语法，和 Unix 与 Linux 一样，man 帮助页也不是一成不变的，它就像 Linux 内核一样不停地发展更新。</p>\n<p>Man 帮助页通过数字标识符来分成不同类型的内容：</p>\n<ol>\n<li>一般用户命令</li>\n<li>系统调用命令</li>\n<li>库函数</li>\n<li>特殊的文件和驱动程序</li>\n<li>文件格式</li>\n<li>游戏和屏保</li>\n<li>杂项</li>\n<li>系统管理命令和守护进程</li>\n</ol>\n<p>尽管如此，用户一般也不需要知道他们想查询的命令是属于哪一个类型的。</p>\n<p>这些文件格式化的方式在当今许多用户看来有点古怪。因为最开始他们是用 <strong>trooff</strong> 的方式，通过 PostScript 打印机来打印，所以包含了头部和布局方面的格式化信息。在 Linux 中，取而代之使用了一种叫做 <a href=\"https://en.wikipedia.org/wiki/Groff_(software)\">groff</a> 的方法。</p>\n<p>在我的 Fedora 系统中，man 帮助页相关的文件存储在 <code>/usr/share/man</code> 下的子目录中（比如 <code>man1</code> 存储第一部分的命令），还有进一步的子目录用于存储 man 帮助页的翻译。</p>\n<p>如果你在 Shell 中查找 <code>man</code> 命令的 man 帮助页，你时间看到将是 gzip 工具压缩的 <code>man.1.gz</code> 文件。想要查询 man 帮助页，需要输入类似如下命令：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-597d36e61898a734288403\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nman man\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-597d36e61898a734288403-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597d36e61898a734288403-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-597d36e61898a734288403-1\"><span class=\"crayon-e\">man </span><span class=\"crayon-i\">man</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597d36e61898a734288403-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>这个例子会显示 <code>man</code> 命令的 man 帮助页，这将先解压 man 帮助页文件，然后解释格式化指令并用 <code>less</code> 显示结果，所以导航操作和在 <code>less</code> 中一样。</p>\n<p>所有的 man 帮助页都应该显示这些子段落：<strong>Name</strong>、 <strong>Synopsis</strong>、 <strong>Description</strong>、<strong>Examples</strong>、<strong>See</strong>、<strong>Also</strong>。有些还会添加一些额外的子段落，比如 <strong>Options</strong>、 <strong>Exit</strong>、<strong>Status</strong>、 <strong>Environment</strong>、<strong>Bugs</strong>、<strong>Files</strong>、<strong>Author</strong>、<strong>Reporting</strong>、<strong>Bugs</strong>、<strong>History</strong>、<strong>Copyright</strong>。</p>\n<h3 id=\"toc_1\">详细说明一个 man 帮助页</h3>\n<p>为了更详细地介绍一个典型的 man 帮助页，就用 ls 命令的帮助页来分析吧，在 <strong>Name</strong> 分段下，我们可以看到如下内容：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-597d36e618994634461689\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nls - list directory contents\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-597d36e618994634461689-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597d36e618994634461689-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-597d36e618994634461689-1\"><span class=\"crayon-v\">ls</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">list </span><span class=\"crayon-e\">directory </span><span class=\"crayon-i\">contents</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597d36e618994634461689-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>它会简要地告诉我 <code>ls</code> 这条命令的作用.</p>\n<p>在 <code>Synopsis</code> 分段下，我们可以看到如下的内容:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-597d36e618998817053937\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nls [OPTION]... [FILE]…\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-597d36e618998817053937-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597d36e618998817053937-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-597d36e618998817053937-1\"><span class=\"crayon-i\">ls</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">OPTION</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">FILE</span><span class=\"crayon-sy\">]</span>…</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597d36e618998817053937-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>任何在中括号中的元素都是可选的。你可以只输入 <code>ls</code> 命令，后面不接任何参数。参数后面的省略号表示你可以添加任意多个彼此兼容的参数，以及许多文件名。对于 <code>[FILE]</code> 参数，你可以指定具体的目录名，或者可以使用通配符 <code>*</code>，比如这个例子，它会显示 <code>Documents</code> 文件夹下的 <code>.txt</code> 文件：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-597d36e61899c494275433\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nls Documents/*.txt\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-597d36e61899c494275433-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597d36e61899c494275433-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-597d36e61899c494275433-1\"><span class=\"crayon-e\">ls </span><span class=\"crayon-v\">Documents</span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">txt</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597d36e61899c494275433-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>在 <strong>Description</strong> 分段下, 我们可以看到关于这条命令更加详细的信息，还有关于这条命令各个参数作用的详细介绍的列表，比如说 <code>ls</code> 命令第一个选项 <code>-a</code> 参数，它的作用是显示包括隐藏文件/目录在内的所有文件：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-597d36e6189a2021629752\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n-a, --all \r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-597d36e6189a2021629752-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597d36e6189a2021629752-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-597d36e6189a2021629752-1\"><span class=\"crayon-o\">-</span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-i\">all</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597d36e6189a2021629752-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>如果我们想用这些参数，要么用它们的别名，比如 <code>-a</code>，要么用它们的全名，比如 <code>--all</code>（两条中划线）。然而并不是所有参数都有全名和别名（比如 <code>--author</code> 只有一种），而且两者的名字并不总是相互关联的（<code>-F</code> 和 <code>--classify</code>）。当你想用多个参数时，要么以空格隔开，要么共用一个连字符 <code>-</code>，在连字符后连续输入你需要的参数（不要添加空格）。比如下面两个等价的例子：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-597d36e6189a6654040008\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nls -a -d -l\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-597d36e6189a6654040008-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597d36e6189a6654040008-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-597d36e6189a6654040008-1\"><span class=\"crayon-v\">ls</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">d</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">l</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597d36e6189a6654040008-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-597d36e6189a9944228786\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nls -adl\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-597d36e6189a9944228786-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597d36e6189a9944228786-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-597d36e6189a9944228786-1\"><span class=\"crayon-v\">ls</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">adl</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597d36e6189a9944228786-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>但是 <code>tar</code> 这个命令有些例外，由于一些历史遗留原因，当参数使用别名时可以不用添加连字符 <code>-</code>，因此以下两种命令都是合法的：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-597d36e6189ad997288952\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ntar -cvf filearchive.tar thisdirectory/\r\n\r\ntar cvf filearchive.tar thisdirectory/\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-597d36e6189ad997288952-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597d36e6189ad997288952-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-597d36e6189ad997288952-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597d36e6189ad997288952-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-597d36e6189ad997288952-1\"><span class=\"crayon-v\">tar</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">cvf </span><span class=\"crayon-v\">filearchive</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">tar </span><span class=\"crayon-v\">thisdirectory</span><span class=\"crayon-o\">/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597d36e6189ad997288952-2\"> </div><div class=\"crayon-line\" id=\"crayon-597d36e6189ad997288952-3\"><span class=\"crayon-e\">tar </span><span class=\"crayon-e\">cvf </span><span class=\"crayon-v\">filearchive</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">tar </span><span class=\"crayon-v\">thisdirectory</span><span class=\"crayon-o\">/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597d36e6189ad997288952-4\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p><strong>ls</strong> 的 <strong>Description</strong> 分段后是 <strong>Author</strong>、<strong>Reporting Bugs</strong>、<strong>Copyright</strong>、 <strong>See Also</strong> 等分段。</p>\n<p><strong>See Also</strong> 分段会提供一些相关的 man 帮助页，没事的话可以看看。毕竟除了命令外还有许多其他类型的 man 帮助页。</p>\n<p>有一些命令不是系统命令，而是 Bash 特有的，比如 <code>alias</code> 和 <code>cd</code>。这些 Bash 特有的命令可以在 <strong>BASH_BUILTINS</strong> man 帮助页中查看，和上面的比起来它们的描述更加精炼，不过内容都是类似的。</p>\n<p>其实通过 man 帮助页让你可以获得大量有用的信息，特别是当你想用一个已经很久没用过的命令，需要复习下这条命令的作用时。这个时候 man 帮助页饱受非议的简洁性反而对你来说是更好的。</p>\n<hr>\n<p>作者简介：</p>\n<p>Greg Pittman – Greg 是住在肯塔基州路易斯维尔的一位退休神经学家，但是却对计算机和编程保持着长久的兴趣，从二十世纪六十年代就开始捣腾 Fortran IV 了。随着 Linux 和开源软件的到来，更加激起了他去学习的兴趣并投身于这项事业中，并成为 Scribus 组织的一员。</p>\n<hr>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112016\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112016votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112016\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "post_url": "http://blog.jobbole.com/112016/", "tag_name": "IT技术，Linux", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/10/008d9c47f50ab5eac3f349d238b3b6dc.jpg"], "url_object_id": "88788cea8b7d43a9d12b07781442834c"},
{"title": "12 个 Vim 小窍门", "creat_time": "2017-07-30", "praise_count": "1", "bookmark_count": 8, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/8zjl8\">周进林</a> 翻译。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://dalibornasevic.com/posts/43-12-vim-tips\">Dalibor Nasevic</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>这篇 Vim 技巧文章，包含了一些我觉得比较有意思的从中级到高级的 Vim 技巧，让我们一起来回顾一下。</p>\n<h3>1. 重复上一次 Ex 命令</h3>\n<p>在 Vim 中有 3 种命令行模式：</p>\n<ul>\n<li>Ex 命令模式： <code>：something</code></li>\n<li>搜素 模式： <code>/something</code></li>\n<li>表达式 模式（在插入模式里输入 &lt;<code>C-r&gt;=</code> 进入）： <code>=1+1&lt;cr&gt;</code></li>\n</ul>\n<p>假如我们通过以下命令在 Ex 命令模式里运行规范文件：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-597dc47fa4832520660740\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n:!rspec spec/models/code_spec.rb</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-597dc47fa4832520660740-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-597dc47fa4832520660740-1\"><span class=\"crayon-o\">:</span><span class=\"crayon-o\">!</span><span class=\"crayon-e\">rspec </span><span class=\"crayon-v\">spec</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">models</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">code_spec</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">rb</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>我们可以在普通模式里输入 <code>@:</code> 来重复上一次 Ex 命令。</p>\n<h3>2. 对 CSS 的属性进行排序</h3>\n<p>如果我们想对 CSS 选择器里面的属性行按照字母顺序排序，我们只需要在可视化模式里选择这些属性行并且输入 <code>:sort</code> ，然后就可以看到排序后的结果。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-597dc47fa483c644663860\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nh4 {\r\n    font-size: 11px;\r\n    margin: 15px;\r\n    background: red;\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-597dc47fa483c644663860-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597dc47fa483c644663860-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-597dc47fa483c644663860-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597dc47fa483c644663860-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-597dc47fa483c644663860-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-597dc47fa483c644663860-1\"><span class=\"crayon-e\">h4</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597dc47fa483c644663860-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">font</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">size</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">11px</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-597dc47fa483c644663860-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">margin</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">15px</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597dc47fa483c644663860-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">background</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">red</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-597dc47fa483c644663860-5\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p></p>\n<h3>3. 选择复制并且粘贴文本</h3>\n<p>我们可以通过使用 <code>gv</code> 来选择上一次选择复制的文本。并且，可以使用 <code>gv</code> 来选择上一次粘贴的文本，<code>gb</code> 是一个我们已经添加到 vimrc 文件里的自定义映射。当我们进行方法重构、剪切-复制然后进行缩进对齐时，这些命令尤为好用。有了<code>gb</code> 命令，我们可以很容易地选中刚粘贴的文本，然后使用 <code>&lt;</code> 或者 <code>&gt;</code> 来修正缩进。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-597dc47fa4840517772645\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n\" select last paste in visual mode\r\nnnoremap &lt;expr&gt; gb '`[' . strpart(getregtype(), 0, 1) . '`]'</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-597dc47fa4840517772645-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597dc47fa4840517772645-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-597dc47fa4840517772645-1\">\"<span class=\"crayon-h\"> </span><span class=\"crayon-e\">select </span><span class=\"crayon-e\">last </span><span class=\"crayon-e\">paste </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">visual </span><span class=\"crayon-e\">mode</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597dc47fa4840517772645-2\"><span class=\"crayon-v\">nnoremap</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">expr</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">gb</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'`['</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">strpart</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">getregtype</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'`]'</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p></p>\n<h3>4. 在插入模式里粘贴文本</h3>\n<p>假设我们现在处于插入模式并且想在不离开插入模式的情况下粘贴文本，我们可以使用 <code>&lt;C-r&gt;0</code> 命令。如果复制的文本里包括换行符，<code>&lt;C-r&gt;&lt;C-p&gt;0</code> 命令可以帮我们处理缩进问题。</p>\n<h3>5. 在插入模式里删除</h3>\n<p>当我们处于 Vim 的插入模式、命令行模式或者 Shell 的命令行，我们可以使用以下快捷键来删除一个字符、单词或者一行：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-597dc47fa4844506641685\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&lt;C-h&gt; \" 向前删除一个字符（类似退格键）\r\n&lt;C-w&gt; \" 向前删除一个单词\r\n&lt;C-u&gt; \" 删除至行首\r\n&lt;C-k&gt; \" 删除至行尾</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-597dc47fa4844506641685-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597dc47fa4844506641685-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-597dc47fa4844506641685-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597dc47fa4844506641685-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-597dc47fa4844506641685-1\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">C</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">h</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\" 向前删除一个字符（类似退格键）</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597dc47fa4844506641685-2\"><span class=\"crayon-s\">&lt;C-w&gt; \"</span><span class=\"crayon-h\"> </span>向前删除一个单词</div><div class=\"crayon-line\" id=\"crayon-597dc47fa4844506641685-3\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">C</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">u</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\" 删除至行首</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597dc47fa4844506641685-4\"><span class=\"crayon-s\">&lt;C-k&gt; \"</span><span class=\"crayon-h\"> </span>删除至行尾</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p></p>\n<h3>6. 多行范围内运行正常模式命令</h3>\n<p>假设我们忘了给以下的 Javascript 代码行的行尾添加 <code>;</code>：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-597dc47fa4847015356425\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nvar element = $(this)\r\nvar tabName = element.data('tab')\r\nvar report = element.data('report')</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-597dc47fa4847015356425-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597dc47fa4847015356425-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-597dc47fa4847015356425-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-597dc47fa4847015356425-1\"><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">element</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597dc47fa4847015356425-2\"><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tabName</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">element</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">data</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'tab'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-597dc47fa4847015356425-3\"><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">report</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">element</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">data</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'report'</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p>要给每一行添加分号，我们可以在可视化模式里选中这3行代码，然后运行 <code>:normal A;</code>命令。Vim 会在选中的每一行中执行 <code>A;</code> 命令（添加<code>;</code>的命令）。我们也可以使用另外一种方式，我们可以对整个文件的内容使用 <code>:%normal A;</code> 命令。</p>\n<h3>7. 在多行上重复最后一次修改</h3>\n<p>在上面的代码片段中，如果我们只在第一行上面使用<code>A;</code> 命令向行尾添加<code>;</code>。我们可以选择2到3行的代码并且运行 <code>:'&lt;,'&gt; normal .</code>命令，为选中的每一行执行点号命令（dotcommand）重复上一次修改命令。</p>\n<h3>8. 在多个文件中执行替换</h3>\n<p>在 Vim 中，对多个文件执行替换操作并不是一个直观的操作。要在多个文件里进行搜索和替换，首先我们需要创建一个文件列表，之后在这些文件里面执行命令。我们可以使用 <code>:args</code> 命令来创建文件列表。例如，加载所有以“ext”开头的 Javascript 文件：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-597dc47fa484b684397864\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n:args app/assets/javascripts/ext*.js</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-597dc47fa484b684397864-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-597dc47fa484b684397864-1\"><span class=\"crayon-o\">:</span><span class=\"crayon-e\">args </span><span class=\"crayon-v\">app</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">assets</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">javascripts</span><span class=\"crayon-o\">/</span><span class=\"crayon-e \">ext*</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">js</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>我们可以通过<code>:args</code>命令来查看有哪些文件被加载到参数列表中。当文件都加载到参数列表中后，我们可以运行搜索和替换命令：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-597dc47fa484e997217128\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n:argdo %s/From/To/g</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-597dc47fa484e997217128-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-597dc47fa484e997217128-1\"><span class=\"crayon-o\">:</span><span class=\"crayon-v\">argdo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-v\">s</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">From</span><span class=\"crayon-o\">/</span><span class=\"crayon-st\">To</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">g</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>一旦修改应用到文件后，我们可以通过以下命令来更新参数列表中的文件：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-597dc47fa4852714890604\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n:argdo update</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-597dc47fa4852714890604-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-597dc47fa4852714890604-1\"><span class=\"crayon-o\">:</span><span class=\"crayon-e\">argdo </span><span class=\"crayon-v\">update</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p></p>\n<h3>9. 在多个文件中进行搜索和替换</h3>\n<p>当我们知道要执行替换命令的文件在那的情况下，之前的替换技巧会很有用。但是，在大多数情况下，我们想要的是，在一堆文件里搜索文本并且仅在匹配的文件里执行替换命令。要实现这个替换操作，我们可以使用<code>vimgrep</code> 命令在文件中搜索匹配的文本。<code>vimgrep</code> 命令会创建一个快速列表（quicklist）来展示包含与模式匹配的文本的文件列表，我们可以使用 <code>:copen</code> 命令来打开这个列表。如果我们想充分利用好快速列表（quicklist)，我们可以使用 <code>:Qargs</code> 命令把快速列表转换为参数列表， <code>:Qargs</code> 命令是我们在 vimrc 文件里设置的一个映射：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-597dc47fa4855792503026\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ncommand! -nargs=0 -bar Qargs execute 'args' QuickfixFilenames()\r\n\r\n\" populate the argument list with each of the files named in the quickfix list\r\nfunction! QuickfixFilenames()\r\n  let buffer_numbers = {}\r\n  for quickfix_item in getqflist()\r\n    let buffer_numbers[quickfix_item['bufnr']] = bufname(quickfix_item['bufnr'])\r\n  endfor\r\n  return join(map(values(buffer_numbers), 'fnameescape(v:val)'))\r\nendfunction</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-597dc47fa4855792503026-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597dc47fa4855792503026-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-597dc47fa4855792503026-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597dc47fa4855792503026-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-597dc47fa4855792503026-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597dc47fa4855792503026-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-597dc47fa4855792503026-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597dc47fa4855792503026-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-597dc47fa4855792503026-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597dc47fa4855792503026-10\">10</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-597dc47fa4855792503026-1\"><span class=\"crayon-v\">command</span><span class=\"crayon-o\">!</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">nargs</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">bar </span><span class=\"crayon-e\">Qargs </span><span class=\"crayon-i\">execute</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'args'</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">QuickfixFilenames</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597dc47fa4855792503026-2\"> </div><div class=\"crayon-line\" id=\"crayon-597dc47fa4855792503026-3\">\"<span class=\"crayon-h\"> </span><span class=\"crayon-e\">populate </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">argument </span><span class=\"crayon-e\">list </span><span class=\"crayon-e\">with </span><span class=\"crayon-st\">each</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">of </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">files </span><span class=\"crayon-e\">named </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">quickfix </span><span class=\"crayon-e\">list</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597dc47fa4855792503026-4\"><span class=\"crayon-t\">function</span><span class=\"crayon-o\">!</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">QuickfixFilenames</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-597dc47fa4855792503026-5\"><span class=\"crayon-h\">  </span><span class=\"crayon-e\">let </span><span class=\"crayon-v\">buffer_numbers</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597dc47fa4855792503026-6\"><span class=\"crayon-h\">  </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">quickfix_item </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getqflist</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-597dc47fa4855792503026-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">let </span><span class=\"crayon-v\">buffer_numbers</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">quickfix_item</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'bufnr'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bufname</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">quickfix_item</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'bufnr'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597dc47fa4855792503026-8\"><span class=\"crayon-h\">  </span><span class=\"crayon-st\">endfor</span></div><div class=\"crayon-line\" id=\"crayon-597dc47fa4855792503026-9\"><span class=\"crayon-h\">  </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">join</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">map</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">values</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">buffer_numbers</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'fnameescape(v:val)'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597dc47fa4855792503026-10\"><span class=\"crayon-v\">endfunction</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0021 seconds] -->\r\n<p>最后， 下面是一个在多个文件中进行搜索和替换的操作命令：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-597dc47fa4859718625141\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n:vimgrep /CurrencyNumberHelper/ app/models/*.rb\r\n:Qargs\r\n:argdo %s/CurrencyNumberHelper/CurrencyHelper/g\r\n:argdo update</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-597dc47fa4859718625141-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597dc47fa4859718625141-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-597dc47fa4859718625141-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597dc47fa4859718625141-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-597dc47fa4859718625141-1\"><span class=\"crayon-o\">:</span><span class=\"crayon-v\">vimgrep</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">CurrencyNumberHelper</span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">app</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">models</span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">rb</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597dc47fa4859718625141-2\"><span class=\"crayon-o\">:</span><span class=\"crayon-v\">Qargs</span></div><div class=\"crayon-line\" id=\"crayon-597dc47fa4859718625141-3\"><span class=\"crayon-o\">:</span><span class=\"crayon-v\">argdo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-v\">s</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">CurrencyNumberHelper</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">CurrencyHelper</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">g</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597dc47fa4859718625141-4\"><span class=\"crayon-o\">:</span><span class=\"crayon-e\">argdo </span><span class=\"crayon-v\">update</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>buztard 在评论里提出一个更简单的方法，使用 ack-grep 来创建参数列表：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-597dc47fa485c952422558\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n:args `ack-grep -l CurrencyNumberHelper`\r\n# or, if you're using Ack plugin, then just :Ack CurrencyNumberHelper\r\n:argdo %s/CurrencyNumberHelper/CurrencyHelper/g\r\n:argdo update</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-597dc47fa485c952422558-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597dc47fa485c952422558-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-597dc47fa485c952422558-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597dc47fa485c952422558-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-597dc47fa485c952422558-1\"><span class=\"crayon-o\">:</span><span class=\"crayon-i\">args</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">ack</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">grep</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">CurrencyNumberHelper</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597dc47fa485c952422558-2\"><span class=\"crayon-p\"># or, if you're using Ack plugin, then just :Ack CurrencyNumberHelper</span></div><div class=\"crayon-line\" id=\"crayon-597dc47fa485c952422558-3\"><span class=\"crayon-o\">:</span><span class=\"crayon-v\">argdo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-v\">s</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">CurrencyNumberHelper</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">CurrencyHelper</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">g</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597dc47fa485c952422558-4\"><span class=\"crayon-o\">:</span><span class=\"crayon-e\">argdo </span><span class=\"crayon-v\">update</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p>如果你使用<a href=\"https://github.com/vim/vim/commit/aa23b379421aa214e6543b06c974594a25799b09\">版本比较新的 Vim</a>， 这个操作会更简单。正如 Thiago A. z 在评论里提出的方法，你可以简单地使用 <code>cdo</code> 和 <code>cfdo</code> 命令即可：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-597dc47fa485f125922622\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n:Ack CurrencyNumberHelper\r\n:cfdo s/CurrencyNumberHelper/CurrencyHelper/g | update</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-597dc47fa485f125922622-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597dc47fa485f125922622-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-597dc47fa485f125922622-1\"><span class=\"crayon-o\">:</span><span class=\"crayon-e\">Ack </span><span class=\"crayon-v\">CurrencyNumberHelper</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597dc47fa485f125922622-2\"><span class=\"crayon-o\">:</span><span class=\"crayon-i\">cfdo</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">CurrencyNumberHelper</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">CurrencyHelper</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">g</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">update</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p></p>\n<h3>10. 编辑已经录制的宏</h3>\n<p>在录制宏的过程中经常会出现误操作，当出现出现误操作时，对已录制的宏进行编辑比重新录制更简单方便。假设我们录制了一个宏到寄存器a里，我们可以使用 <code>:put a</code> 命令把宏的内容打印到当前的缓冲区里，然后在 Vim 里对这个宏进行编辑。一旦对宏的内容进行了修改，我们可以选择修改后的宏并且使用 <code>\"ay</code> 命令把它复制到寄存器<code>a</code>中。之后我们就可以使用 <a href=\"http://www.jobbole.com/members/a58797\"><code>@a</code></a> 命令运行寄存器 a 中的新宏。</p>\n<h3>11. 在多个文件里运行宏</h3>\n<p>如果我们已经录制了宏，并且想在某些文件里运行它。首先，我们需要使用这些文件来建立一个参数列表。比如我们需要加载一个 Rails 应用的所有 model：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-597dc47fa4863547063400\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n:args app/models/*.rb</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-597dc47fa4863547063400-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-597dc47fa4863547063400-1\"><span class=\"crayon-o\">:</span><span class=\"crayon-e\">args </span><span class=\"crayon-v\">app</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">models</span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">rb</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>然后我们使用以下命令老来运行宏（这个宏已经录制保存在寄存器 a1a 中）：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-597dc47fa4866394007613\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n:argdo normal @a1a</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-597dc47fa4866394007613-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-597dc47fa4866394007613-1\"><span class=\"crayon-o\">:</span><span class=\"crayon-e\">argdo </span><span class=\"crayon-i\">normal</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">a1a</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>最后，我们使用下面命令来保存所有缓冲区的修改：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-597dc47fa4869714416030\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n:argdo update</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-597dc47fa4869714416030-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-597dc47fa4869714416030-1\"><span class=\"crayon-o\">:</span><span class=\"crayon-e\">argdo </span><span class=\"crayon-v\">update</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p></p>\n<h3>12. 命令行中的 Vi 模式</h3>\n<p>Bash shell 提供了两种命令行编辑模式：emacs 和 vi 模式。emacs 编辑模式是命令行的默认模式，我们可以使用以下命令来把命令行的编辑模式改为 vi 模式：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-597dc47fa486c236075274\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nset -o vi</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-597dc47fa486c236075274-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-597dc47fa486c236075274-1\"><span class=\"crayon-v\">set</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">o</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">vi</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>然后我们就可以在命令行模式里使用 ESC 键来进入 vi 的编辑模式，并且可以使用 vi 文本行编辑能力。当我们在命令行里处于 vi 编辑模式时，我们可以使用 v 键弹出编辑器，我们在里面编辑保存的命令会直接在命令行里运行。这是一个很赞的功能， 你觉得呢？:)</p>\n<p>如果我们需要返回 emacs 模式，打印一下命令即可：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-597dc47fa4870174375477\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nset -o emacs</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-597dc47fa4870174375477-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-597dc47fa4870174375477-1\"><span class=\"crayon-v\">set</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">o</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">emacs</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>这里有一张<a href=\"http://www.catonmat.net/download/bash-vi-editing-mode-cheat-sheet.txt\">速查表</a>，记录了在 bash shell 中使用 vi 模式的可用命令。</p>\n<p>在寻找更多的 Vim 技巧？ 可以查看作者的 <a href=\"http://github.com/dalibor/vimfiles\">vimfiles</a>，还有《<span data-rel=\"title\"><a class=\"archive-title\" title=\"25个Vim教程、视频和资源\" href=\"http://blog.jobbole.com/10250/\" target=\"_blank\">25个Vim教程、视频和资源</a>》和</span>《<a class=\"archive-title\" title=\"提高 Vim 使用效率的 12 个技巧\" href=\"http://blog.jobbole.com/87481/\" target=\"_blank\"><span data-rel=\"title\">提高 Vim 使用效率的 12 个技巧</span></a>》。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111962\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111962votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111962\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 8 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/8zjl8\">周进林</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/8zjl8\">\r\n\t\t\t<img src=\"http://www.jobbole.com/wp-content/uploads/avatars/37626/5eae1c6800ce93c5d98ee059843e9513-bpfull.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            茫茫大海中的一枚程序猿，为了进化为一个高富帅人类而努力着。关注java、python、linux、vim等（新浪微博：@酒肉和尚--进林）        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/8zjl8\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/8zjl8/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/8zjl8/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 19</a> · <a title=\"我的网站\" target=\"_blank\" href=\"http://www.cnblogs.com/averey/\"><i class=\"fa fa-link\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "post_url": "http://blog.jobbole.com/111962/", "tag_name": "IT技术，Vim", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2012/04/vim-logo.png"], "url_object_id": "2b1036895b39d2a1adc98e369b2c901b"},
{"title": "小王子之程序员版", "creat_time": "2017-07-30", "praise_count": "5", "bookmark_count": 5, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/huangxiaofei\">黄小非</a> 翻译。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"http://ferd.ca/the-little-printf.html\">Fred Hebert</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>【伯乐在线提示】：本文较长，Fred Hebert 仿照《小王子》小说，写了一个小程序员在学习软件开发中的各种历险，分了 11 个小故事。正如读者 lei 的评论所言：所有程序员都是文中这些人的缩影。</p>\n<p>补充：《小王子》是法国作家安托万·德·圣·埃克苏佩里于 1942 年写成的著名儿童文学短篇小说。本书的主人公是来自外星球的小王子。书中以一位飞行员作为故事叙述者，讲述了小王子从自己星球出发前往地球的过程中，所经历的各种历险。</p>\n<p> </p>\n<p> </p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/06/3b102356e4b2e8b92940143a3a70bed0.png\"><img class=\"aligncenter size-full wp-image-65334\" src=\"http://jbcdn2.b0.upaiyun.com/2017/06/3b102356e4b2e8b92940143a3a70bed0.png\" alt=\"printf-nocover\" width=\"387\" height=\"424\"></a></p>\n<h3>第 0 章</h3>\n<p>我出生在电子游戏和电脑泛滥年代之前。所以我还算幸运，有足够的时间和我哥，还有小伙伴们一起做户外运动，还发明我们自己的游戏。</p>\n<p>我们自己扮演英雄，拿着一根树枝，我们就能瞬间把它想象成弓、剑、枪，甚至是望远镜，当然也可以是任何其他东西。哦，对了，唯一的例外就是你不能把它想象成回旋镖，因为真的回旋镖扔出去是会自己飞回来的，但是树枝扔出去了，你要自己去捡回来。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/06/f0a415ae533c3befdffdf1b417a054ae.png\"><img class=\"aligncenter size-full wp-image-65343\" src=\"http://jbcdn2.b0.upaiyun.com/2017/06/f0a415ae533c3befdffdf1b417a054ae.png\" alt=\"boomerang\" width=\"356\" height=\"230\"></a></p>\n<p>后来我们就长大了，再这么玩就有些尴尬了。要知道，在孩子们开始觉得大人的世界很精彩的阶段，你要是再玩那些把松果想象成魔法手榴弹的游戏，这就很不合群了。迟早你要面对成长的烦恼。不过，能有一个完整的童年还是很幸运。</p>\n<p>后来我就开始学会玩电子游戏了，当然也开始使用电脑。电子游戏的世界可绝对是你梦寐以求的世界，因为它能把你想象中的东西在你面前实现出来。玩游戏很消耗时间，但是它绝对会让你体验到不同的人生。</p>\n<p>不过对于电子游戏来说，有一个特点：那就是你不负责创造，你只负责响应和付出时间。我长到青少年的岁数，还当过即兴表演的演员。所以说，无论是与人相处，还是装作旁若无人，这对我都不是问题。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/06/c0d8cbc8c759f27640821750644a554c.png\"><img class=\"aligncenter size-full wp-image-65339\" src=\"http://jbcdn2.b0.upaiyun.com/2017/06/c0d8cbc8c759f27640821750644a554c.png\" alt=\"improv\" width=\"360\" height=\"289\"></a></p>\n<p>当然，在魁北克做即兴表演还是有点儿不同寻常，因为我们是在溜冰场地上表演——你知道冰球在加拿大多火吗。</p>\n<p>后来我去了职业学校学习多媒体，大概是 2005 年到 2008 年这个时段，我终究还是要做些编程的事情。不过我发现编程是个有意思的事情！我又感觉到了创造性！并且我还能靠这个赚钱！于是我设计了我的第一套游戏，这可让我受益匪浅。<a href=\"http://jbcdn2.b0.upaiyun.com/2017/06/2f5fe97ea19c4f50e42da989f216c5ea.png\"><img class=\"aligncenter size-full wp-image-65337\" src=\"http://jbcdn2.b0.upaiyun.com/2017/06/2f5fe97ea19c4f50e42da989f216c5ea.png\" alt=\"game\" width=\"472\" height=\"400\"></a></p>\n<p>不过后来又有人告诉我：“你做的并不是真正的电子游戏。你做的只是一个 HTML 表单。而且你做的时候应该用数组来表示文字和选项，这样效果会更好。你写的代码应该更整洁一些。”</p>\n<p>我对这个评价觉得有点儿沮丧。我做的这个游戏是一个基于文字的游戏，文字大概有 11 页，通过选择来“进行你的冒险”。不过我意识到，如果想让大家对我做的东西更加满意，我还有很多东西要学。</p>\n<p>我应该学一些“真正的编程知识”。于是我从基于JScript 的 GUI 工具跳到了一些更牛的东西上面，例如 PHP。我学了 PHP，同时也学了 JavaScript。可是后来，我听说这些还是不行，我还得学一些“真正的编程知识”。别人跟我说，PHP 不行，我应该学的是 Python，当然后来我真的去学了。</p>\n<p>不过“真正的程序员”还会一些更时髦的东西，Python 的 Lambda 可到不了那个逼格，而且面向对象编程模式简直就是弱爆了。人家告诉我说，我应该去读一读 SICP，毕竟这是计算机科学的圣经嘛。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/06/88196eec64f6b673f4e1ce9ebe35eb80.png\"><img class=\"aligncenter size-full wp-image-65349\" src=\"http://jbcdn2.b0.upaiyun.com/2017/06/88196eec64f6b673f4e1ce9ebe35eb80.png\" alt=\"sicp\" width=\"309\" height=\"456\"></a></p>\n<p>然后我就接触了 Scheme。我还买了 Brian Kernighan 和 Dennis Ritchie<i><i class=\"01\"> </i></i>合写的《The C Programming Language》，因为真正的程序员就是要用 C 语言写程序的嘛。我还在本地大学报了一个业余班去上课，同时我还得去上班，因为真正的程序员都是很懂数学和算法的嘛，所以我也得学。我开始读论文，看书，因为真正的程序员在算法这件事情上肯定是与时俱进的啊。</p>\n<p>后来，我学了 Erlang 语言，而且还靠这门语言找了份工作。我写了一本 Erlang 的书。不过有意思的是，从来没人问过我是不是这本书的作者？我还有没有写其他的书？或者书里的图是不是我画的？好吧，我找到了一份教 Erlang 语言的工作，但是却从来没有在生产环境中用过这门语言。</p>\n<h3>第 1 章</h3>\n<p>我就这样一直在全世界飞来飞去，教给别人一些连我自己都没有做过的事情，结果突然之间大家就觉得我也是真正的程序员了。要知道我的工作一开始和写程序是没什么关系的。</p>\n<p>有一天，我参加完某个技术会议回家，然后被滞留在机场了，正当我气急败坏地在电脑上打字的时候，突然听到了一个奇怪的，但是很绅士的声音对我说：</p>\n<p>“能帮我设计一个系统吗？”</p>\n<p>“啥？”</p>\n<p>“设计一个系统！“</p>\n<p>我被这个请求惊呆了，于是抬起了头。我环顾四周，看到了一个小孩，他非常希望成为一名程序员，然后他说我可以叫他”printf”，当然，我觉得这肯定不是他的真名，而且这个名字也挺蠢的。他看上去长得这个样子：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/06/e91da181fb13d148dcb5b74e34579a96.png\"><img class=\"aligncenter size-full wp-image-65333\" src=\"http://jbcdn2.b0.upaiyun.com/2017/06/e91da181fb13d148dcb5b74e34579a96.png\" alt=\"printf-end\" width=\"393\" height=\"423\"></a></p>\n<p><q class=\"printf\"></q>”我不是很懂电脑，但是看上去你很懂。我想写一个博客程序给大家用，然后还想让大家阅读这个博客。所以麻烦你帮我写一个系统吧。”</p>\n<p>这可是一个让人吃惊的请求，可能是因为我已经 20 个小时没睡觉的原因，我还不是很理解，或者说我感觉还是很不真实。我跟他说，这可不是简单的事情。我不太清楚他到底要做什么？有没有考虑过失败了怎么办？这个博客要支持多少人同时在线阅读呢？服务器的主机放在哪儿呢？在缺乏这么多信息的前提下，我是没法设计一个合理系统的。</p>\n<p>“这些都不重要。就给我设计一个系统就好。”</p>\n<p>好吧，那么我就画了一个系统的架构图：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/06/23bf341a92d7e72309b27ca82f202995.png\"><img class=\"aligncenter size-full wp-image-65347\" src=\"http://jbcdn2.b0.upaiyun.com/2017/06/23bf341a92d7e72309b27ca82f202995.png\" alt=\"arch1\" width=\"467\" height=\"251\"></a></p>\n<p>他看了看，然后说：“不行，这个系统还不够好。给我再做一个吧。“</p>\n<p>然后我就又做了一个：<br>\n<a href=\"http://jbcdn2.b0.upaiyun.com/2017/06/b9b614d4b48593d53f73e56f015f79d1.png\"><img class=\"aligncenter size-full wp-image-65346\" src=\"http://jbcdn2.b0.upaiyun.com/2017/06/b9b614d4b48593d53f73e56f015f79d1.png\" alt=\"arch2\" width=\"583\" height=\"337\"></a></p>\n<p>接着我跟他简要解释了一下这个系统是如何工作的。</p>\n<p>我的新朋友礼貌地笑了笑，说：”这不是我要的系统，它太复杂了，好多功能我其实都不需要。“</p>\n<p>我听了感觉气不打一处来啊，我可是考虑了冗余、系统监控、备份、缓存还有很多其他的机制，来降低负载，减轻额外的处理器负担，并且还能对系统进行有效保护，失效备援，易于部署等等。要知道，如果平时我给人拿出这种方案，那可是要收咨询费的！好吧我失去耐心了，然后我就画了下面这个图：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/06/ed300d72e9e18a9845bd8da8da96cae3.png\"><img class=\"aligncenter size-full wp-image-65344\" src=\"http://jbcdn2.b0.upaiyun.com/2017/06/ed300d72e9e18a9845bd8da8da96cae3.png\" alt=\"blackbox\" width=\"188\" height=\"176\"></a></p>\n<p>然后我还补充说：“这就是你要的设计。你要的系统就在这个黑盒子里。”我希望这个设计方案能让他放过我。不过我听到了一句非常意外的回答：</p>\n<p>“没错！这就是我要的系统！”</p>\n<p>这就是我和小 printf 初识的故事。</p>\n<h3>第 2 章</h3>\n<p>我迅速地对小 printf 做了点调查。发现他之前写的东西都是些小程序，基于表单的小网页，还有一些无关紧要的命令行工具。这些东西平淡无奇，就算是做出来了也很快会被人忘记。</p>\n<p>然后突然之间，他就开始做包含好几个模块的大项目了。这个项目要用到 sockets，要能访问本地硬盘，而且还要和数据库交互。程序刚一做出来的时候，小 printf 还觉得很神奇。但是即便如此这个项目还是差强人意。</p>\n<p>这个项目还需要重构，需要更细致的测试，需要更完备的文档，需要更好的包装和分析。项目上线已本来应该正常运行，但是某一天早上，它崩溃了。</p>\n<p>接下来就是各种崩溃，崩了又崩。</p>\n<p>系统配置不对，日志界面也不再滚动，磁盘速度忽快忽慢，网络不定时抽风，bug 开始各种出现，系统编码也让人匪夷所思，数据库需要清理，事务也被挂起，证书过期，各种漏洞开始暴露，系统监测则什么动静也没有。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/06/2a137d24c99e91c1d8b1d4fee8b313bb.png\"><img class=\"aligncenter size-full wp-image-65350\" src=\"http://jbcdn2.b0.upaiyun.com/2017/06/2a137d24c99e91c1d8b1d4fee8b313bb.png\" alt=\"spaghetti\" width=\"243\" height=\"143\"></a></p>\n<p>系统开始变成一锅粥了。</p>\n<p>他对我说：“事实上我什么都不懂！我本应根据我的需求来做判断的。我太想做一个完美的系统，花了这么多的时间，结果却是‘磨刀误了砍柴功’。当然，我还是知道这个系统的美妙之处的。“</p>\n<p>于是一天早晨，他决定离开办公室。他对着一大堆电脑指示灯说了「再见」。他离开是为了要看看，除了他那乱糟糟的服务器之外，软件的世界还能给他提供些什么好办法来实现他的系统。</p>\n<p>如果照现在的情况，只会是日志继续不停地累计，直到硬盘存爆了为止。</p>\n<h3>第 3 章</h3>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/06/72c115153857d62127329f76d4615d75.png\"><img class=\"aligncenter size-full wp-image-65342\" src=\"http://jbcdn2.b0.upaiyun.com/2017/06/72c115153857d62127329f76d4615d75.png\" alt=\"building\" width=\"394\" height=\"281\"></a></p>\n<p>他来到了一个工作区，想找个经验丰富的人指点迷津。</p>\n<p>他找的第一个人是一个超级自信的高级工程师，他看上去地位很高的样子。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/06/e71c20866e199431e56c0e63c09a7c93.png\"><img class=\"aligncenter size-full wp-image-65335\" src=\"http://jbcdn2.b0.upaiyun.com/2017/06/e71c20866e199431e56c0e63c09a7c93.png\" alt=\"pro\" width=\"362\" height=\"425\"></a><q class=\"other\"></q>”啊，来向我取经啊！你可找对人了，我可是这个领域的专家！“这个人说。</p>\n<p>”专家？”小 printf 问到，”这就是说你什么程序都能写，什么程序都会写？“</p>\n<p>”那当然！“专家回答到。他补充说：”总的来说，我只写那些值得写的程序。我可不写那些没意义的东西。我能写但不写的那些程序，都是因为太简单，所以不劳我动手。“</p>\n<p>”啊，那你能帮我看一下我的系统吗？”就在小 printf 开始阐述他的系统的时候，这位专家打断了他：</p>\n<p>“抱歉，我真心觉得这么做没什么意义。”</p>\n<p>“为什么？”</p>\n<p>“因为经验。我善于编写我善于的程序，我给我善于编写的东西编程。我要严格限制我只做我擅长做的事情，这样才能变得更好。我管这个叫做‘职业安全’，这就是程序界的适者生存原理，而且这一行就是这么玩的。“</p>\n<p>”那你为什么不能帮我呢？“</p>\n<p>”好吧，你看，如果我花时间帮助了你，那么我就会让我的技术自我投资的方向发生分散和偏离——这对我来说是失策。对于你来说，最好的学习方法就是我当年做的那样：通过痛苦的努力来找到解决的办法。这有助于锻造你的个性。“</p>\n<p>”但是这样效率好低。“</p>\n<p>”好吧那你就去学校学，你也可以自学。但是无论哪种做法，都只是把那些想不劳而获的懒人踢出去，让真正愿意踏实学习的人留下来。如果不是这样的话，那我坚持恪守的价值观就会随之崩溃。“</p>\n<p>”那你觉得跟人合作，或者是你的同事能不能帮助你？“</p>\n<p>”并不能。我工作状态最好的时候其实是我一个人独自待着而且没人打扰的时候。每次我被迫和别人一起工作的时候，几乎可以肯定我们做的东西没法凑到一起。最后只能是我怒了，然后把他们写的东西又自己重新再写一遍，然后这才能行。“</p>\n<p>小 printf 对这个专家不愿帮助别人的态度感到非常意外，而且也对专家描述的周围的人能力如此之差感到很困惑。专家把自己的全部视野只集中在自己擅长的领域，只解决自己能解决的问题，这听上去有点儿悲哀。</p>\n<p>”我明白了…我觉得你别给我帮助的话就最好了。“ 小 printf 说到。</p>\n<p>”你什么意思？“自带高大上光环的专家似乎感到了自己的价值观受到了挑战。”你是说我的做的工作毫无趣味可言吗？“</p>\n<p>”哦，并不是，你做的工作很有趣。不过从你的眼光中看来，我只是一个烦躁而讨厌的家伙。我是来寻求帮助的，不是来找罪受的。“</p>\n<p>小 printf 迅速地离开了这个专家，因为他明白，除非你在他的”职业安全“范围之内，否则根本就不能碰他。</p>\n<h3>第 4 章</h3>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/06/1ca156937bc6ffd234324776df20998e.png\"><img class=\"aligncenter size-full wp-image-65361\" src=\"http://jbcdn2.b0.upaiyun.com/2017/06/1ca156937bc6ffd234324776df20998e.png\" alt=\"books\" width=\"461\" height=\"360\"></a></p>\n<p>在继续寻找帮助的路上，小 printf 来到了一个办公室的的门口，办公室里四面都是书架，书架上放着装帧优美的硬皮书，书上有各式各样的精美图画，一个人坐在办公室里面。</p>\n<p>“先生你的书真不错啊“小 printf 说。</p>\n<p>”谢谢！我觉得这些书都是程序员必备的材料。如果你没有这些书，你都不好意思跟人家说你是真正的程序员。“</p>\n<p>”啊，那我觉得我可能就不算是真正的程序员了“，小 printf 说，”那你最喜欢哪本书呢？“</p>\n<p>”哦，大部分书我还没看过呢。“</p>\n<p>”那你不是个优秀的程序员咯？“</p>\n<p>”啊不，我不是。“这个开发者骄傲地补充到：”实际上，我是个糟糕的程序员。“</p>\n<p>”真遗憾，“，小 printf 说，”我可是不断在进步呢。“</p>\n<p>“你听说过 Dunning-Kruger 效应没？”，房间中的人问到。</p>\n<p>“没有，那是个啥玩意儿？”</p>\n<p>“就是一种认知偏差。它的意思大概就是说，那些能力不太强的人更容易高估自己，而能力很强的人更容易低估自己。”</p>\n<p>“所以按照你的意思，如果我认为我在进步，其实是因为我不够好造成的？”</p>\n<p>“是啊，就是这个意思。很可能就是你其实能力不强。而我，我公开声称自己是一个糟糕的程序员。但是根据 Dunning-Kruger 效应，我很可能是在低估我自己，这就意味着我其实是一个很棒的程序员，你还不明白吗？”</p>\n<p>“为什么会这样？”</p>\n<p>“那是因为自黑是程序员的一大法宝。当你自我感觉良好的时候，你实际上已经停滞不前了。”</p>\n<p>“但是这样一来不就意味着，一旦你自己感觉不错的时候，你就开始走下坡路了，所以你应该让自己感觉糟糕起来吗？”</p>\n<p>“对的。但是这件事情正确的做法是，你要对任何东西都说很糟糕，即便是你不知道怎么解决问题也要这么说。这样就能让你看上去很聪明，而且又并不用真的做什么。“</p>\n<p>”能具体解释一下么？“</p>\n<p>”比如我在网上看到了一个让我不爽的项目。然后我就说这个项目所有的地方都不对，但是又并不具体说哪儿不对。我只需要轻描淡写地说，因为做这个项目的人本身就是个白痴，就这样就可以了。“</p>\n<p>“但是你这么说，别人怎么会信呢？”</p>\n<p>“哈哈，我觉得他们都愿意相信他们做错了，而且他们也愿意让别人指出来。这就有点儿像烟雾或者镜子。实际上没人知道自己做的东西是啥样，他们只能知道自己做的东西看上去是啥样。”</p>\n<p>“那么如果他们说他们没法解决问题，让你来帮他们的话，那你怎么办？“</p>\n<p>”这样的话就又回到了一切事情都很糟糕的那个问题；你就说你很忙，有很多事情要做，然后你还很悲观。这样的话，他们就只能靠他们自己了。“</p>\n<p>”所以说这一切都只是摆个姿态而已？这对你来说只是一个套路？你懂的时候装作不懂，是为了让真正啥都不懂的人失去信心，你不懂的时候装懂，是为了让真正懂的人感觉糟糕。“</p>\n<p>”在大多数情况下，有能力没什么用。只有名声才是最重要的。老板招人的时候喜欢招自己的朋友，公司裁人的时候不招人喜欢的和不被重视的人会先被裁。这就是规则。如果你想改变社会的规则，你就会成为异类。这就是套路。业界就是这么运作的，学术界也大致如此，尽管这些都是潜规则，但是我还是都看出来了。一切都取决于你认识谁，如何推销自己，如果经营你的个人品牌。只有这样你才能在业界拥有一席之地。“</p>\n<p>”如果我必须要觉得自己很糟糕，而且还得让别人觉得很糟糕，这样才能找到工作的话，那我想还是算了。“小 printf 说完就走开了。</p>\n<h3>第 5 章</h3>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/06/27adece4ab9b8ec687df066fb64d100a.png\"><img class=\"aligncenter size-full wp-image-65348\" src=\"http://jbcdn2.b0.upaiyun.com/2017/06/27adece4ab9b8ec687df066fb64d100a.png\" alt=\"realprog\" width=\"489\" height=\"488\"></a></p>\n<p>接下来就是午餐时间了，printf打断了一个全神贯注工作忘记吃午饭的人，他一直盯着屏幕，饭都已经凉了。</p>\n<p>工作这么忙碌的人应该很擅长软件行业。于是小 printf 问到：</p>\n<p>”如果主数据库崩溃了，那从数据库也会崩溃么？“</p>\n<p>”你运行的一切东西。“这个忙碌的人回答说，”迟早都会崩溃的。“</p>\n<p>”那么那些告诉你程序崩溃的程序呢？它们也会崩溃么？“</p>\n<p>”是的，它们也会崩溃。所有的大型系统在任意时刻都处在某种部分崩溃的状态。“</p>\n<p>”那么，我们搭建可靠系统（reliable system）的意义在哪儿呢？“</p>\n<p>这个忙碌的人不知道，他也在思考同样的问题，因为就在此时，他们又接到了一个问题，说是一朵云坏掉了，造成了天空塌下来砸到了头上。</p>\n<p>”那么，搭建可靠系统的意义到底在哪儿呢？“小 printf 追问到。</p>\n<p>这个忙碌的人此时一脸的不爽，一看就是在工作遇到问题的样子。他就像一个放了学被留下来不让走的孩子，而且他的三明治显然是废了。他很不耐烦地大声回答说：</p>\n<p>“显然没有任何意义。因为程序本身就是一坨屎。”</p>\n<p>“噢！”他倒抽了一口气。</p>\n<p>接下来，就是一段完全的沉默。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/06/3b7432892c1dbafb839a60491ad99734.png\"><img class=\"aligncenter size-full wp-image-65351\" src=\"http://jbcdn2.b0.upaiyun.com/2017/06/3b7432892c1dbafb839a60491ad99734.png\" alt=\"trashcan\" width=\"229\" height=\"381\"></a></p>\n<p>小 printf 打破了沉默，并且带着一丝愤怒：</p>\n<p>“我不相信你说的话。程序确实是脆弱的，但是程序员能够通过努力让程序变得更好且可用。”</p>\n<p>没有回应。这个时候忙碌的人已经打开一个文档，查看如何从头启动一个集群备份，情况似乎变得越来越糟糕了。</p>\n<p>“那么你真的相信可靠的程–”</p>\n<p>“噢不！”忙碌的人说，“不不不！我不相信什么好的或者可靠的程序！再也不信了！它们都不行！我告诉你我现在脑袋里想的就是怎么处理手头的这个垃圾系统。你没看到是我在努力维持让这些东西运行吗？这些破玩意儿多么重要！”</p>\n<p>小 printf 瞪了回来，表情有些惊愕。</p>\n<p>“都坏成这样了还很重要？你的口气就像是个真正的程序员似的。“</p>\n<p>他补充说：</p>\n<p>”你把概念完全搞混了。世界上有成百上千的程序，年复一年地运行，而且总是会崩溃。但是即便如此人们还是需要这些程序，使用这些程序。而且我知道还有一种程序，它们只会在单台笔记本上运行，但是只要发生一点点错误，其结果就能瞬间毁灭整个社区。如果这样，你还认为不重要吗？“</p>\n<p>接下来这个忙碌的人就不再说话了。</p>\n<h3>第 6 章</h3>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/06/7350f2b08649e74bdbe6927120ebe2e3.png\"><img class=\"aligncenter size-full wp-image-65338\" src=\"http://jbcdn2.b0.upaiyun.com/2017/06/7350f2b08649e74bdbe6927120ebe2e3.png\" alt=\"frameworks\" width=\"529\" height=\"487\"></a></p>\n<p>小 printf 造访的第四个工作区有一个人，他的电脑前贴满了各种不知名的即时贴。</p>\n<p>”motor-mvc, quadrangular JS, GoQuery, cometeor, 还有一些听上去像是日语的东西, …“</p>\n<p>”Hi,“ 小 printf 打断了他，”请问你在做什么呢？“</p>\n<p>”alchemist, bongodb, mochascript, walktime.js, portasql, …“这个人不停地念叨。</p>\n<p>”请问您在做什么呢？“小 printf 又问了一遍，这次声音更大了一些。</p>\n<p>”噢，我在尝试新的框架，工具，数据库，编程语言。“</p>\n<p>”哇！你好像进度很快啊，效率和10个程序员加起来一样高。“</p>\n<p>”是啊，你看，这个行业的前进速度是非常快的！“他对着手机看了几秒，然后补充说，”这儿！cardboard.io 框架推出了 3.5 版本，这个版本和 3.4 不兼容，目前已经产生了 4 个 fork 了！我必须要把他们都试一遍，然后决定自己用哪个。“</p>\n<p>”但是你学这么多，都拿来做什么呢？“</p>\n<p>”我是一个提前学习主义者。如果你不保持着与时俱进的心态，现在你可能还要靠写 COBOL 或者 MUMPS 来过日子呢。如果你想做大事情，就要确保自己站在浪潮之巅。“</p>\n<p>”那这么做有效果么？“</p>\n<p>”有啊，我在 Rails 火起来之前就知道它要火了，我在 node.js 流行起来就知道它要流行了。我参与了 Redis、Mongodb 和 Riak早期的 beta 测试！我是第一个用 Vagrant 的人，后来又切换到了Docker上面，当然现在的潮流是 Unikernel“</p>\n<p>”酷，那么你掌握了这么多最前沿的技术，有什么回报呢？“</p>\n<p>”哦，并没有回报，Rails 变得越来越臃肿了以后，我就必须得赶快去关注别的重要技术，保证自己不要落后。其他的各种技术差不多也是这个套路。目前我希望掌握的是 Unikernel。“</p>\n<p>”明白了。“，小 printf 补充到，”那么这些新框架和技术都会用来解决哪些问题呢？“</p>\n<p>”噢，不是重大技术我们不用，我主要是要确保这一点，这样才能让我们公司不至于把资源花费到没有未来的技术上。这是很重要的，因为如果你不这么做的话，你的技术就会被那帮花白胡子的过时老程序员绑架，为了避免这样，你就必须成为一个自我驱动力强大的学习者，一个提前学习主义者。“</p>\n<p>”真有趣。“小 printf 插了一句嘴。</p>\n<p>”这可不是有趣，这是很难做到的！在创业的世界里，如果你想要吸引人才，你就必须要通过优秀的技术来招揽他们！否则你就是个不灵活的落后者。没人愿意做不灵活的落后者。“</p>\n<p>小 printf 赶紧说：”不，我不是这个意思。“，然后他补充到，”我感到有趣的地方在于，工具本来是用来给我们解决问题的，但是对于你来说，工具本身却成了问题。“</p>\n<p>接下来，这个人就站在他那个新潮的健身式办公桌前，没有任何回应了，小 printf 真希望自己赶紧出去。</p>\n<h3>第 7 章</h3>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/06/6a7cef8b627c1b5bbdef6056762200a1.png\"><img class=\"aligncenter size-full wp-image-65362\" src=\"http://jbcdn2.b0.upaiyun.com/2017/06/6a7cef8b627c1b5bbdef6056762200a1.png\" alt=\"ops\" width=\"363\" height=\"349\"></a></p>\n<p>在下一个办公室，坐着一个看上去很疲倦的员工，他的桌子上堆满了空咖啡杯。她无精打采地坐着，愤怒地敲击着键盘。</p>\n<p>”嗨！“小 printf 说。</p>\n<p>这个疲倦的女人并没有停下手上的动作。他继续愤怒地敲击着键盘。</p>\n<p>”你好？“小 printf 又打了一遍招呼。</p>\n<p>这个女人忽然间停了下来，从抽屉里取出一只水壶，然后大口喝起水来。</p>\n<p>”我的工作太糟糕了。“她说，”我是做 Devops 的。一开始还好，我大部分时间做开发，偶尔也做做调试的事情，但是随着时间的推移，情况变得越来越糟糕。我开始在各处救火，但是问题还是不断发生。我解决了其中的大部分问题，但是有些小毛病还是要期盼奇迹发生，这才能赶得上开发计划预定的期限，而且开发工作也是我的。“</p>\n<p>”他们没有再找个人帮帮你么？“</p>\n<p>”没有，这就是问题的所在。小问题总是到处发生，因为我必须要解决这些问题，所以我在做开发的时候就不可能像以前只做开发时那么专注，所以我本身就会制造更多的问题。现在，我每天都没日没夜地给系统灭火，我真是恨死我的工作了。“</p>\n<p>”那你的雇主为什么什么都不做呢？“</p>\n<p>”那是因为我擅长我的工作啊，我长期以来一直可以控制住局面，而且大家都已经习惯了。当你把创造奇迹变成一种习惯的时候，人们就适应了。然后你就会被困在‘总是要创造奇迹’的局面当中，否则人们就会认为是你的工作不得力。“</p>\n<p>”这听上去可真是悲哀！“</p>\n<p>”是啊。因为你是最熟悉怎么去给系统灭火的人，所以你就总得去，久而久之就是你的工作了，直到有一天老板雇了新人来替代你做你心爱的工作。如果你真的很在意你的工作的话，那么就去做那种谁都不愿意干的脏活累活，接下来所有人都会感谢你，你干得越多人们就会越感谢你，直到所有的脏活累活全都归你。当然，这样的话工作就没有什么乐趣可言了。“</p>\n<p>”那么你可真不走运。“小 printf 说。</p>\n<p>说着，她的呼叫器又响了。</p>\n<p>”那个女人，”小 printf 对自己说，就像是他父亲的口吻，“那个女人的工作被所有人轻视，专家、明星程序员、提前学习主义者，他们都看不上她的工作。但是她做的工作才是唯一有帮助的。这很可能是因为她总是在考虑别人，而不是只考虑自己吧。”</p>\n<h3>第 8 章</h3>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/06/e3b19d8ef4b712035dd80e8738020147.png\"><img class=\"aligncenter size-full wp-image-65363\" src=\"http://jbcdn2.b0.upaiyun.com/2017/06/e3b19d8ef4b712035dd80e8738020147.png\" alt=\"architect\" width=\"449\" height=\"377\"></a></p>\n<p>在建筑的一角，小 printf 发现了一间大办公室，办公室有巨大的落地窗，窗外视野极好。办公室内有一张非常大的办公桌，桌子上的文件堆成了小山，有一个老绅士坐在办公桌前。</p>\n<p>“啊，开发者来了”老绅士看到小 printf 走到门厅，于是就大声喊到，“进来！”</p>\n<p>透过窗户看去，小 printf 注意到窗户的玻璃上写着各种各样的字，还有用修正液涂改的痕迹，以至于窗外的风景都快被各种圈圈点点，箭头，圆柱等几何图形给盖住了，而且上面还画了云朵的图案。明明窗外就有真正的云，为什么还要在窗户上画云朵的形状？还有整个图案的含义也让人很感兴趣。</p>\n<p>”这是什么？“，小 printf 指着窗户问。</p>\n<p>”这个么？这是我们的生产系统！“那个老绅士说，一副看上去对外面事物毫不关心的样子，”我是一个软件架构师。“</p>\n<p>”软件架构师是什么？”</p>\n<p>“多数情况下，架构师是那种最了解组件之间的结构，并且最能够合理调度组件关系的人，架构师能让大型系统的各个部分完美协调地工作。同时，软件架构师也了解数据库、编程语言、框架、编辑器、序列化格式、协议以及诸如封装、协议隔离等概念。“</p>\n<p>”听上去真有趣！“小 printf 说，“终于有一个人能够回答所有的问题了！”他看了一眼架构师的图，“你的系统真是让人印象深刻啊！那么这个系统速度快么？”</p>\n<p>“我不知道，”架构师说，“应该挺快的吧。”</p>\n<p>“那系统的代码呢？写得好么？”</p>\n<p>“我也没法告诉你”</p>\n<p>“用户对系统满意么？”</p>\n<p>“恐怕我还是没法告诉你。”</p>\n<p>“但是你是软件架构师啊！”</p>\n<p>“对啊！但是我并不是开发者啊。软件架构师的任务并不是去写模块、类，也不是调用类库。软件架构师的工作相比写代码来说要重要得多。软件架构师会和开发者，程序员们聊天，问他们问题，给他们提供指导。如果程序员问的问题很有趣，那么架构师也许会亲自出马给这个问题做规划。”</p>\n<p>“为什么要这样？”</p>\n<p>“因为我们更有经验啊。我们对系统能做哪些事，不能做哪些事了解得更多。开发者则是我们知识的延伸，他们会去把优秀的系统真正做出来。”</p>\n<p>“但是你们不亲自编码，怎么能确认开发过程是顺利的呢？”</p>\n<p>“因为我们信任开发人员啊。”</p>\n<p>“所以你相信开发人员能够正确实现你的想法，并且不会产生他们自己的想法？”</p>\n<p>软件架构师听了小 printf 的话后明显有些震惊，他说：”我想我还是有点儿脱节。“，他最后承认说，“问题确实存在，别人总是跟你说要按照某种思想或者主意去做事，但是你又没法有效验证你做的事情是不是真的符合这种思想。”他低下了头，沉思着，“有的时候软件架构师既不做软件，也不做架构，这貌似是真的。”</p>\n<p>接着，小 printf 离开了坊间，然后结束了他的访问，离开了大楼。</p>\n<h3>第 9 章</h3>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/06/badf773e339eb22672ab17db1335c747.png\"><img class=\"aligncenter size-full wp-image-65341\" src=\"http://jbcdn2.b0.upaiyun.com/2017/06/badf773e339eb22672ab17db1335c747.png\" alt=\"charity\" width=\"410\" height=\"299\"></a></p>\n<p>小 printf 刚一走出门，就碰到了一个男人正在路边募集善款。</p>\n<p>“Hi，”那个男人说，“你今天想不想给别人献点儿爱心呢？”</p>\n<p>”好吧，这样做我感觉可能会好点儿“，小 printf 回答说，”我已经在这栋大楼里待了一整天，可是我出来的时候感觉更加困惑了。“</p>\n<p>”啊，我明白了。这些人都是开发者。他们其实一点儿也帮不上忙，对不？他们总是喊着要改变世界，而且他们确实也做到了。“</p>\n<p>”但是为什么感觉这么奇怪呢？“小 printf 回答到。</p>\n<p>”好吧，因为他们的工作就是把人们的职业转换成程序，让人们安逸的生活变得更加安逸。软件会吞噬整个世界，然后给让世界面貌一新……不过从深层次来看，面貌一新的世界还是那个旧世界，只是面貌变了而已。之所你觉得奇怪，是因为世界的改变并不一定朝好的方向改变。我们现在面临的问题其实和以前一样多，需要填的坑也和以前一样深。“</p>\n<p>”那么我怎么才能让自己感觉好一点儿呢？”小 printf 显得有些焦虑。</p>\n<p>这个男人思考了一会儿，然后希望小 printf 能和他一起来帮助别人，这是他认为的能让自己感觉变好的方式。printf用了一整个下午告诉这个人自己的问题和经历。这个人听完了以后沉默了很长一段时间，然后说：</p>\n<p>“人们在社会中相互博弈，扮演不同角色，追逐和享受的名声，解决错综复杂的问题后得到瞬间的快感，这些都只是过眼云烟。最终，如果你没有解决什么有意义的问题，如果你完全不考虑别人，那么你是无法做到内心满足的。”</p>\n<p>“得不到内心的满足也许也没什么，也许会很糟糕，在你成长的过程中，你的满足感可能来自于你的工作之外，也可能来自于工作。工作可以仅仅就是工作，也可以是单纯为了钱，也可以为了兴趣。这些都OK。只要你能从生命中的某处找到内心的满足，那就好了。”</p>\n<p>“最后，只有当你以人类的面孔去解决问题的时候，你才会觉得真的正确；真正关键的点其实和电脑没关系。”</p>\n<p>“真正的关键在于你用心花在系统上的精力，这才是最重要的。“，那个人补充到，”如果你忘记了为什么花这么多精力的初衷，当一切都变成了关乎个人骄傲的游戏，那么事情的性质就变了，从可慰变成可悲。“</p>\n<p>”开发者们常常会忘记一个事实；如果你失去了对事物的眼光，那么在开发系统本身就成为了一个问题，这样的话最有效的办法就是把系统废掉，因为系统自己就是问题的根源。“</p>\n<p>”只有当你以人类的面孔去解决问题的时候，才会觉得真的正确。“，小 printf 不断重复着这句话，他铭记在心。</p>\n<h3>第 10 章</h3>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/06/c3e439e098ad3e922e7c338db045c453.png\"><img class=\"aligncenter size-full wp-image-65332\" src=\"http://jbcdn2.b0.upaiyun.com/2017/06/c3e439e098ad3e922e7c338db045c453.png\" alt=\"printf\" width=\"569\" height=\"638\"></a></p>\n<p>坐在我身旁的Printf现在要起身回家了。跟他的一席对话让我意识到了我现在所做的事情和我的爱好有多么大的距离，而我的爱好才是我真正开始编程的动力。小 printf 遇到的每一个角色，我每天也都会遇到很多。我曾受到他们的鼓舞，希望成为他们的一员，我可能也鼓励过别人这么做。</p>\n<p>当我还在挣扎着成为一个真正的程序员的时候，小 printf 却没有这么做。他说他成不了一个真正的程序员也没关系，他更希望能成为一个长着人类面孔的程序员。</p>\n<p>时至今日，回首望去，我的困境并没有改变，我还是要在人类的面孔和纯粹的工作之间做出选择，我希望我能有这个能力。而且在这两者之间好像也没有什么中间地段可以让我去选择。</p>\n<p>无论如何，小 printf 觉得他不需要做一个真正的程序员了，我想我和他的感觉是一样的。</p>\n\r\n        \r\n            <blockquote class=\"rewards\">\n        <p><strong>打赏支持我翻译更多好文章，谢谢！</strong></p>\n        <a href=\"#rewardbox\" id=\"rewards-button\" class=\"fancybox\"><span class=\"btn-bluet-blue href-style\"><i class=\"fa fa-jpy\"></i> 打赏译者</span></a>\n    </blockquote>\n\n    <div id=\"rewardbox\">\n        <h4>打赏支持我翻译更多好文章，谢谢！</h4>\n                <p>\n                        <img src=\"http://www.jobbole.com/wp-content/uploads/2016/04/78805a221a988e79ef3f42d7c5bfd4187.jpeg\">\n            \n                    </p>\n    </div>\n\n    \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111959\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111959votetotal\">5</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111959\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 5 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 2 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/huangxiaofei\">黄小非</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/huangxiaofei\">\r\n\t\t\t<img src=\"http://www.jobbole.com/wp-content/uploads/avatars/5423/Corbis-42-221258652.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            黄小非：毕业于重庆大学计算机系，南开大学软件工程硕士，SCJP。 目前在一家国企信息中心任职软件开发工程师。主要技术兴趣为Java平台相关技术、系统构架、C/C++、计算机图形学等。（新浪微博：@黄小非）        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/huangxiaofei\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/huangxiaofei/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/huangxiaofei/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 62</a> · <a title=\"微博主页\" target=\"_blank\" href=\"http://weibo.com/huangxiaofei2002\"><i class=\"fa fa-weibo\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "post_url": "http://blog.jobbole.com/111959/", "tag_name": "职场，程序员", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/06/3b102356e4b2e8b92940143a3a70bed0.png"], "url_object_id": "4220d150717c8d45c995d3ccaa8b8996"},
{"title": "DB 分库分表（5）：一种支持自由规划无须数据迁移和修改路由代码的 Sharding 扩容方案", "creat_time": "2017-07-30", "praise_count": "1", "bookmark_count": 0, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://blog.csdn.net/bluishglc/article/details/7970268\">Laurence的技术博客，首发《程序员》杂志</a>   </div><p>作为一种数据存储层面上的水平伸缩解决方案，数据库Sharding技术由来已久，很多海量数据系统在其发展演进的历程中都曾经历过分库分表的Sharding改造阶段。简单地说，Sharding就是将原来单一数据库按照一定的规则进行切分，把数据分散到多台物理机（我们称之为Shard)上存储，从而突破单机限制，使系统能以Scale-Out的方式应对不断上涨的海量数据，但是这种切分对上层应用来说是透明的，多个物理上分布的数据库在逻辑上依然是一个库。实现Sharding需要解决一系列关键的技术问题，这些问题主要包括：切分策略、节点路由、全局主键生成、跨节点排序/分组/表关联、多数据源事务处理和数据库扩容等。本文将重点围绕“数据库扩容”进行深入讨论，并提出一种允许自由规划并能避免数据迁移和修改路由代码的Sharding扩容方案。</p>\n<h3><strong>Sharding扩容——系统维护不能承受之重</strong></h3>\n<p>任何Sharding系统，在上线运行一段时间后，数据就会积累到当前节点规模所能承载的上限，此时就需要对数据库进行扩容了，也就是增加新的物理结点来分摊数据。如果系统使用的是基于ID进行散列的路由方式，那么团队需要根据新的节点规模重新计算所有数据应处的目标Shard，并将其迁移过去，这对团队来说无疑是一个巨大的维护负担；而如果系统是按增量区间进行路由(如每1千万条数据或是每一个月的数据存放在一个节点上 )，虽然可以避免数据的迁移，却有可能带来“热点”问题，也就是近期系统的读写都集中在最新创建的节点上(很多系统都有此类特点：新生数据的读写频率明显高于旧有数据)，从而影响了系统性能。面对这种两难的处境，Sharding扩容显得异常困难。</p>\n<p>一般来说，“理想”的扩容方案应该努力满足以下几个要求：</p>\n<ol>\n<li> 最好不迁移数据 （无论如何，数据迁移都是一个让团队压力山大的问题）</li>\n<li>允许根据硬件资源自由规划扩容规模和节点存储负载</li>\n<li>能均匀的分布数据读写，避免“热点”问题</li>\n<li>保证对已经达到存储上限的节点不再写入数据</li>\n</ol>\n<p>目前，能够避免数据迁移的优秀方案并不多，相对可行的有两种，一种是维护一张记录数据ID和目标Shard对应关系的映射表，写入时，数据都写入新扩容的Shard，同时将ID和目标节点写入映射表，读取时，先查映射表，找到目标Shard后再执行查询。该方案简单有效，但是读写数据都需要访问两次数据库，且映射表本身也极易成为性能瓶颈。为此系统不得不引入分布式缓存来缓存映射表数据，但是这样也无法避免在写入时访问两次数据库，同时大量映射数据对缓存资源的消耗以及专门为此而引入分布式缓存的代价都是需要权衡的问题。另一种方案来自淘宝综合业务平台团队，它利用对2的倍数取余具有向前兼容的特性（如对4取余得1的数对2取余也是1）来分配数据，避免了行级别的数据迁移，但是依然需要进行表级别的迁移，同时对扩容规模和分表数量都有限制。总得来说，这些方案都不是十分的理想，多多少少都存在一些缺点，这也从一个侧面反映出了Sharding扩容的难度。</p>\n<h3><strong>取长补短，兼容并包——一种理想的Sharding扩容方案</strong></h3>\n<p>如前文所述，Sharding扩容与系统采用的路由规则密切相关：基于散列的路由能均匀地分布数据，但却需要数据迁移，同时也无法避免对达到上限的节点不再写入新数据；基于增量区间的路由天然不存在数据迁移和向某一节点无上限写入数据的问题，但却存在“热点”困扰。我们设计方案的初衷就是希望能结合两种路由规则的优势，摒弃各自的劣势，创造出一种接近“理想”状态的扩容方式，而这种方式简单概括起来就是：全局按增量区间分布数据，使用增量扩容，无数据迁移，局部使用散列方式分散数据读写，解决“热点”问题，同时对Sharding拓扑结构进行建模，使用一致的路由算法，扩容时只需追加节点数据，不再修改散列逻辑代码。</p>\n<h3><strong>原理</strong></h3>\n<p>首先，作为方案的基石，为了能使系统感知到Shard并基于Shard的分布进行路由计算，我们需要建立一个可以描述Sharding拓扑结构的编程模型。按照一般的切分原则，一个单一的数据库会首先进行垂直切分，垂直切分只是将关系密切的表划分在一起，我们把这样分出的一组表称为一个Partition。 接下来，如果Partition里的表数据量很大且增速迅猛，就再进行水平切分，水平切分会将一张表的数据按增量区间或散列方式分散到多个Shard上存储。在我们的方案里，我们使用增量区间与散列相结合的方式，全局上，数据按增量区间分布，但是每个增量区间并不是按照某个Shard的存储规模划分的，而是根据一组Shard的存储总量来确定的，我们把这样的一组Shard称为一个ShardGroup，局部上，也就是一个ShardGroup内，记录会再按散列方式均匀分布到组内各Shard上。这样，一条数据的路由会先根据其ID所处的区间确定ShardGroup，然后再通过散列命中ShardGroup内的某个目标Shard。在每次扩容时，我们会引入一组新的Shard，组成一个新的ShardGroup，为其分配增量区间并标记为“可写入”，同时将原有ShardGroup标记为“不可写入”，于是新生数据就会写入新的ShardGroup，旧有数据不需要迁移。同时，在ShardGroup内部各Shard之间使用散列方式分布数据读写，进而又避免了“热点”问题。最后，在Shard内部，当单表数据达到一定上限时，表的读写性能就开始大幅下滑，但是整个数据库并没有达到存储和负载的上限，为了充分发挥服务器的性能，我们通常会新建多张结构一样的表，并在新表上继续写入数据，我们把这样的表称为“分段表”（Fragment Table）。不过，引入分段表后所有的SQL在执行前都需要根据ID将其中的表名替换成真正的分段表名，这无疑增加了实现Sharding的难度，如果系统再使用了某种ORM框架，那么替换起来可能会更加困难。目前很多数据库提供一种与分段表类似的“分区”机制，但没有分段表的副作用，团队可以根据系统的实现情况在分段表和分区机制中灵活选择。总之，基于上述切分原理，我们将得到如下Sharding拓扑结构的领域模型：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/b6a6923203f3865db3481b3ac4c3103a.jpg\" alt=\"\" width=\"591\" height=\"483\"></p>\n<p style=\"text-align: center\">图1. Sharding拓扑结构领域模型</p>\n<p>在这个模型中，有几个细节需要注意：ShardGroup的writable属性用于标识该ShardGroup是否可以写入数据，一个Partition在任何时候只能有一个ShardGroup是可写的，这个ShardGroup往往是最近一次扩容引入的；startId和endId属性用于标识该ShardGroup的ID增量区间；Shard的hashValue属性用于标识该Shard节点接受哪些散列值的数据；FragmentTable的startId和endId是用于标识该分段表储存数据的ID区间。</p>\n<p>确立上述模型后，我们需要通过配置文件或是在数据库中建立与之对应的表来存储节点元数据，这样，整个存储系统的拓扑结构就可以被持久化起来，系统启动时就能从配置文件或数据库中加载出当前的Sharding拓扑结构进行路由计算了（如果结点规模并不大可以使用配置文件，如果节点规模非常大，需要建立相关表结构存储这些结点元数据。从最新的Oracle发布的《面向大规模可伸缩网站基础设施的MySQL参考架构》白皮书一文的“超大型系统架构参考”章节给出的架构图中我们可以看到一种名为：Shard Catalog的专用服务器，这个其实是保存结点配置信息的数据库），扩容时只需要向对应的文件或表中加入相关的节点信息重启系统即可，不需要修改任何路由逻辑代码。</p>\n<h3><strong>示例</strong></h3>\n<p>让我们通过示例来了解这套方案是如何工作的。</p>\n<p><strong>阶段一：初始上线</strong></p>\n<p>假设某系统初始上线，规划为某表提供4000W条记录的存储能力，若单表存储上限为1000W条，单库存储上限为2000W条，共需2个Shard，每个Shard包含两个分段表，ShardGroup增量区间为0-4000W，按2取余分散到2个Shard上，具体规划方案如下：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/6a4da76f81d438d240c54afe5124d2ab.jpg\" alt=\"\" width=\"591\" height=\"310\"></p>\n<p style=\"text-align: center\">图2. 初始4000W存储规模的规划方案</p>\n<p>与之相适应，Sharding拓扑结构的元数据如下：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/09fcb6013304ed5a0bd37962856c02c7.jpg\" alt=\"\" width=\"467\" height=\"388\"></p>\n<p style=\"text-align: center\">图3. 对应Sharding元数据</p>\n<p><strong>阶段二：系统扩容</strong></p>\n<p>经过一段时间的运行，当原表总数据逼近4000W条上限时，系统就需要扩容了。为了演示方案的灵活性，我们假设现在有三台服务器Shard2、Shard3、Shard4，其性能和存储能力表现依次为Shard2&lt;Shard3&lt;Shard4，我们安排Shard2储存1000W条记录，Shard3储存2000W条记录，Shard4储存3000W条记录，这样，该表的总存储能力将由扩容前的4000W条提升到10000W条，以下是详细的规划方案：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/2375c89746d023b9ddcbb20f653c3b3b.jpg\" alt=\"\" width=\"802\" height=\"278\"></p>\n<p style=\"text-align: center\">图4. 二次扩容6000W存储规模的规划方案</p>\n<p>相应拓扑结构表数据下：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/dfae7a7e6e53f086c125982d8bbc8132.jpg\" alt=\"\" width=\"474\" height=\"471\"></p>\n<p style=\"text-align: center\">图5. 对应Sharding元数据</p>\n<p>从这个扩容案例中我们可以看出该方案允许根据硬件情况进行灵活规划，对扩容规模和节点数量没有硬性规定，是一种非常自由的扩容方案。</p>\n<h3><strong>增强</strong></h3>\n<p>接下来让我们讨论一个高级话题：对“再生”存储空间的利用。对于大多数系统来说，历史数据较为稳定，被更新或是删除的概率并不高，反映到数据库上就是历史Shard的数据量基本保持恒定，但也不排除某些系统其数据有同等的删除概率，甚至是越老的数据被删除的可能性越大，这样反映到数据库上就是历史Shard随着时间的推移，数据量会持续下降，在经历了一段时间后，节点就会腾出很大一部分存储空间，我们把这样的存储空间叫“再生”存储空间，如何有效利用再生存储空间是这些系统在设计扩容方案时需要特别考虑的。回到我们的方案，实际上我们只需要在现有基础上进行一个简单的升级就可以实现对再生存储空间的利用，升级的关键就是将过去ShardGroup和FragmentTable的单一的ID区间提升为多重ID区间。为此我们把ShardGroup和FragmentTable的ID区间属性抽离出来，分别用ShardGroupInterval和FragmentTableIdInterval表示，并和它们保持一对多关系。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/eb93f0a9d14f8dd2f21535aaa611eb66.jpg\" alt=\"\" width=\"550\" height=\"629\"></p>\n<p style=\"text-align: center\">图6. 增强后的Sharding拓扑结构领域模型</p>\n<p>让我们还是通过一个示例来了解升级后的方案是如何工作的。</p>\n<p><strong>阶段三：不扩容，重复利用再生存储空间</strong></p>\n<p>假设系统又经过一段时间的运行之后，二次扩容的6000W条存储空间即将耗尽，但是由于系统自身的特点，早期的很多数据被删除，Shard0和Shard1又各自腾出了一半的存储空间，于是ShardGroup0总计有2000W条的存储空间可以重新利用。为此，我们重新将ShardGroup0标记为writable=true，并给它追加一段ID区间：10000W-12000W，进而得到如下规划方案：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/9aefceaacb575a4a218b4444b710525c.jpg\" alt=\"\" width=\"518\" height=\"312\"></p>\n<p style=\"text-align: center\">图7. 重复利用2000W再生存储空间的规划方案</p>\n<p>相应拓扑结构的元数据如下：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/7174be65f86f3158fbeae47d88984408.jpg\" alt=\"\" width=\"713\" height=\"382\"></p>\n<p style=\"text-align: center\">图8. 对应Sharding元数据</p>\n<h3><strong>小结</strong></h3>\n<p>这套方案综合利用了增量区间和散列两种路由方式的优势，避免了数据迁移和“热点”问题，同时，它对Sharding拓扑结构建模，使用了一致的路由算法，从而避免了扩容时修改路由代码，是一种理想的Sharding扩容方案。</p>\n<p><a href=\"http://blog.csdn.net/bluishglc/article/details/6161475\" target=\"_blank\" name=\"6161475\"></a></p>\n<h1><a href=\"http://blog.csdn.net/bluishglc/article/details/6161475\" target=\"_blank\" name=\"6161475\"></a></h1>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111927\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111927votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111927\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "post_url": "http://blog.jobbole.com/111927/", "tag_name": "IT技术，分库分表，数据库", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/03/4bae6998d00f180d42c7da716e3d0bb2.jpg"], "url_object_id": "cca88c074547b53fcc59c01e5736f847"},
{"title": "27 个机器学习、数学、Python 速查表", "creat_time": "2017-07-30", "praise_count": "5", "bookmark_count": 15, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/shaozhengjiang\">iPytLab</a> 翻译。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://unsupervisedmethods.com/cheat-sheet-of-machine-learning-and-python-and-math-cheat-sheets-a4afe4e791b6\">Robbie Allen</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>机器学习涉及到的方面非常多。当我开始准备复习这些内容的时候，我找到了许多不同的”速查表”, 这些速查表针对某一主题都罗列出了所有我需要知道的知识重点。最终我编译了超过 20 份机器学习相关的速查表，其中一些是我经常用到的而且我相信其他人也会从中受益。本文整理了我在网络上找到的 27 个速查表，我认为比较好。如果我有遗漏，欢迎补充。</p>\n<p>如今机器学习领域的发展相当迅速，我可以想象出来这些资源将会很快过时，但是至少在当前，在2017年6月1日，他们都是相当流行的。</p>\n<p>如果你们像我一样想要一次性批量下载所有资源，我已经将 27 个速查表整理打包（<a href=\"https://www.dropbox.com/s/v3yg8djhdf24g6v/UnsupervisedMethods.com%20-%20Cheat%20Sheets.zip?dl=0\" target=\"_blank\">Dropbox</a>、<a href=\"https://pan.baidu.com/s/1mi0viGS\" target=\"_blank\">百度云</a>）好了，请尽情享用吧！</p>\n<p>如果你喜欢本文，记得给我在下面点个 zan 哦。</p>\n<h2 id=\"机器学习\">机器学习\n</h2><p>这里我从一些和机器学习算法相关的流程图和表格中选择了我认为最全面的几个并在下面罗列出来。</p>\n<h3 id=\"Neural-Network-Architectures\">Neural Network Architectures\n</h3><p>链接: <a href=\"http://www.asimovinstitute.org/neural-network-zoo/\" target=\"_blank\" rel=\"external\">http://www.asimovinstitute.org/neural-network-zoo/</a><img src=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/NN.png\" alt=\"\"></p>\n<p> </p>\n<p style=\"text-align: center;\"><em>The Neural Network Zoo</em></p>\n<h3 id=\"Microsoft-Azure-Algorithm-Flowchart\">Microsoft Azure Algorithm Flowchart\n</h3><p>链接: <a href=\"https://docs.microsoft.com/en-us/azure/machine-learning/machine-learning-algorithm-cheat-sheet\" target=\"_blank\" rel=\"external\"><span style=\"color: #0066cc;\">https://docs.microsoft.com/en-us/azure/machine-learning/machine-learning-algorithm-cheat-sheet</span></a></p>\n<p><img src=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/MS.png\" alt=\"\"></p>\n<p style=\"text-align: center;\"><em>Machine learning algorithm cheat sheet for Microsoft Azure Machine Learning Studio</em></p>\n<h3 id=\"SAS-Algorithm-Flowchart\">SAS Algorithm Flowchart\n</h3><p>链接: <a href=\"http://blogs.sas.com/content/subconsciousmusings/2017/04/12/machine-learning-algorithm-use/\" target=\"_blank\" rel=\"external\"><span style=\"color: #0066cc;\">http://blogs.sas.com/content/subconsciousmusings/2017/04/12/machine-learning-algorithm-use/</span></a></p>\n<p><img src=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/SAS.png\" alt=\"\"></p>\n<p style=\"text-align: center;\"><em>SAS: Which machine learning algorithm should I use?</em></p>\n<h3 id=\"Algorithm-Summary\">Algorithm Summary\n</h3><p>链接: <a href=\"http://machinelearningmastery.com/a-tour-of-machine-learning-algorithms/\" target=\"_blank\" rel=\"external\"><span style=\"color: #0066cc;\">http://machinelearningmastery.com/a-tour-of-machine-learning-algorithms/</span></a></p>\n<p><img src=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/AS.png\" alt=\"\"></p>\n<p style=\"text-align: center;\"><em>A Tour of Machine Learning Algorithms</em></p>\n<p style=\"text-align: center;\"><a class=\"fancybox\" href=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/best.jpeg\" rel=\"gallery0\"><img src=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/best.jpeg\" alt=\"\"></a><br>\n<em>Which are the best known machine learning algorithms?</em></p>\n<h3 id=\"Algorithm-Pro-Con\">Algorithm Pro/Con\n</h3><p>链接: <a href=\"https://blog.dataiku.com/machine-learning-explained-algorithms-are-your-friend\" target=\"_blank\" rel=\"external\"><span style=\"color: #0066cc;\">https://blog.dataiku.com/machine-learning-explained-algorithms-are-your-friend</span></a></p>\n<p><a class=\"fancybox\" href=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/CON.jpeg\" rel=\"gallery0\"><span style=\"color: #0066cc;\"><img src=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/CON.jpeg\" alt=\"\"></span></a></p>\n<h2 id=\"Python\">Python\n</h2><p>网上在线的Python资源可以说是相当的多。在这一部分，我挑选了我遇到的几个最好的速查表呈献给大家。</p>\n<h3 id=\"ML算法\">ML算法\n</h3><p>链接: <a href=\"https://www.analyticsvidhya.com/blog/2015/09/full-cheatsheet-machine-learning-algorithms/\" target=\"_blank\" rel=\"external\"><span style=\"color: #0066cc;\">https://www.analyticsvidhya.com/blog/2015/09/full-cheatsheet-machine-learning-algorithms/</span></a></p>\n<p><a class=\"fancybox\" href=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/PYALGO.png\" rel=\"gallery0\"><span style=\"color: #0066cc;\"><img src=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/PYALGO.png\" alt=\"\"></span></a></p>\n<h3 id=\"Python基础\">Python基础\n</h3><p>链接: <a href=\"http://datasciencefree.com/python.pdf\" target=\"_blank\" rel=\"external\"><span style=\"color: #0066cc;\">http://datasciencefree.com/python.pdf</span></a></p>\n<p><a class=\"fancybox\" href=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/PYBASIC.png\" rel=\"gallery0\"><span style=\"color: #0066cc;\"><img src=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/PYBASIC.png\" alt=\"\"></span></a></p>\n<p>链接: <a href=\"https://www.datacamp.com/community/tutorials/python-data-science-cheat-sheet-basics#gs.0x1rxEA\" target=\"_blank\" rel=\"external\"><span style=\"color: #0066cc;\">https://www.datacamp.com/community/tutorials/python-data-science-cheat-sheet-basics#gs.0x1rxEA</span></a></p>\n<p><a class=\"fancybox\" href=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/PYBASIC2.png\" rel=\"gallery0\"><span style=\"color: #0066cc;\"><img src=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/PYBASIC2.png\" alt=\"\"></span></a></p>\n<h3 id=\"Numpy\">Numpy\n</h3><p>链接: <a href=\"https://www.dataquest.io/blog/numpy-cheat-sheet/\" target=\"_blank\" rel=\"external\"><span style=\"color: #0066cc;\">https://www.dataquest.io/blog/numpy-cheat-sheet/</span></a></p>\n<p><a class=\"fancybox\" href=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/NUMPY.png\" rel=\"gallery0\"><span style=\"color: #0066cc;\"><img src=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/NUMPY.png\" alt=\"\"></span></a></p>\n<p>链接: <a href=\"http://datasciencefree.com/numpy.pdf\" target=\"_blank\" rel=\"external\"><span style=\"color: #0066cc;\">http://datasciencefree.com/numpy.pdf</span></a></p>\n<p><a class=\"fancybox\" href=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/numpy-pdf.png\" rel=\"gallery0\"><span style=\"color: #0066cc;\"><img src=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/numpy-pdf.png\" alt=\"\"></span></a></p>\n<p>链接: <a href=\"https://www.datacamp.com/community/blog/python-numpy-cheat-sheet#gs.Nw3V6CE\" target=\"_blank\" rel=\"external\"><span style=\"color: #0066cc;\">https://www.datacamp.com/community/blog/python-numpy-cheat-sheet#gs.Nw3V6CE</span></a></p>\n<p><a class=\"fancybox\" href=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/numpy3.png\" rel=\"gallery0\"><span style=\"color: #0066cc;\"><img src=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/numpy3.png\" alt=\"\"></span></a></p>\n<p>链接: <a href=\"https://github.com/donnemartin/data-science-ipython-notebooks/blob/master/numpy/numpy.ipynb\" target=\"_blank\" rel=\"external\"><span style=\"color: #0066cc;\">https://github.com/donnemartin/data-science-ipython-notebooks/blob/master/numpy/numpy.ipynb</span></a></p>\n<p><a class=\"fancybox\" href=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/numpy4.png\" rel=\"gallery0\"><span style=\"color: #0066cc;\"><img src=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/numpy4.png\" alt=\"\"></span></a></p>\n<h3 id=\"Pandas\">Pandas\n</h3><p>链接: <a href=\"http://datasciencefree.com/pandas.pdf\" target=\"_blank\" rel=\"external\"><span style=\"color: #0066cc;\">http://datasciencefree.com/pandas.pdf</span></a></p>\n<p><a class=\"fancybox\" href=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/pandas.png\" rel=\"gallery0\"><span style=\"color: #0066cc;\"><img src=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/pandas.png\" alt=\"\"></span></a></p>\n<p>链接: <a href=\"https://www.datacamp.com/community/blog/python-pandas-cheat-sheet#gs.S4P4T=U\" target=\"_blank\" rel=\"external\"><span style=\"color: #0066cc;\">https://www.datacamp.com/community/blog/python-pandas-cheat-sheet#gs.S4P4T=U</span></a></p>\n<p><a class=\"fancybox\" href=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/pandas2.png\" rel=\"gallery0\"><span style=\"color: #0066cc;\"><img src=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/pandas2.png\" alt=\"\"></span></a></p>\n<p>链接: <a href=\"https://github.com/donnemartin/data-science-ipython-notebooks/blob/master/pandas/pandas.ipynb\" target=\"_blank\" rel=\"external\"><span style=\"color: #0066cc;\">https://github.com/donnemartin/data-science-ipython-notebooks/blob/master/pandas/pandas.ipynb</span></a></p>\n<p><a class=\"fancybox\" href=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/pandas3.png\" rel=\"gallery0\"><span style=\"color: #0066cc;\"><img src=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/pandas3.png\" alt=\"\"></span></a></p>\n<h3 id=\"Matplotlib\">Matplotlib\n</h3><p>链接: <a href=\"https://www.datacamp.com/community/blog/python-matplotlib-cheat-sheet\" target=\"_blank\" rel=\"external\"><span style=\"color: #0066cc;\">https://www.datacamp.com/community/blog/python-matplotlib-cheat-sheet</span></a></p>\n<p><a class=\"fancybox\" href=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/matplotlib.png\" rel=\"gallery0\"><span style=\"color: #0066cc;\"><img src=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/matplotlib.png\" alt=\"\"></span></a></p>\n<p>链接: <a href=\"https://github.com/donnemartin/data-science-ipython-notebooks/blob/master/matplotlib/matplotlib.ipynb\" target=\"_blank\" rel=\"external\"><span style=\"color: #0066cc;\">https://github.com/donnemartin/data-science-ipython-notebooks/blob/master/matplotlib/matplotlib.ipynb</span></a></p>\n<p><a class=\"fancybox\" href=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/matplotlib2.png\" rel=\"gallery0\"><span style=\"color: #0066cc;\"><img src=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/matplotlib2.png\" alt=\"\"></span></a></p>\n<h3 id=\"Scikit-Learn\">Scikit Learn\n</h3><p>链接: <a href=\"https://www.datacamp.com/community/blog/scikit-learn-cheat-sheet#gs.fZ2A1Jk\" target=\"_blank\" rel=\"external\"><span style=\"color: #0066cc;\">https://www.datacamp.com/community/blog/scikit-learn-cheat-sheet#gs.fZ2A1Jk</span></a></p>\n<p><a class=\"fancybox\" href=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/skl.png\" rel=\"gallery0\"><span style=\"color: #0066cc;\"><img src=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/skl.png\" alt=\"\"></span></a></p>\n<p>链接: <a href=\"http://peekaboo-vision.blogspot.de/2013/01/machine-learning-cheat-sheet-for-scikit.html\" target=\"_blank\" rel=\"external\"><span style=\"color: #0066cc;\">http://peekaboo-vision.blogspot.de/2013/01/machine-learning-cheat-sheet-for-scikit.html</span></a></p>\n<p><a class=\"fancybox\" href=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/skl2.png\" rel=\"gallery0\"><span style=\"color: #0066cc;\"><img src=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/skl2.png\" alt=\"\"></span></a></p>\n<p>链接: <a href=\"https://github.com/rcompton/ml_cheat_sheet/blob/master/supervised_learning.ipynb\" target=\"_blank\" rel=\"external\"><span style=\"color: #0066cc;\">https://github.com/rcompton/ml_cheat_sheet/blob/master/supervised_learning.ipynb</span></a></p>\n<p><a class=\"fancybox\" href=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/skl3.png\" rel=\"gallery0\"><span style=\"color: #0066cc;\"><img src=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/skl3.png\" alt=\"\"></span></a></p>\n<h3 id=\"Tensorflow\">Tensorflow\n</h3><p>链接: <a href=\"https://github.com/aymericdamien/TensorFlow-Examples/blob/master/notebooks/1_Introduction/basic_operations.ipynb\" target=\"_blank\" rel=\"external\"><span style=\"color: #0066cc;\">https://github.com/aymericdamien/TensorFlow-Examples/blob/master/notebooks/1_Introduction/basic_operations.ipynb</span></a></p>\n<p><a class=\"fancybox\" href=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/tf.png\" rel=\"gallery0\"><span style=\"color: #0066cc;\"><img src=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/tf.png\" alt=\"\"></span></a></p>\n<h3 id=\"Pytorch\">Pytorch\n</h3><p>链接: <a href=\"https://github.com/bfortuner/pytorch-cheatsheet\" target=\"_blank\" rel=\"external\"><span style=\"color: #0066cc;\">https://github.com/bfortuner/pytorch-cheatsheet</span></a></p>\n<p><a class=\"fancybox\" href=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/torch.png\" rel=\"gallery0\"><span style=\"color: #0066cc;\"><img src=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/torch.png\" alt=\"\"></span></a></p>\n<h2 id=\"数学\">数学\n</h2><p>如果你想真正的理解机器学习，你需要有扎实的统计学(尤其是概率论), 线性代数以及微积分基础。我在上大学的时候辅修了数学专业，但是我肯定还是需要对这些数学知识进行复习。如果你想理解常用机器学习算法背后的数学原理，那么下面的这些速查表将会是你需要的。</p>\n<h3 id=\"概率论\">概率论\n</h3><p>链接: <a href=\"http://www.wzchen.com/s/probability_cheatsheet.pdf\" target=\"_blank\" rel=\"external\"><span style=\"color: #0066cc;\">http://www.wzchen.com/s/probability_cheatsheet.pdf</span></a></p>\n<p><a class=\"fancybox\" href=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/prob.png\" rel=\"gallery0\"><span style=\"color: #0066cc;\"><img src=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/prob.png\" alt=\"\"></span></a></p>\n<h3 id=\"线性代数\">线性代数\n</h3><p>链接: <a href=\"https://minireference.com/static/tutorials/linear_algebra_in_4_pages.pdf\" target=\"_blank\" rel=\"external\"><span style=\"color: #0066cc;\">https://minireference.com/static/tutorials/linear_algebra_in_4_pages.pdf</span></a></p>\n<p><a class=\"fancybox\" href=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/la.png\" rel=\"gallery0\"><span style=\"color: #0066cc;\"><img src=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/la.png\" alt=\"\"></span></a></p>\n<h3 id=\"统计学\">统计学\n</h3><p>链接: <a href=\"http://web.mit.edu/~csvoss/Public/usabo/stats_handout.pdf\" target=\"_blank\" rel=\"external\"><span style=\"color: #0066cc;\">http://web.mit.edu/~csvoss/Public/usabo/stats_handout.pdf</span></a></p>\n<p><a class=\"fancybox\" href=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/stat.png\" rel=\"gallery0\"><span style=\"color: #0066cc;\"><img src=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/stat.png\" alt=\"\"></span></a></p>\n<h3 id=\"微积分\">微积分\n</h3><p>链接: <a href=\"http://tutorial.math.lamar.edu/getfile.aspx?file=B,41,N\" target=\"_blank\" rel=\"external\"><span style=\"color: #0066cc;\">http://tutorial.math.lamar.edu/getfile.aspx?file=B,41,N</span></a></p>\n<p><a class=\"fancybox\" href=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/calculus.png\" rel=\"gallery0\"><img src=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/calculus.png\" alt=\"\"></a></p>\n<p>打包下载：<a href=\"https://www.dropbox.com/s/v3yg8djhdf24g6v/UnsupervisedMethods.com%20-%20Cheat%20Sheets.zip?dl=0\" target=\"_blank\">Dropbox</a>、<a href=\"https://pan.baidu.com/s/1mi0viGS\" target=\"_blank\">百度云</a></p>\n\r\n        \r\n            <blockquote class=\"rewards\">\n        <p><strong>打赏支持我翻译更多好文章，谢谢！</strong></p>\n        <a href=\"#rewardbox\" id=\"rewards-button\" class=\"fancybox\"><span class=\"btn-bluet-blue href-style\"><i class=\"fa fa-jpy\"></i> 打赏译者</span></a>\n    </blockquote>\n\n    <div id=\"rewardbox\">\n        <h4>打赏支持我翻译更多好文章，谢谢！</h4>\n                <p>\n                        <img src=\"http://jbcdn2.b0.upaiyun.com/2016/05/c3d3aeee3e50259c10c3524201fc68db.jpg\">\n            \n                    </p>\n    </div>\n\n    \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112009\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112009votetotal\">5</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112009\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 15 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/shaozhengjiang\">iPytLab</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/shaozhengjiang\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/d3f741a9dd5c4194b365e95b06a56c09.jpeg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            喜欢写程序的计算化学狗，Python/C/C++/Fortran, 个人博客 http://pytlab.org        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/shaozhengjiang\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/shaozhengjiang/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/shaozhengjiang/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 11</a> · <a title=\"我的网站\" target=\"_blank\" href=\"http://pytlab.org\"><i class=\"fa fa-link\"></i></a> <a title=\"微博主页\" target=\"_blank\" href=\"http://weibo.com/shaowugui\"><i class=\"fa fa-weibo\"></i></a> <a title=\"GitHub主页\" target=\"_blank\" href=\"https://github.com/PytLab\"><i class=\"fa fa-github\"></i></a> <a title=\"Stack Overflow主页\" target=\"_blank\" href=\"http://stackoverflow.com/users/4014840/pytlab\"><i class=\"fa fa-stack-overflow\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "post_url": "http://blog.jobbole.com/112009/", "tag_name": "工具与资源，Python，数学，机器学习", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/04/ff247977ac3e5237654ad324e8c880ed.jpg"], "url_object_id": "edadb3aea0db398bd4790e74f9295bb1"},
{"title": "MySQL EXPLAIN 详解", "creat_time": "2017-07-30", "praise_count": "1", "bookmark_count": 3, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.jianshu.com/p/ea3fc71fdc45\">高广超</a>   </div><p>MySQL EXPLAIN命令是查询性能优化不可缺少的一部分，该文主要讲解explain命令的使用及相关参数说明。</p>\n<h3>EXPLAIN Output Columns</h3>\n<table>\n<thead>\n<tr>\n<th>列名</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>id</td>\n<td>执行编号，标识select所属的行。如果在语句中没子查询或关联查询，只有唯一的select，每行都将显示1。否则，内层的select语句一般会顺序编号，对应于其在原始语句中的位置</td>\n</tr>\n<tr>\n<td>select_type</td>\n<td>显示本行是简单或复杂select。如果查询有任何复杂的子查询，则最外层标记为PRIMARY（DERIVED、UNION、UNION RESUlT）</td>\n</tr>\n<tr>\n<td>table</td>\n<td>访问引用哪个表（引用某个查询，如“derived3”）</td>\n</tr>\n<tr>\n<td>type</td>\n<td>数据访问/读取操作类型（ALL、index、range、ref、eq_ref、const/system、NULL）</td>\n</tr>\n<tr>\n<td>possible_keys</td>\n<td>揭示哪一些索引可能有利于高效的查找</td>\n</tr>\n<tr>\n<td>key</td>\n<td>显示mysql决定采用哪个索引来优化查询</td>\n</tr>\n<tr>\n<td>key_len</td>\n<td>显示mysql在索引里使用的字节数</td>\n</tr>\n<tr>\n<td>ref</td>\n<td>显示了之前的表在key列记录的索引中查找值所用的列或常量</td>\n</tr>\n<tr>\n<td>rows</td>\n<td>为了找到所需的行而需要读取的行数，估算值，不精确。通过把所有rows列值相乘，可粗略估算整个查询会检查的行数</td>\n</tr>\n<tr>\n<td>Extra</td>\n<td>额外信息，如using index、filesort等</td>\n</tr>\n</tbody>\n</table>\n<h4>id</h4>\n<p>id是用来顺序标识整个查询中SELELCT 语句的，在嵌套查询中id越大的语句越先执行。该值可能为NULL，如果这一行用来说明的是其他行的联合结果。</p>\n<h4>select_type</h4>\n<p>表示查询的类型</p>\n<table>\n<thead>\n<tr>\n<th>类型</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>simple</td>\n<td>简单子查询，不包含子查询和union</td>\n</tr>\n<tr>\n<td>primary</td>\n<td>包含union或者子查询，最外层的部分标记为primary</td>\n</tr>\n<tr>\n<td>subquery</td>\n<td>一般子查询中的子查询被标记为subquery，也就是位于select列表中的查询</td>\n</tr>\n<tr>\n<td>derived</td>\n<td>派生表——该临时表是从子查询派生出来的，位于form中的子查询</td>\n</tr>\n<tr>\n<td>union</td>\n<td>位于union中第二个及其以后的子查询被标记为union，第一个就被标记为primary如果是union位于from中则标记为derived</td>\n</tr>\n<tr>\n<td>union result</td>\n<td>用来从匿名临时表里检索结果的select被标记为union result</td>\n</tr>\n<tr>\n<td>dependent union</td>\n<td>顾名思义，首先需要满足UNION的条件，及UNION中第二个以及后面的SELECT语句，同时该语句依赖外部的查询</td>\n</tr>\n<tr>\n<td>subquery</td>\n<td>子查询中第一个SELECT语句</td>\n</tr>\n<tr>\n<td>dependent subquery</td>\n<td>和DEPENDENT UNION相对UNION一样</td>\n</tr>\n</tbody>\n</table>\n<h4>table</h4>\n<p>对应行正在访问哪一个表，表名或者别名</p>\n<ul>\n<li>关联优化器会为查询选择关联顺序，左侧深度优先</li>\n<li>当from中有子查询的时候，表名是derivedN的形式，N指向子查询，也就是explain结果中的下一列</li>\n<li>当有union result的时候，表名是union 1,2等的形式，1,2表示参与union的query id</li>\n</ul>\n<p>注意：MySQL对待这些表和普通表一样，但是这些“临时表”是没有任何索引的。</p>\n<h4>type</h4>\n<p>type显示的是访问类型，是较为重要的一个指标，结果值从好到坏依次是：<br>\nsystem &gt; const &gt; eq_ref &gt; ref &gt; fulltext &gt; ref_or_null &gt; index_merge &gt; unique_subquery &gt; index_subquery &gt; range &gt; index &gt; ALL ，一般来说，得保证查询至少达到range级别，最好能达到ref。</p>\n<table>\n<thead>\n<tr>\n<th>类型</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>All</td>\n<td>最坏的情况,全表扫描</td>\n</tr>\n<tr>\n<td>index</td>\n<td>和全表扫描一样。只是扫描表的时候按照索引次序进行而不是行。主要优点就是避免了排序, 但是开销仍然非常大。如在Extra列看到Using index，说明正在使用覆盖索引，只扫描索引的数据，它比按索引次序全表扫描的开销要小很多</td>\n</tr>\n<tr>\n<td>range</td>\n<td>范围扫描，一个有限制的索引扫描。key 列显示使用了哪个索引。当使用=、 &lt;&gt;、&gt;、&gt;=、&lt;、&lt;=、IS NULL、&lt;=&gt;、BETWEEN 或者 IN 操作符,用常量比较关键字列时,可以使用 range</td>\n</tr>\n<tr>\n<td>ref</td>\n<td>一种索引访问，它返回所有匹配某个单个值的行。此类索引访问只有当使用非唯一性索引或唯一性索引非唯一性前缀时才会发生。这个类型跟eq_ref不同的是，它用在关联操作只使用了索引的最左前缀，或者索引不是UNIQUE和PRIMARY KEY。ref可以用于使用=或&lt;=&gt;操作符的带索引的列。</td>\n</tr>\n<tr>\n<td>eq_ref</td>\n<td>最多只返回一条符合条件的记录。使用唯一性索引或主键查找时会发生 （高效）</td>\n</tr>\n<tr>\n<td>const</td>\n<td>当确定最多只会有一行匹配的时候，MySQL优化器会在查询前读取它而且只读取一次，因此非常快。当主键放入where子句时，mysql把这个查询转为一个常量（高效）</td>\n</tr>\n<tr>\n<td>system</td>\n<td>这是const连接类型的一种特例，表仅有一行满足条件。</td>\n</tr>\n<tr>\n<td>Null</td>\n<td>意味说mysql能在优化阶段分解查询语句，在执行阶段甚至用不到访问表或索引（高效）</td>\n</tr>\n</tbody>\n</table>\n<h4>possible_keys</h4>\n<p>显示查询使用了哪些索引，表示该索引可以进行高效地查找，但是列出来的索引对于后续优化过程可能是没有用的</p>\n<h4>key</h4>\n<p>key列显示MySQL实际决定使用的键（索引）。如果没有选择索引，键是NULL。要想强制MySQL使用或忽视possible_keys列中的索引，在查询中使用FORCE INDEX、USE INDEX或者IGNORE INDEX。</p>\n<h4>key_len</h4>\n<p>key_len列显示MySQL决定使用的键长度。如果键是NULL，则长度为NULL。使用的索引的长度。在不损失精确性的情况下，长度越短越好 。</p>\n<h4>ref</h4>\n<p>ref列显示使用哪个列或常数与key一起从表中选择行。</p>\n<h4>rows</h4>\n<p>rows列显示MySQL认为它执行查询时必须检查的行数。注意这是一个预估值。</p>\n<h4>Extra</h4>\n<p>Extra是EXPLAIN输出中另外一个很重要的列，该列显示MySQL在查询过程中的一些详细信息，MySQL查询优化器执行查询的过程中对查询计划的重要补充信息。</p>\n<table>\n<thead>\n<tr>\n<th>类型</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Using filesort</td>\n<td>MySQL有两种方式可以生成有序的结果，通过排序操作或者使用索引，当Extra中出现了Using filesort 说明MySQL使用了后者，但注意虽然叫filesort但并不是说明就是用了文件来进行排序，只要可能排序都是在内存里完成的。大部分情况下利用索引排序更快，所以一般这时也要考虑优化查询了。使用文件完成排序操作，这是可能是ordery by，group by语句的结果，这可能是一个CPU密集型的过程，可以通过选择合适的索引来改进性能，用索引来为查询结果排序。</td>\n</tr>\n<tr>\n<td>Using temporary</td>\n<td>用临时表保存中间结果，常用于GROUP BY 和 ORDER BY操作中，一般看到它说明查询需要优化了，就算避免不了临时表的使用也要尽量避免硬盘临时表的使用。</td>\n</tr>\n<tr>\n<td>Not exists</td>\n<td>MYSQL优化了LEFT JOIN，一旦它找到了匹配LEFT JOIN标准的行， 就不再搜索了。</td>\n</tr>\n<tr>\n<td>Using index</td>\n<td>说明查询是覆盖了索引的，不需要读取数据文件，从索引树（索引文件）中即可获得信息。如果同时出现using where，表明索引被用来执行索引键值的查找，没有using where，表明索引用来读取数据而非执行查找动作。这是MySQL服务层完成的，但无需再回表查询记录。</td>\n</tr>\n<tr>\n<td>Using index condition</td>\n<td>这是MySQL 5.6出来的新特性，叫做“索引条件推送”。简单说一点就是MySQL原来在索引上是不能执行如like这样的操作的，但是现在可以了，这样减少了不必要的IO操作，但是只能用在二级索引上。</td>\n</tr>\n<tr>\n<td>Using where</td>\n<td>使用了WHERE从句来限制哪些行将与下一张表匹配或者是返回给用户。<strong>注意</strong>：Extra列出现Using where表示MySQL服务器将存储引擎返回服务层以后再应用WHERE条件过滤。</td>\n</tr>\n<tr>\n<td>Using join buffer</td>\n<td>使用了连接缓存：<strong>Block Nested Loop</strong>，连接算法是块嵌套循环连接;<strong>Batched Key Access</strong>，连接算法是批量索引连接</td>\n</tr>\n<tr>\n<td>impossible where</td>\n<td>where子句的值总是false，不能用来获取任何元组</td>\n</tr>\n<tr>\n<td>select tables optimized away</td>\n<td>在没有GROUP BY子句的情况下，基于索引优化MIN/MAX操作，或者对于MyISAM存储引擎优化COUNT(*)操作，不必等到执行阶段再进行计算，查询执行计划生成的阶段即完成优化。</td>\n</tr>\n<tr>\n<td>distinct</td>\n<td>优化distinct操作，在找到第一匹配的元组后即停止找同样值的动作</td>\n</tr>\n</tbody>\n</table>\n<h3>参考资料</h3>\n<p>高性能mysql第三版<br>\n<a href=\"https://dev.mysql.com/doc/refman/5.7/en/explain-output.html\" target=\"_blank\">https://dev.mysql.com/doc/refman/5.7/en/explain-output.html</a></p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112021\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112021votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112021\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 3 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "post_url": "http://blog.jobbole.com/112021/", "tag_name": "IT技术，MySQL，数据库", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/11/e78e36715813f49e9e62fe0c6050075c.png"], "url_object_id": "d5fef9276de73d832c00914fd1bc2fc4"},
{"title": "Redis 核心概念", "creat_time": "2017-07-30", "praise_count": "2", "bookmark_count": 8, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.jianshu.com/p/2a4a57c5e313\">高广超</a>   </div><h3>概述</h3>\n<p>Redis 与其他 key – value 缓存产品有以下三个特点：</p>\n<ol>\n<li>Redis支持数据的持久化，可以将内存中的数据保持在磁盘中，重启的时候可以再次加载进行使用。</li>\n<li>Redis不仅仅支持简单的key-value类型的数据，同时还提供list，set，zset，hash等数据结构的存储。</li>\n<li>Redis支持数据的备份，即master-slave模式的数据备份。</li>\n</ol>\n<table>\n<thead>\n<tr>\n<th>概念</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Redis 优势</td>\n<td>1. 性能极高 – Redis能读的速度是110000次/s,写的速度是81000次/s 。\n<p>2. 丰富的数据类型 – Redis支持二进制案例的 Strings, Lists, Hashes, Sets 及 Ordered Sets 数据类型操作。</p>\n<p>3. 原子 – Redis的所有操作都是原子性的，同时Redis还支持对几个操作全并后的原子性执行。</p>\n<p>4. 丰富的特性 – Redis还支持 publish/subscribe, 通知, key 过期等等特性。</p></td>\n</tr>\n<tr>\n<td>Redis与其他key-value存储有什么不同？</td>\n<td>1. Redis有着更为复杂的数据结构并且提供对他们的原子性操作，这是一个不同于其他数据库的进化路径。Redis的数据类型都是基于基本数据结构的同时对程序员透明，无需进行额外的抽象。\n<p>2. Redis运行在内存中但是可以持久化到磁盘，所以在对不同数据集进行高速读写时需要权衡内存，应为数据量不能大于硬件内存。在内存数据库方面的另一个优点是， 相比在磁盘上相同的复杂的数据结构，在内存中操作起来非常简单，这样Redis可以做很多内部复杂性很强的事情。 同时，在磁盘格式方面他们是紧凑的以追加的方式产生的，因为他们并不需要进行随机访问。</p></td>\n</tr>\n</tbody>\n</table>\n<h4>数据类型</h4>\n<table>\n<thead>\n<tr>\n<th>概念</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>String（字符串）</td>\n<td>string是redis最基本的类型，你可以理解成与Memcached一模一样的类型，一个key对应一个value。\n<p>string类型是二进制安全的。意思是redis的string可以包含任何数据。比如jpg图片或者序列化的对象 。</p>\n<p>string类型是Redis最基本的数据类型，一个键最大能存储512MB。</p></td>\n</tr>\n<tr>\n<td>Hash（哈希）</td>\n<td>Redis hash 是一个键值对集合。\n<p>Redis hash是一个string类型的field和value的映射表，hash特别适合用于存储对象。</p>\n<p>每个 hash 可以存储 2 *32 – 1键值对（40多亿）。</p></td>\n</tr>\n<tr>\n<td>List（列表）</td>\n<td>Redis 列表是简单的字符串列表，按照插入顺序排序。你可以添加一个元素导列表的头部（左边）或者尾部（右边）。\n<p>列表最多可存储 2*32 – 1元素 (4294967295, 每个列表可存储40多亿)。</p></td>\n</tr>\n<tr>\n<td>Set（集合）</td>\n<td>Redis的Set是string类型的无序集合。\n<p>集合是通过哈希表实现的，所以添加，删除，查找的复杂度都是O(1)。</p>\n<p>集合中最大的成员数为 2<em> 32 – 1(4294967295, 每个集合可存储40多亿个成员)。<br>\n<strong>* </strong></em></p></td>\n</tr>\n<tr>\n<td>zset(sorted set：有序集合)</td>\n<td>Redis zset 和 set 一样也是string类型元素的集合,且不允许重复的成员。\n<p>不同的是每个元素都会关联一个double类型的分数。redis正是通过分数来为集合中的成员进行从小到大的排序。</p>\n<p>zset的成员是唯一的,但分数(score)却可以重复。</p></td>\n</tr>\n</tbody>\n</table>\n<h4>基本概念</h4>\n<table>\n<thead>\n<tr>\n<th>概念</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>HyperLogLog</td>\n<td>Redis 在 2.8.9 版本添加了 HyperLogLog 结构。\n<p>Redis HyperLogLog 是用来做基数统计的算法，HyperLogLog 的优点是，在输入元素的数量或者体积非常非常大时，计算基数所需的空间总是固定 的、并且是很小的。</p>\n<p>在 Redis 里面，每个 HyperLogLog 键只需要花费 12 KB 内存，就可以计算接近 2^64 个不同元素的基 数。这和计算基数时，元素越多耗费内存就越多的集合形成鲜明对比。</p>\n<p>但是，因为 HyperLogLog 只会根据输入元素来计算基数，而不会储存输入元素本身，所以 HyperLogLog 不能像集合那样，返回输入的各个元素。</p>\n<p>什么是基数?</p>\n<p>比如数据集 {1, 3, 5, 7, 5, 7, 8}， 那么这个数据集的基数集为 {1, 3, 5 ,7, 8}, 基数(不重复元素)为5。 基数估计就是在误差可接受的范围内，快速计算基数。</p></td>\n</tr>\n<tr>\n<td>发布订阅</td>\n<td>Redis 发布订阅(pub/sub)是一种消息通信模式：发送者(pub)发送消息，订阅者(sub)接收消息。\n<p>Redis 客户端可以订阅任意数量的频道。</p>\n<p>下图展示了频道 channel1 ， 以及订阅这个频道的三个客户端 —— client2 、 client5 和 client1 之间的关系：</p>\n<div>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/ab86674b7a9021d28c5d48f0dd02577f.png\"></p>\n<div>pubsub1</div>\n</div>\n<p>当有新消息通过 PUBLISH 命令发送给频道 channel1 时， 这个消息就会被发送给订阅它的三个客户端：</p>\n<div>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/3d22f3afc11b262baf8ae1db4f7ab4f3.png\"></p>\n<div>pubsub2</div>\n</div>\n</td>\n</tr>\n<tr>\n<td>Redis 事务</td>\n<td>Redis 事务可以一次执行多个命令， 并且带有以下两个重要的保证：\n<p>1. 事务是一个单独的隔离操作：事务中的所有命令都会序列化、按顺序地执行。事务在执行的过程中，不会被其他客户端发送来的命令请求所打断。</p>\n<p>2. 事务是一个原子操作：事务中的命令要么全部被执行，要么全部都不执行。</p>\n<p>一个事务从开始到执行会经历以下三个阶段：</p>\n<p>a. 开始事务。</p>\n<p>b. 命令入队。</p>\n<p>c. 执行事务。</p></td>\n</tr>\n</tbody>\n</table>\n<h4>复制（Replication）</h4>\n<p>Redis 支持简单且易用的主从复制（master-slave replication）功能， 该功能可以让从服务器(slave server)成为主服务器(master server)的精确复制品。</p>\n<p><strong> 以下是关于 Redis 复制功能的几个重要方面：</strong></p>\n<ol>\n<li>Redis 使用异步复制。 从 Redis 2.8 开始， 从服务器会以每秒一次的频率向主服务器报告复制流（replication stream）的处理进度。</li>\n<li>一个主服务器可以有多个从服务器。</li>\n<li>不仅主服务器可以有从服务器， 从服务器也可以有自己的从服务器， 多个从服务器之间可以构成一个图状结构。</li>\n<li>复制功能不会阻塞主服务器： 即使有一个或多个从服务器正在进行初次同步， 主服务器也可以继续处理命令请求。</li>\n<li>复制功能也不会阻塞从服务器： 只要在 redis.conf 文件中进行了相应的设置， 即使从服务器正在进行初次同步， 服务器也可以使用旧版本的数据集来处理命令查询。不过， 在从服务器删除旧版本数据集并载入新版本数据集的那段时间内， 连接请求会被阻塞。<br>\n你还可以配置从服务器， 让它在与主服务器之间的连接断开时， 向客户端发送一个错误。</li>\n<li>复制功能可以单纯地用于数据冗余（data redundancy）， 也可以通过让多个从服务器处理只读命令请求来提升扩展性（scalability）： 比如说， 繁重的 <a href=\"http://doc.redisfans.com/key/sort.html#sort\" target=\"_blank\">SORT</a> 命令可以交给附属节点去运行。</li>\n<li>可以通过复制功能来让主服务器免于执行持久化操作： 只要关闭主服务器的持久化功能， 然后由从服务器去执行持久化操作即可。</li>\n</ol>\n<table>\n<thead>\n<tr>\n<th>概念</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>复制功能的运作原理</td>\n<td>无论是初次连接还是重新连接， 当建立一个从服务器时， 从服务器都将向主服务器发送一个 <a href=\"http://doc.redisfans.com/server/sync.html#sync\" target=\"_blank\">SYNC</a> 命令。\n<p>接到 <a href=\"http://doc.redisfans.com/server/sync.html#sync\" target=\"_blank\">SYNC</a> 命令的主服务器将开始执行 <a href=\"http://doc.redisfans.com/server/bgsave.html#bgsave\" target=\"_blank\">BGSAVE</a> ， 并在保存操作执行期间， 将所有新执行的写入命令都保存到一个缓冲区里面。</p>\n<p>当 <a href=\"http://doc.redisfans.com/server/bgsave.html#bgsave\" target=\"_blank\">BGSAVE</a> 执行完毕后， 主服务器将执行保存操作所得的 .rdb 文件发送给从服务器， 从服务器接收这个 .rdb 文件， 并将文件中的数据载入到内存中。</p>\n<p>之后主服务器会以 Redis 命令协议的格式， 将写命令缓冲区中积累的所有内容都发送给从服务器。</p>\n<p>你可以通过 telnet 命令来亲自验证这个同步过程： 首先连上一个正在处理命令请求的 Redis 服务器， 然后向它发送 <a href=\"http://doc.redisfans.com/server/sync.html#sync\" target=\"_blank\">SYNC</a> 命令， 过一阵子， 你将看到 telnet 会话（session）接收到服务器发来的大段数据（.rdb 文件）， 之后还会看到， 所有在服务器执行过的写命令， 都会重新发送到 telnet 会话来。</p>\n<p>即使有多个从服务器同时向主服务器发送 <a href=\"http://doc.redisfans.com/server/sync.html#sync\" target=\"_blank\">SYNC</a> ， 主服务器也只需执行一次 <a href=\"http://doc.redisfans.com/server/bgsave.html#bgsave\" target=\"_blank\">BGSAVE</a> 命令， 就可以处理所有这些从服务器的同步请求。</p>\n<p>从服务器可以在主从服务器之间的连接断开时进行自动重连， 在 Redis 2.8 版本之前， 断线之后重连的从服务器总要执行一次完整重同步（full resynchronization）操作， 但是从 Redis 2.8 版本开始， 从服务器可以根据主服务器的情况来选择执行完整重同步还是部分重同步（partial resynchronization）。</p></td>\n</tr>\n<tr>\n<td>部分重同步</td>\n<td>从 Redis 2.8 开始， 在网络连接短暂性失效之后， 主从服务器可以尝试继续执行原有的复制进程（process）， 而不一定要执行完整重同步操作。\n<p>这个特性需要主服务器为被发送的复制流创建一个内存缓冲区（in-memory backlog）， 并且主服务器和所有从服务器之间都记录一个复制偏移量（replication offset）和一个主服务器 ID （master run id）， 当出现网络连接断开时， 从服务器会重新连接， 并且向主服务器请求继续执行原来的复制进程：</p>\n<p>1. 如果从服务器记录的主服务器 ID 和当前要连接的主服务器的 ID 相同， 并且从服务器记录的偏移量所指定的数据仍然保存在主服务器的复制流缓冲区里面， 那么主服务器会向从服务器发送断线时缺失的那部分数据， 然后复制工作可以继续执行。</p>\n<p>2. 否则的话， 从服务器就要执行完整重同步操作。</p>\n<p>Redis 2.8 的这个部分重同步特性会用到一个新增的 <a href=\"http://doc.redisfans.com/server/psync.html#psync\" target=\"_blank\">PSYNC</a> 内部命令， 而 Redis 2.8 以前的旧版本只有 <a href=\"http://doc.redisfans.com/server/sync.html#sync\" target=\"_blank\">SYNC</a> 命令， 不过， 只要从服务器是 Redis 2.8 或以上的版本， 它就会根据主服务器的版本来决定到底是使用 <a href=\"http://doc.redisfans.com/server/psync.html#psync\" target=\"_blank\">PSYNC</a> 还是 <a href=\"http://doc.redisfans.com/server/sync.html#sync\" target=\"_blank\">SYNC</a> ：</p>\n<p>1. 如果主服务器是 Redis 2.8 或以上版本，那么从服务器使用 <a href=\"http://doc.redisfans.com/server/psync.html#psync\" target=\"_blank\">PSYNC</a> 命令来进行同步。</p>\n<p>2. 如果主服务器是 Redis 2.8 之前的版本，那么从服务器使用 <a href=\"http://doc.redisfans.com/server/sync.html#sync\" target=\"_blank\">SYNC</a> 命令来进行同步。</p></td>\n</tr>\n<tr>\n<td>只读从服务器</td>\n<td>从 Redis 2.6 开始， 从服务器支持只读模式， 并且该模式为从服务器的默认模式。\n<p>只读模式由 redis.conf 文件中的 slave-read-only 选项控制， 也可以通过 <a href=\"http://doc.redisfans.com/server/config_set.html#config-set\" target=\"_blank\">CONFIG SET</a> 命令来开启或关闭这个模式。</p>\n<p>只读从服务器会拒绝执行任何写命令， 所以不会出现因为操作失误而将数据不小心写入到了从服务器的情况。</p>\n<p>即使从服务器是只读的， DEBUG 和 CONFIG 等管理式命令仍然是可以使用的， 所以我们还是不应该将服务器暴露给互联网或者任何不可信网络。 不过， 使用 redis.conf 中的命令改名选项， 我们可以通过禁止执行某些命令来提升只读从服务器的安全性。</p>\n<p>你可能会感到好奇， 既然从服务器上的写数据会被重同步数据覆盖， 也可能在从服务器重启时丢失， 那么为什么要让一个从服务器变得可写呢？</p>\n<p>原因是， 一些不重要的临时数据， 仍然是可以保存在从服务器上面的。 比如说， 客户端可以在从服务器上保存主服务器的可达性（reachability）信息， 从而实现故障转移（failover）策略。</p></td>\n</tr>\n<tr>\n<td>主服务器只在有至少 N 个从服务器的情况下，才执行写操作</td>\n<td>从 Redis 2.8 开始， 为了保证数据的安全性， 可以通过配置， 让主服务器只在有至少 N 个当前已连接从服务器的情况下， 才执行写命令。\n<p>不过， 因为 Redis 使用异步复制， 所以主服务器发送的写数据并不一定会被从服务器接收到， 因此， 数据丢失的可能性仍然是存在的。</p>\n<p>以下是这个特性的运作原理：</p>\n<p>1 从服务器以每秒一次的频率 PING 主服务器一次， 并报告复制流的处理情况。</p>\n<p>2 主服务器会记录各个从服务器最后一次向它发送 PING 的时间。</p>\n<p>3 用户可以通过配置， 指定网络延迟的最大值 ， 以及执行写操作所需的至少从服务器数量如果至少有 min-slaves-to-write 个从服务器， 并且这些服务器的延迟值都少于 min-slaves-max-lag 秒， 那么主服务器就会执行客户端请求的写操作。</p>\n<p>你可以将这个特性看作 CAP 理论中的 C 的条件放宽版本： 尽管不能保证写操作的持久性， 但起码丢失数据的窗口会被严格限制在指定的秒数中。</p>\n<p>另一方面， 如果条件达不到min-slaves-to-write 和 min-slaves-max-lag 所指定的条件， 那么写操作就不会被执行， 主服务器会向请求执行写操作的客户端返回一个错误。</p>\n<p>以下是这个特性的两个选项和它们所需的参数：</p>\n<p>1 min-slaves-to-write</p>\n<p>2 min-slaves-max-lag</p>\n<p>详细的信息可以参考 Redis 源码中附带的 redis.conf 示例文件。</p></td>\n</tr>\n</tbody>\n</table>\n<h4>事务（transaction）</h4>\n<p><a href=\"http://doc.redisfans.com/transaction/multi.html#multi\" target=\"_blank\">MULTI</a> 、 <a href=\"http://doc.redisfans.com/transaction/exec.html#exec\" target=\"_blank\">EXEC</a> 、 <a href=\"http://doc.redisfans.com/transaction/discard.html#discard\" target=\"_blank\">DISCARD</a> 和 <a href=\"http://doc.redisfans.com/transaction/watch.html#watch\" target=\"_blank\">WATCH</a> 是 Redis 事务的基础。<br>\n事务可以一次执行多个命令， 并且带有以下两个重要的保证：</p>\n<ol>\n<li>事务是一个单独的隔离操作：事务中的所有命令都会序列化、按顺序地执行。事务在执行的过程中，不会被其他客户端发送来的命令请求所打断。</li>\n<li>事务是一个原子操作：事务中的命令要么全部被执行，要么全部都不执行。<br>\n<a href=\"http://doc.redisfans.com/transaction/exec.html#exec\" target=\"_blank\">EXEC</a> 命令负责触发并执行事务中的所有命令：\n<ul>\n<li>如果客户端在使用 <a href=\"http://doc.redisfans.com/transaction/multi.html#multi\" target=\"_blank\">MULTI</a> 开启了一个事务之后，却因为断线而没有成功执行 <a href=\"http://doc.redisfans.com/transaction/exec.html#exec\" target=\"_blank\">EXEC</a> ，那么事务中的所有命令都不会被执行。</li>\n<li>另一方面，如果客户端成功在开启事务之后执行 <a href=\"http://doc.redisfans.com/transaction/exec.html#exec\" target=\"_blank\">EXEC</a> ，那么事务中的所有命令都会被执行。<br>\n当使用 AOF 方式做持久化的时候， Redis 会使用单个 write(2) 命令将事务写入到磁盘中。</li>\n</ul>\n</li>\n</ol>\n<p>然而，如果 Redis 服务器因为某些原因被管理员杀死，或者遇上某种硬件故障，那么可能只有部分事务命令会被成功写入到磁盘中。<br>\n如果 Redis 在重新启动时发现 AOF 文件出了这样的问题，那么它会退出，并汇报一个错误。<br>\n使用 redis-check-aof 程序可以修复这一问题：它会移除 AOF 文件中不完整事务的信息，确保服务器可以顺利启动。<br>\n从 2.2 版本开始，Redis 还可以通过乐观锁（optimistic lock）实现 CAS （check-and-set）操作，具体信息请参考文档的后半部分。</p>\n<table>\n<thead>\n<tr>\n<th>概念</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>事务中的错误</td>\n<td>使用事务时可能会遇上以下两种错误：\n<p>1. 事务在执行 <a href=\"http://doc.redisfans.com/transaction/exec.html#exec\" target=\"_blank\">EXEC</a> 之前，入队的命令可能会出错。比如说，命令可能会产生语法错误（参数数量错误，参数名错误，等等），或者其他更严重的错误，比如内存不足（如果服务器使用 maxmemory 设置了最大内存限制的话）。</p>\n<p>2. 命令可能在 <a href=\"http://doc.redisfans.com/transaction/exec.html#exec\" target=\"_blank\">EXEC</a> 调用之后失败。举个例子，事务中的命令可能处理了错误类型的键，比如将列表命令用在了字符串键上面，诸如此类。</p>\n<p>对于发生在 <a href=\"http://doc.redisfans.com/transaction/exec.html#exec\" target=\"_blank\">EXEC</a> 执行之前的错误，客户端以前的做法是检查命令入队所得的返回值：如果命令入队时返回 QUEUED ，那么入队成功；否则，就是入队失败。如果有命令在入队时失败，那么大部分客户端都会停止并取消这个事务。</p>\n<p>不过，从 Redis 2.6.5 开始，服务器会对命令入队失败的情况进行记录，并在客户端调用 <a href=\"http://doc.redisfans.com/transaction/exec.html#exec\" target=\"_blank\">EXEC</a> 命令时，拒绝执行并自动放弃这个事务。</p>\n<p>在 Redis 2.6.5 以前， Redis 只执行事务中那些入队成功的命令，而忽略那些入队失败的命令。 而新的处理方式则使得在流水线（pipeline）中包含事务变得简单，因为发送事务和读取事务的回复都只需要和服务器进行一次通讯。</p>\n<p>至于那些在 <a href=\"http://doc.redisfans.com/transaction/exec.html#exec\" target=\"_blank\">EXEC</a> 命令执行之后所产生的错误， 并没有对它们进行特别处理： 即使事务中有某个/某些命令在执行时产生了错误， 事务中的其他命令仍然会继续执行。</p>\n<p>最重要的是记住这样一条， 即使事务中有某条/某些命令执行失败了， 事务队列中的其他命令仍然会继续执行 —— Redis 不会停止执行事务中的命令。</p></td>\n</tr>\n<tr>\n<td>Redis 不支持回滚</td>\n<td>如果你有使用关系式数据库的经验， 那么 “Redis 在事务失败时不进行回滚，而是继续执行余下的命令”这种做法可能会让你觉得有点奇怪。\n<p>以下是这种做法的优点：</p>\n<p>1. Redis 命令只会因为错误的语法而失败（并且这些问题不能在入队时发现），或是命令用在了错误类型的键上面：这也就是说，从实用性的角度来说，失败的命令是由编程错误造成的，而这些错误应该在开发的过程中被发现，而不应该出现在生产环境中。</p>\n<p>2. 因为不需要对回滚进行支持，所以 Redis 的内部可以保持简单且快速。</p>\n<p>有种观点认为 Redis 处理事务的做法会产生 bug ， 然而需要注意的是， 在通常情况下， 回滚并不能解决编程错误带来的问题。 举个例子， 如果你本来想通过 <a href=\"http://doc.redisfans.com/string/incr.html#incr\" target=\"_blank\">INCR</a> 命令将键的值加上 1 ， 却不小心加上了 2 ， 又或者对错误类型的键执行了 <a href=\"http://doc.redisfans.com/string/incr.html#incr\" target=\"_blank\">INCR</a> ， 回滚是没有办法处理这些情况的。</p>\n<p>鉴于没有任何机制能避免程序员自己造成的错误， 并且这类错误通常不会在生产环境中出现， 所以 Redis 选择了更简单、更快速的无回滚方式来处理事务。</p></td>\n</tr>\n<tr>\n<td>乐观锁</td>\n<td><a href=\"http://doc.redisfans.com/transaction/watch.html#watch\" target=\"_blank\">WATCH</a> 命令可以为 Redis 事务提供 check-and-set （CAS）行为。\n<p>被 <a href=\"http://doc.redisfans.com/transaction/watch.html#watch\" target=\"_blank\">WATCH</a> 的键会被监视，并会发觉这些键是否被改动过了。 如果有至少一个被监视的键在 <a href=\"http://doc.redisfans.com/transaction/exec.html#exec\" target=\"_blank\">EXEC</a> 执行之前被修改了， 那么整个事务都会被取消， <a href=\"http://doc.redisfans.com/transaction/exec.html#exec\" target=\"_blank\">EXEC</a> 返回空多条批量回复（null multi-bulk reply）来表示事务已经失败。</p>\n<p>举个例子， 假设我们需要原子性地为某个值进行增 1 操作（假设 <a href=\"http://doc.redisfans.com/string/incr.html#incr\" target=\"_blank\">INCR</a> 不存在）。</p>\n<p>首先我们可能会这样做：</p>\n<p>val = GETmykey</p>\n<p>val = val + 1</p>\n<p>SET mykey $val</p>\n<p>上面的这个实现在只有一个客户端的时候可以执行得很好。 但是， 当多个客户端同时对同一个键进行这样的操作时， 就会产生竞争条件。</p>\n<p>举个例子， 如果客户端 A 和 B 都读取了键原来的值， 比如 10 ， 那么两个客户端都会将键的值设为 11 ， 但正确的结果应该是 12 才对。</p>\n<p>有了 <a href=\"http://doc.redisfans.com/transaction/watch.html#watch\" target=\"_blank\">WATCH</a> ， 我们就可以轻松地解决这类问题了：</p>\n<p>WATCH mykey</p>\n<p>val = GET mykey</p>\n<p>val = val + 1</p>\n<p>MULTI</p>\n<p>SET mykey $val</p>\n<p>EXEC</p>\n<p>使用上面的代码， 如果在 <a href=\"http://doc.redisfans.com/transaction/watch.html#watch\" target=\"_blank\">WATCH</a> 执行之后， <a href=\"http://doc.redisfans.com/transaction/exec.html#exec\" target=\"_blank\">EXEC</a> 执行之前， 有其他客户端修改了 mykey 的值， 那么当前客户端的事务就会失败。 程序需要做的， 就是不断重试这个操作， 直到没有发生碰撞为止。</p>\n<p>这种形式的锁被称作乐观锁， 它是一种非常强大的锁机制。 并且因为大多数情况下， 不同的客户端会访问不同的键， 碰撞的情况一般都很少， 所以通常并不需要进行重试。</p></td>\n</tr>\n<tr>\n<td>WATCH</td>\n<td><a href=\"http://doc.redisfans.com/transaction/watch.html#watch\" target=\"_blank\">WATCH</a> 使得 <a href=\"http://doc.redisfans.com/transaction/exec.html#exec\" target=\"_blank\">EXEC</a> 命令需要有条件地执行： 事务只能在所有被监视键都没有被修改的前提下执行， 如果这个前提不能满足的话，事务就不会被执行。\n<p>如果你使用 <a href=\"http://doc.redisfans.com/transaction/watch.html#watch\" target=\"_blank\">WATCH</a> 监视了一个带过期时间的键， 那么即使这个键过期了， 事务仍然可以正常执行， 关于这方面的详细情况，请看这个帖子： <a href=\"http://code.google.com/p/redis/issues/detail?id=270\" target=\"_blank\">http://code.google.com/p/redis/issues/detail?id=270</a></p>\n<p><a href=\"http://doc.redisfans.com/transaction/watch.html#watch\" target=\"_blank\">WATCH</a> 命令可以被调用多次。 对键的监视从 <a href=\"http://doc.redisfans.com/transaction/watch.html#watch\" target=\"_blank\">WATCH</a> 执行之后开始生效， 直到调用 <a href=\"http://doc.redisfans.com/transaction/exec.html#exec\" target=\"_blank\">EXEC</a> 为止。</p>\n<p>用户还可以在单个 <a href=\"http://doc.redisfans.com/transaction/watch.html#watch\" target=\"_blank\">WATCH</a> 命令中监视任意多个键， 就像这样：</p>\n<p>redis&gt; WATCH key1 key2 key3</p>\n<p>OK</p>\n<p>当 <a href=\"http://doc.redisfans.com/transaction/exec.html#exec\" target=\"_blank\">EXEC</a> 被调用时， 不管事务是否成功执行， 对所有键的监视都会被取消。</p>\n<p>另外， 当客户端断开连接时， 该客户端对键的监视也会被取消。</p>\n<p>使用无参数的 <a href=\"http://doc.redisfans.com/transaction/unwatch.html#unwatch\" target=\"_blank\">UNWATCH</a> 命令可以手动取消对所有键的监视。 对于一些需要改动多个键的事务， 有时候程序需要同时对多个键进行加锁， 然后检查这些键的当前值是否符合程序的要求。 当值达不到要求时， 就可以使用 <a href=\"http://doc.redisfans.com/transaction/unwatch.html#unwatch\" target=\"_blank\">UNWATCH</a> 命令来取消目前对键的监视， 中途放弃这个事务， 并等待事务的下次尝试。</p>\n<p><a href=\"http://doc.redisfans.com/transaction/watch.html#watch\" target=\"_blank\">WATCH</a> 可以用于创建 Redis 没有内置的原子操作。</p></td>\n</tr>\n<tr>\n<td>Redis 脚本和事务</td>\n<td>从定义上来说， Redis 中的脚本本身就是一种事务， 所以任何在事务里可以完成的事， 在脚本里面也能完成。 并且一般来说， 使用脚本要来得更简单，并且速度更快。\n<p>因为脚本功能是 Redis 2.6 才引入的， 而事务功能则更早之前就存在了， 所以 Redis 才会同时存在两种处理事务的方法。</p>\n<p>不过我们并不打算在短时间内就移除事务功能， 因为事务提供了一种即使不使用脚本， 也可以避免竞争条件的方法， 而且事务本身的实现并不复杂。</p>\n<p>不过在不远的将来， 可能所有用户都会只使用脚本来实现事务也说不定。 如果真的发生这种情况的话， 那么我们将废弃并最终移除事务功能。</p></td>\n</tr>\n</tbody>\n</table>\n<h4>Sentinel</h4>\n<p>Redis 的 Sentinel 系统用于管理多个 Redis 服务器（instance）， 该系统执行以下三个任务：</p>\n<ol>\n<li><strong>监控（Monitoring）</strong>： Sentinel 会不断地检查你的主服务器和从服务器是否运作正常。</li>\n<li><strong>提醒（Notification）</strong>： 当被监控的某个 Redis 服务器出现问题时， Sentinel 可以通过 API 向管理员或者其他应用程序发送通知。</li>\n<li><strong>自动故障迁移（Automatic failover）</strong>： 当一个主服务器不能正常工作时， Sentinel 会开始一次自动故障迁移操作， 它会将失效主服务器的其中一个从服务器升级为新的主服务器， 并让失效主服务器的其他从服务器改为复制新的主服务器； 当客户端试图连接失效的主服务器时， 集群也会向客户端返回新主服务器的地址， 使得集群可以使用新主服务器代替失效服务器。</li>\n</ol>\n<p>Redis Sentinel 是一个分布式系统， 你可以在一个架构中运行多个 Sentinel 进程（progress）， 这些进程使用流言协议（gossip protocols)来接收关于主服务器是否下线的信息， 并使用投票协议（agreement protocols）来决定是否执行自动故障迁移， 以及选择哪个从服务器作为新的主服务器。<br>\n虽然 Redis Sentinel 释出为一个单独的可执行文件 redis-sentinel ， 但实际上它只是一个运行在特殊模式下的 Redis 服务器， 你可以在启动一个普通 Redis 服务器时通过给定 –sentinel 选项来启动 Redis Sentinel 。<br>\nRedis Sentinel 目前仍在开发中， 这个文档的内容可能随着 Sentinel 实现的修改而变更。<br>\nRedis Sentinel 兼容 Redis 2.4.16 或以上版本， 推荐使用 Redis 2.8.0 或以上的版本。</p>\n<table>\n<thead>\n<tr>\n<th>概念</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>主观下线和客观下线</td>\n<td>Redis 的 Sentinel 中关于下线（down）有两个不同的概念：\n<p>1. 主观下线（Subjectively Down， 简称 SDOWN）指的是单个 Sentinel 实例对服务器做出的下线判断。</p>\n<p>2. 客观下线（Objectively Down， 简称 ODOWN）指的是多个 Sentinel 实例在对同一个服务器做出 SDOWN 判断， 并且通过 SENTINEL is-master-down-by-addr 命令互相交流之后， 得出的服务器下线判断。 （一个 Sentinel 可以通过向另一个 Sentinel 发送 SENTINEL is-master-down-by-addr 命令来询问对方是否认为给定的服务器已下线。）</p>\n<p>如果一个服务器没有在 master-down-after-milliseconds 选项所指定的时间内， 对向它发送 <a href=\"http://doc.redisfans.com/connection/ping.html#ping\" target=\"_blank\">PING</a> 命令的 Sentinel 返回一个有效回复（valid reply）， 那么 Sentinel 就会将这个服务器标记为主观下线。</p>\n<p>服务器对 <a href=\"http://doc.redisfans.com/connection/ping.html#ping\" target=\"_blank\">PING</a> 命令的有效回复可以是以下三种回复的其中一种：</p>\n<p>1. 返回 +PONG 。</p>\n<p>2. 返回 -LOADING 错误。</p>\n<p>3. 返回 -MASTERDOWN 错误。</p>\n<p>如果服务器返回除以上三种回复之外的其他回复， 又或者在指定时间内没有回复 <a href=\"http://doc.redisfans.com/connection/ping.html#ping\" target=\"_blank\">PING</a> 命令， 那么 Sentinel 认为服务器返回的回复无效（non-valid）。</p>\n<p>注意， 一个服务器必须在 master-down-after-milliseconds 毫秒内， 一直返回无效回复才会被 Sentinel 标记为主观下线。</p>\n<p>举个例子， 如果 master-down-after-milliseconds 选项的值为 30000 毫秒（30 秒）， 那么只要服务器能在每 29 秒之内返回至少一次有效回复， 这个服务器就仍然会被认为是处于正常状态的。</p>\n<p>从主观下线状态切换到客观下线状态并没有使用严格的法定人数算法（strong quorum algorithm）， 而是使用了流言协议： 如果 Sentinel 在给定的时间范围内， 从其他 Sentinel 那里接收到了足够数量的主服务器下线报告， 那么 Sentinel 就会将主服务器的状态从主观下线改变为客观下线。 如果之后其他 Sentinel 不再报告主服务器已下线， 那么客观下线状态就会被移除。</p>\n<p>客观下线条件<strong>只适用于主服务器</strong>： 对于任何其他类型的 Redis 实例， Sentinel 在将它们判断为下线前不需要进行协商， 所以从服务器或者其他 Sentinel 永远不会达到客观下线条件。</p>\n<p>只要一个 Sentinel 发现某个主服务器进入了客观下线状态， 这个 Sentinel 就可能会被其他 Sentinel 推选出， 并对失效的主服务器执行自动故障迁移操作。</p></td>\n</tr>\n<tr>\n<td>每个 Sentinel 都需要定期执行的任务</td>\n<td>1. 每个 Sentinel 以每秒钟一次的频率向它所知的主服务器、从服务器以及其他 Sentinel 实例发送一个 <a href=\"http://doc.redisfans.com/connection/ping.html#ping\" target=\"_blank\">PING</a> 命令。\n<p>2. 如果一个实例（instance）距离最后一次有效回复 <a href=\"http://doc.redisfans.com/connection/ping.html#ping\" target=\"_blank\">PING</a> 命令的时间超过 down-after-milliseconds 选项所指定的值， 那么这个实例会被 Sentinel 标记为主观下线。 一个有效回复可以是： +PONG 、 -LOADING 或者 -MASTERDOWN 。</p>\n<p>3. 如果一个主服务器被标记为主观下线， 那么正在监视这个主服务器的所有 Sentinel 要以每秒一次的频率确认主服务器的确进入了主观下线状态。</p>\n<p>4. 如果一个主服务器被标记为主观下线， 并且有足够数量的 Sentinel （至少要达到配置文件指定的数量）在指定的时间范围内同意这一判断， 那么这个主服务器被标记为客观下线。</p>\n<p>5. 在一般情况下， 每个 Sentinel 会以每 10 秒一次的频率向它已知的所有主服务器和从服务器发送 <a href=\"http://doc.redisfans.com/server/info.html#info\" target=\"_blank\">INFO</a> 命令。 当一个主服务器被 Sentinel 标记为客观下线时， Sentinel 向下线主服务器的所有从服务器发送 <a href=\"http://doc.redisfans.com/server/info.html#info\" target=\"_blank\">INFO</a> 命令的频率会从 10 秒一次改为每秒一次。</p>\n<p>6. 当没有足够数量的 Sentinel 同意主服务器已经下线， 主服务器的客观下线状态就会被移除。 当主服务器重新向 Sentinel 的 <a href=\"http://doc.redisfans.com/connection/ping.html#ping\" target=\"_blank\">PING</a>命令返回有效回复时， 主服务器的主管下线状态就会被移除。</p></td>\n</tr>\n<tr>\n<td>自动发现 Sentinel 和从服务器</td>\n<td>一个 Sentinel 可以与其他多个 Sentinel 进行连接， 各个 Sentinel 之间可以互相检查对方的可用性， 并进行信息交换。\n<p>你无须为运行的每个 Sentinel 分别设置其他 Sentinel 的地址， 因为 Sentinel 可以通过发布与订阅功能来自动发现正在监视相同主服务器的其他 Sentinel ， 这一功能是通过向频道 <strong>sentinel</strong>:hello 发送信息来实现的。</p>\n<p>与此类似， 你也不必手动列出主服务器属下的所有从服务器， 因为 Sentinel 可以通过询问主服务器来获得所有从服务器的信息。</p>\n<p>1. 每个 Sentinel 会以每两秒一次的频率， 通过发布与订阅功能， 向被它监视的所有主服务器和从服务器的 <strong>sentinel</strong>:hello 频道发送一条信息， 信息中包含了 Sentinel 的 IP 地址、端口号和运行 ID （runid）。</p>\n<p>2. 每个 Sentinel 都订阅了被它监视的所有主服务器和从服务器的 <strong>sentinel</strong>:hello 频道， 查找之前未出现过的 sentinel （looking for unknown sentinels）。 当一个 Sentinel 发现一个新的 Sentinel 时， 它会将新的 Sentinel 添加到一个列表中， 这个列表保存了 Sentinel 已知的， 监视同一个主服务器的所有其他 Sentinel 。</p>\n<p>3. Sentinel 发送的信息中还包括完整的主服务器当前配置（configuration）。 如果一个 Sentinel 包含的主服务器配置比另一个 Sentinel 发送的配置要旧， 那么这个 Sentinel 会立即升级到新配置上。</p>\n<p>4. 在将一个新 Sentinel 添加到监视主服务器的列表上面之前， Sentinel 会先检查列表中是否已经包含了和要添加的 Sentinel 拥有相同运行 ID 或者相同地址（包括 IP 地址和端口号）的 Sentinel ， 如果是的话， Sentinel 会先移除列表中已有的那些拥有相同运行 ID 或者相同地址的 Sentinel ， 然后再添加新 Sentinel 。</p></td>\n</tr>\n<tr>\n<td>故障转移</td>\n<td>一次故障转移操作由以下步骤组成：\n<p>1. 发现主服务器已经进入客观下线状态。</p>\n<p>2. 对我们的当前纪元进行自增（详情请参考 <a href=\"https://www.google.com.hk/search?q=Raft+leader+election&amp;client=ubuntu&amp;channel=cs&amp;oq=Raft+leader+election&amp;aqs=chrome..69i57&amp;sourceid=chrome&amp;ie=UTF-8\" target=\"_blank\">Raft leader election</a> ）， 并尝试在这个纪元中当选。</p>\n<p>3. 如果当选失败， 那么在设定的故障迁移超时时间的两倍之后， 重新尝试当选。 如果当选成功， 那么执行以下步骤。</p>\n<p>4. 选出一个从服务器，并将它升级为主服务器。</p>\n<p>5. 向被选中的从服务器发送 SLAVEOF NO ONE 命令，让它转变为主服务器。</p>\n<p>6. 通过发布与订阅功能， 将更新后的配置传播给所有其他 Sentinel ， 其他 Sentinel 对它们自己的配置进行更新。</p>\n<p>7. 向已下线主服务器的从服务器发送 <a href=\"http://doc.redisfans.com/server/slaveof.html#slaveof\" target=\"_blank\">SLAVEOF</a> 命令， 让它们去复制新的主服务器。</p>\n<p>8. 当所有从服务器都已经开始复制新的主服务器时， 领头 Sentinel 终止这次故障迁移操作。</p>\n<p>每当一个 Redis 实例被重新配置（reconfigured） —— 无论是被设置成主服务器、从服务器、又或者被设置成其他主服务器的从服务器 —— Sentinel 都会向被重新配置的实例发送一个 CONFIG REWRITE 命令， 从而确保这些配置会持久化在硬盘里。</p>\n<p>Sentinel 使用以下规则来选择新的主服务器：</p>\n<p>1. 在失效主服务器属下的从服务器当中， 那些被标记为主观下线、已断线、或者最后一次回复 <a href=\"http://doc.redisfans.com/connection/ping.html#ping\" target=\"_blank\">PING</a> 命令的时间大于五秒钟的从服务器都会被淘汰。</p>\n<p>2. 在失效主服务器属下的从服务器当中， 那些与失效主服务器连接断开的时长超过 down-after 选项指定的时长十倍的从服务器都会被淘汰。</p>\n<p>3. 在经历了以上两轮淘汰之后剩下来的从服务器中， 我们选出复制偏移量（replication offset）最大的那个从服务器作为新的主服务器； 如果复制偏移量不可用， 或者从服务器的复制偏移量相同， 那么带有最小运行 ID 的那个从服务器成为新的主服务器。</p>\n<p><strong> Sentinel 自动故障迁移的一致性特质</strong></p>\n<p>Sentinel 自动故障迁移使用 Raft 算法来选举领头（leader） Sentinel ， 从而确保在一个给定的纪元（epoch）里， 只有一个领头产生。</p>\n<p>这表示在同一个纪元中， 不会有两个 Sentinel 同时被选中为领头， 并且各个 Sentinel 在同一个纪元中只会对一个领头进行投票。</p>\n<p>更高的配置纪元总是优于较低的纪元， 因此每个 Sentinel 都会主动使用更新的纪元来代替自己的配置。</p>\n<p>简单来说， 我们可以将 Sentinel 配置看作是一个带有版本号的状态。 一个状态会以最后写入者胜出（last-write-wins）的方式（也即是，最新的配置总是胜出）传播至所有其他 Sentinel 。</p>\n<p>举个例子， 当出现网络分割（<a href=\"http://en.wikipedia.org/wiki/Network_partition\" target=\"_blank\">network partitions</a>）时， 一个 Sentinel 可能会包含了较旧的配置， 而当这个 Sentinel 接到其他 Sentinel 发来的版本更新的配置时， Sentinel 就会对自己的配置进行更新。</p>\n<p>如果要在网络分割出现的情况下仍然保持一致性， 那么应该使用 min-slaves-to-write 选项， 让主服务器在连接的从实例少于给定数量时停止执行写操作， 与此同时， 应该在每个运行 Redis 主服务器或从服务器的机器上运行 Redis Sentinel 进程。</p>\n<p><strong> Sentinel 状态的持久化 </strong></p>\n<p>Sentinel 的状态会被持久化在 Sentinel 配置文件里面。</p>\n<p>每当 Sentinel 接收到一个新的配置， 或者当领头 Sentinel 为主服务器创建一个新的配置时， 这个配置会与配置纪元一起被保存到磁盘里面。</p>\n<p>这意味着停止和重启 Sentinel 进程都是安全的。</p>\n<p><strong> Sentinel 在非故障迁移的情况下对实例进行重新配置</strong></p>\n<p>即使没有自动故障迁移操作在进行， Sentinel 总会尝试将当前的配置设置到被监视的实例上面。 特别是：</p>\n<p>1. 根据当前的配置， 如果一个从服务器被宣告为主服务器， 那么它会代替原有的主服务器， 成为新的主服务器， 并且成为原有主服务器的所有从服务器的复制对象。</p>\n<p>2. 那些连接了错误主服务器的从服务器会被重新配置， 使得这些从服务器会去复制正确的主服务器。</p>\n<p>不过， 在以上这些条件满足之后， Sentinel 在对实例进行重新配置之前仍然会等待一段足够长的时间， 确保可以接收到其他 Sentinel 发来的配置更新， 从而避免自身因为保存了过期的配置而对实例进行了不必要的重新配置。</p></td>\n</tr>\n<tr>\n<td>TILT 模式</td>\n<td>Redis Sentinel 严重依赖计算机的时间功能： 比如说， 为了判断一个实例是否可用， Sentinel 会记录这个实例最后一次相应 <a href=\"http://doc.redisfans.com/connection/ping.html#ping\" target=\"_blank\">PING</a> 命令的时间， 并将这个时间和当前时间进行对比， 从而知道这个实例有多长时间没有和 Sentinel 进行任何成功通讯。\n<p>不过， 一旦计算机的时间功能出现故障， 或者计算机非常忙碌， 又或者进程因为某些原因而被阻塞时， Sentinel 可能也会跟着出现故障。</p>\n<p>TILT 模式是一种特殊的保护模式： 当 Sentinel 发现系统有些不对劲时， Sentinel 就会进入 TILT 模式。</p>\n<p>因为 Sentinel 的时间中断器默认每秒执行 10 次， 所以我们预期时间中断器的两次执行之间的间隔为 100 毫秒左右。 Sentinel 的做法是， 记录上一次时间中断器执行时的时间， 并将它和这一次时间中断器执行的时间进行对比：</p>\n<p>1. 如果两次调用时间之间的差距为负值， 或者非常大（超过 2 秒钟）， 那么 Sentinel 进入 TILT 模式。</p>\n<p>2. 如果 Sentinel 已经进入 TILT 模式， 那么 Sentinel 延迟退出 TILT 模式的时间。</p>\n<p>当 Sentinel 进入 TILT 模式时， 它仍然会继续监视所有目标， 但是：</p>\n<p>1. 它不再执行任何操作，比如故障转移。</p>\n<p>2. 当有实例向这个 Sentinel 发送 SENTINEL is-master-down-by-addr 命令时， Sentinel 返回负值： 因为这个 Sentinel 所进行的下线判断已经不再准确。</p>\n<p>如果 TILT 可以正常维持 30 秒钟， 那么 Sentinel 退出 TILT 模式。</p></td>\n</tr>\n</tbody>\n</table>\n<h3>其他</h3>\n<p><a href=\"http://doc.redisfans.com/topic/cluster-tutorial.html\" target=\"_blank\">集群教程</a><br>\n<a href=\"http://doc.redisfans.com/topic/cluster-spec.html\" target=\"_blank\">Redis 集群规范</a></p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112024\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112024votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112024\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 8 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "post_url": "http://blog.jobbole.com/112024/", "tag_name": "IT技术，Redis，数据库", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2016/04/49961db8952e63d98b519b76a2daa5e2.png"], "url_object_id": "5bfa4b1834ca384be1a3a4a0e7c0811c"},
{"title": "开发团队面临的 3 大安全挑战", "creat_time": "2017-07-30", "praise_count": "1", "bookmark_count": 0, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文作者： <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/thoughtworkschina\">ThoughtWorks</a> 。未经作者许可，禁止转载！<br>欢迎加入伯乐在线 <a href=\"http://blog.jobbole.com/99322\" target=\"_blank\">专栏作者</a>。</div><p>应用安全不能只依靠防火墙，必须要在应用开发阶段采取适当的安全控制措施，使得应用在发布上线前就具备较好的安全性，避免人为失误造成安全隐患。</p>\n<p><img src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/07/1-security.jpg\" alt=\"\" width=\"1000\" height=\"414\"></p>\n<p>不少企业早就意识到了这一点，然而理想和现实之间还隔着几十个安全漏洞，尤其是那些采用敏捷或者精益开发模式的团队，在具体的实践过程中，几乎无可避免的会遭遇到下面几个挑战。</p>\n<h3>挑战1：一次性的安全检查无法匹配持续性的交付</h3>\n<p>为确保团队开发出来的应用具有足够的安全性，最常见的选择是对其进行全方位的安全渗透测试。无论这样的测试是由企业自己的安全团队执行，还是购买外部第三方服务，最终都会得到一份详细的安全报告，团队接下来需要做的就是基于这份报告所揭露的漏洞，对应用进行相应的调整，直到安全漏洞被修复为止。</p>\n<p>持续交付是敏捷、精益开发团队的核心能力之一，这意味着团队可以做到每周甚至任意时刻发布产品，持续性的从真实环境中获取市场反馈，然后基于这些反馈对产品进行调整。一个可以参考的案例是，早在2014年的时候，亚马逊平均每秒有一次以上的产品部署，每天如此。</p>\n<p>与此同时，安全渗透测试却没有这么高的“交付”速度。由于渗透测试的特殊性，虽然有大量的自动化漏洞扫描工具可以使用，但是一次全面、高质量的渗透测试依然需要人工参与，几天甚至一两周之后才能得到测试报告是普遍现象。</p>\n<p>那么问题来了，一方面开发团队持续性的每周都有新功能上线和旧功能调整，另一方面渗透测试却没办法在这么短的时间里完成，它只能是阶段性、或者定期性的进行，例如每个季度测试一次。</p>\n<p><img src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/07/2-develop-team-1024x614.jpg\" alt=\"\" width=\"700\" height=\"420\"></p>\n<p>这种情况下，开发团队该何去何从？如果要安全，那么就得等着做渗透测试，而且一旦发现安全漏洞还要花额外的时间去修复，产品发布必定会延期。如果要效率，那么就只能冒着风险发布，因为谁也不知道当前应用有没有安全漏洞，万一被黑客发现并且加以利用，后果不堪设想。</p>\n<p>问题的关键在于，开发团队是在持续的发布应用到生产环境，然而渗透测试却是个相当耗时的一次性活动，它没办法跟上这么快的交付速度。</p>\n<h3>挑战2：缺乏自动化、自助化的支持，安全实践落地难</h3>\n<p>开发团队其实明白安全对于应用而言至关重要，也知道在开发过程中就应当通过运用各种安全最佳实践来主动消除安全问题，把安全风险降至最低。不过现状却是，不少安全实践要么无法落地实施，要么有流于形式的倾向。</p>\n<p><strong>一个真实的案例</strong></p>\n<p><em>一个开发团队在做完业务需求梳理后，立即进入了开发阶段。安全团队虽然在项目启动时提出过安全要求，例如要求团队采用威胁建模活动，识别出应用面临的安全威胁，并制定应对措施。然而由于该项目交付压力大，时间紧任务重，再加上团队成员对于威胁建模并不熟悉，最后这个活动被一拖再拖，直到应用开发完毕进行上线前的审批时，才发现没有做威胁建模，而此刻为了能让应用按时上线，只好回过头来临时补一份威胁建模的文档，仅用于应付安全部门的要求。这种情况下，安全威胁根本得不到全面的分析和应对，风险由此而生。</em></p>\n<p>在项目前期的设计阶段是进行威胁识别的最佳时刻，开发团队只要在这时做一次威胁建模，就能识别出潜在的安全风险，并且在接下来的开发过程中采取适当的措施加以应对。但是开发团队却仿佛是懒癌晚期患者，硬是拖到上线前才把威胁建模补上，而此时它早已失去意义。</p>\n<p><img src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/07/3-useless-1024x683.jpg\" alt=\"\" width=\"700\" height=\"467\"></p>\n<p>为何开发团队一边认同安全的重要性，一边却又对安全实践如此怠慢呢？本质原因在于，某些安全实践需要大量人工参与，或者对人员安全技能有很高的要求，与此同时又缺乏自动化、自助化的支持，因此在开发团队看来，这些实践的采纳成本太高，在面临交付压力的情况下选择性的忽略，或者认认真真的走个形式，就成了再正常不过的结果。</p>\n<h3>挑战3：高耸的部门墙让开发和安全团队难以进行高效的协作</h3>\n<p>随着敏捷、精益开发模式的普及，再加上DevOps转型的助推，不少企业已经开始组建全功能开发团队，团队中各个角色有着共同的目标，相互协作以更高的效率交付应用。但是安全团队却依然隶属于一墙之隔的安全部门。</p>\n<p>别小看了这堵墙，说它是万恶之源有点太夸张，但它的存在确确实实阻碍了企业实现其业务价值最大化。墙的这边，开发团队竭尽所能的以最快的速度完成应用开发，以求尽快上线获取反馈；墙的另一边，安全团队只关心应用是否安全，至于是否急着上线，那不是他们关心的问题。但是他们都忽略了一个事实，那就是企业的成功需要两者共同高效的协作。</p>\n<h3>小结</h3>\n<p>敏捷、精益团队一方面要保持快速的交付速度，一方面还要提高应用的安全质量，看上去这是鱼和熊掌不可兼得的事情，然而事实上我们依然有办法解决这些挑战。</p>\n<p>开发团队可以通过自动化，显著降低安全实践的实施难度和成本，把一次性的安全检查转变为持续性的安全质量反馈。对于安全团队，也应当向着开发团队迈进一步，打通开发和安全部门之间的隔离，以更加紧密和高效协作的方式，共同确保应用具备更高的安全质量。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112007\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112007votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112007\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/thoughtworkschina\">ThoughtWorks</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/thoughtworkschina\">\r\n\t\t\t<img src=\"http://tp3.sinaimg.cn/1774908135/180/0/1\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            ThoughtWorks是一家全球IT咨询公司，追求卓越软件质量，致力于科技驱动商业变革。擅长构建定制化软件产品，帮助客户快速将概念转化为价值。同时为客户提供用户体验设计、技术战略咨询、组织转型等咨询服务。        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/thoughtworkschina\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/thoughtworkschina/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/thoughtworkschina/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 62</a> · <a title=\"我的网站\" target=\"_blank\" href=\"http://insights.thoughtworkers.org/\"><i class=\"fa fa-link\"></i></a> <a title=\"微博主页\" target=\"_blank\" href=\"http://weibo.com/thoughtworkschina\"><i class=\"fa fa-weibo\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "post_url": "http://blog.jobbole.com/112007/", "tag_name": "IT技术，安全，开发", "front_image_url": ["http://insights.thoughtworkers.org/wp-content/uploads/2017/07/1-security.jpg"], "url_object_id": "092a09180ce44fb76ec5789f381f96da"},
{"title": "MySQL 高性能表设计规范", "creat_time": "2017-07-30", "praise_count": "1", "bookmark_count": 4, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.jianshu.com/p/f797bbe11d76\">高广超</a>   </div><div>\n<div>\n<p>良好的逻辑设计和物理设计是高性能的基石， 应该根据系统将要执行的查询语句来设计schema, 这往往需要权衡各种因素。</p>\n<h2>一、选择优化的数据类型</h2>\n<p>MySQL支持的数据类型非常多， 选择正确的数据类型对于获得高性能至关重要。</p>\n<h4>更小的通常更好</h4>\n<p>更小的数据类型通常更快， 因为它们占用更少的磁盘、 内存和CPU缓存， 并且处理时需要的CPU周期也更少。</p>\n<h4>简单就好</h4>\n<p>简单数据类型的操作通常需要更少的CPU周期。 例如， 整型比字符操作代价更低， 因为字符集和校对规则（排序规则 ）使字符比较比整型比较更复杂。</p>\n<h4>尽量避免NULL</h4>\n<p>如果查询中包含可为NULL 的列， 对MySQL来说更难优化， 因为可为NULL 的列使得索引、 索引统计和值比较都更复杂。 可为NULL的列会使用更多的存储空间， 在MySQL里也需要特殊处理。 当可为NULL的列被索引时， 每个索引记录需要一个额外的字节， 在MyISAM里甚至还可能导致固定大小的索引（例如只有一个整数列的索引）变成可变大小的索引。<br>\n当然也有例外， 例如InnoDB 使用单独的位 (bit) 存储NULL值， 所以对于稀疏数据有很好的空间效率。</p>\n<h3>1.整数类型</h3>\n<p>有两种类型的数字：整数 (whole number) 和实数 (real number) 。 如果存储整数， 可以使用这几种整数类型：TINYINT, SMALLINT, MEDIUMINT, INT, BIGINT。分别使用8,16, 24, 32, 64位存储空间。</p>\n<p>整数类型有可选的 **UNSIGNED ** 属性，表示不允许负值，这大致可以使正数的上限提高一倍。 例如 TINYINT. UNSIGNED 可以存储的范围是 0 – 255, 而 TINYINT 的存储范围是 -128 -127 。</p>\n<p><strong>有符号和无符号类型使用相同的存储空间，并具有相同的性能</strong> ， 因此可以根据实际情况选择合适的类型。</p>\n<p>你的选择决定 MySQL 是怎么在内存和磁盘中保存数据的。 然而， 整数计算一般使用64 位的 BIGINT 整数， 即使在 32 位环境也是如此。（ 一些聚合函数是例外， 它们使用DECIMAL 或 DOUBLE 进行计算）。</p>\n<p>MySQL 可以为整数类型指定宽度， 例如 INT(11), 对大多数应用这是没有意义的：它不会限制值的合法范围，只是规定了MySQL 的一些交互工具（例如 MySQL 命令行客户端）用来显示字符的个数。 对于存储和计算来说， INT(1) 和 INT(20) 是相同的。</p>\n<h3>2.实数类型</h3>\n<p>实数是带有小数部分的数字。 然而， 它们不只是为了存储小数部分，也可以使用DECIMAL 存储比 BIGINT 还大的整数。</p>\n<p>FLOAT和DOUBLE类型支持使用标准的浮点运算进行近似计算。<br>\nDECIMAL类型用于存储精确的小数。<br>\n浮点和DECIMAL类型都可以指定精度。 对于DECIMAL列， 可以指定小数点前后所允许的最大位数。这会影响列的空间消耗。</p>\n<p>有多种方法可以指定浮点列所需要的精度， 这会使得MySQL选择不同的数据类型，或者在存储时对值进行取舍。 这些精度定义是非标准的，<strong>所以我们建议只指定数据类型，不指定精度。</strong></p>\n<p><strong>浮点类型在存储同样范围的值时， 通常比DECIMAL使用更少的空间。FLOAT使用4个字节存储。DOUBLE占用8个字节，相比FLOAT有更高的精度和更大的范围。和整数类型一样， 能选择的只是存储类型； MySQL使用DOUBLE作为内部浮点计算的类型。</strong></p>\n<p>因为需要额外的空间和计算开销，所以应该尽量只在对小数进行精确计算时才使用DECIMAL。<strong>但在数据最比较大的时候， 可以考虑使用BIGINT代替DECIMAL, 将需要存储的货币单位根据小数的位数乘以相应的倍数即可。</strong></p>\n<h3>3.字符串类型</h3>\n<h4>VARCHAR</h4>\n<p>用于存储可变⻓字符串，长度支持到65535<br>\n需要使用1或2个额外字节记录字符串的长度<br>\n适合：字符串的最大⻓度比平均⻓度⼤很多；更新很少</p>\n<h4>CHAR</h4>\n<p>定⻓，⻓度范围是1~255<br>\n适合：存储很短的字符串，或者所有值接近同一个长度；经常变更</p>\n<h4>慷慨是不明智的</h4>\n<p>使用VARCHAR(5)和VARCHAR(200)存储’hello’的空间开销是一样的。 那么使用更短的列有什么优势吗？</p>\n<p>事实证明有很大的优势。 更长的列会消耗更多的内存， 因为MySQL通常会分配固定大小的内存块来保存内部值。 尤其是使用内存临时表进行排序或操作时会特别糟糕。 在利用磁盘临时表进行排序时也同样糟糕。</p>\n<p>所以最好的策略是只分配真正需要的空间。</p>\n<h3>4.BLOB和TEXT类型</h3>\n<p>BLOB和 TEXT都是为存储很大的数据而设计的字符串数据类型， 分别采用 二进制和字符方式存储 。</p>\n<p>与其他类型不同， MySQL把每个BLOB和TEXT值当作一个独立的对象处理。 存储引擎在存储时通常会做特殊处理。 当BLOB和TEXT值太大时，InnoDB会使用专门的 “外部“存储区域来进行存储， 此时每个值在行内需要1 – 4个字节存储 存储区域存储实际的值。</p>\n<p>BLOB 和 TEXT 之间仅有的不同是 BLOB 类型存储的是二进制数据， 没有排序规则或字符集， 而 TEXT类型有字符集和排序规则</p>\n<h3>5.日期和时间类型</h3>\n<p>大部分时间类型都没有替代品， 因此没有什么是最佳选择的问题。 唯一的问题是保存日期和时间的时候需要做什么。 MySQL提供两种相似的日期类型： DATE TIME和 TIMESTAMP。</p>\n<p>但是目前我们更建议存储时间戳的方式，因此该处不再对 DATE TIME和 TIMESTAMP做过多说明。</p>\n<h3>5.其他类型</h3>\n<h4>5.1选择标识符</h4>\n<p>在可以满足值的范围的需求， 井且预留未来增长空间的前提下， 应该选择最小的数据类型。</p>\n<h5>整数类型</h5>\n<p>整数通常是标识列最好的选择， 因为它们很快并且可以使用AUTO_INCREMENT。</p>\n<h5>ENUM和SET类型</h5>\n<p>对于标识列来说，EMUM和SET类型通常是一个糟糕的选择， 尽管对某些只包含固定状态或者类型的静态 ”定义表” 来说可能是没有问题的。ENUM和SET列适合存储固定信息， 例如有序的状态、 产品类型、 人的性别。</p>\n<h5>字符串类型</h5>\n<p>如果可能， 应该避免使用字符串类型作为标识列， 因为它们很消耗空间， 并且通常比数字类型慢。</p>\n<p>对于完全 “随机” 的字符串也需要多加注意， 例如 MDS() 、 SHAl() 或者 UUID() 产生的字符串。 这些函数生成的新值会任意分布在很大的空间内， 这会导致 INSERT 以及一些SELECT语句变得很慢。如果存储 UUID 值， 则应该移除 “-“符号。</p>\n<h4>5.2特殊类型数据</h4>\n<p>某些类型的数据井不直接与内置类型一致。 低千秒级精度的时间戳就是一个例子，另一个例子是以个1Pv4地址，人们经常使用VARCHAR(15)列来存储IP地址，然而， 它们实际上是32位无符号整数， 不是字符串。用小数点将地址分成四段的表示方法只是为了让人们阅读容易。所以应该用无符号整数存储IP地址。MySQL提供INET_ATON()和INET_NTOA()函数在这两种表示方法之间转换。</p>\n<h2>二、表结构设计</h2>\n<h3>1.范式和反范式</h3>\n<p>对于任何给定的数据通常都有很多种表示方法， 从完全的范式化到完全的反范式化， 以及两者的折中。 在范式化的数据库中， 每个事实数据会出现并且只出现一次。 相反， 在反范式化的数据库中， 信息是冗余的， 可能会存储在多个地方。</p>\n<h4>范式的优点和缺点</h4>\n<p>为性能提升考虑时，经常会被建议对 schema 进行范式化设计，尤其是写密集的场景。</p>\n<ul>\n<li>范式化的更新操作通常比反范式化要快。</li>\n<li>当数据较好地范式化时，就只有很少或者没有重复数据，所以只需要修改更少的数据。</li>\n<li>范式化的表通常更小，可以更好地放在内存里，所以执行操作会更快。</li>\n<li>很少有多余的数据意味着检索列表数据时更少需要 DISTINCT 或者 GROUP BY语句。</li>\n</ul>\n<h4>反范式的优点和缺点</h4>\n<p>不需要关联表，则对大部分查询最差的情况——即使表没有使用索引——是全表扫描。 当数据比内存大时这可能比关联要快得多，因为这样避免了随机I/0。</p>\n<p>单独的表也能使用更有效的索引策略。</p>\n<h4>混用范式化和反范式化</h4>\n<p>在实际应用中经常需要混用，可能使用部分范式化的 schema 、 缓存表，以及其他技巧。<br>\n表适当增加冗余字段，如性能优先，但会增加复杂度。可避免表关联查询。</p>\n<h4>简单熟悉数据库范式</h4>\n</div>\n</div>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-597d9031d73fa474862588\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n第一范式(1NF)：字段值具有原子性,不能再分(所有关系型数据库系统都满足第一范式);\r\n 例如：姓名字段,其中姓和名是一个整体,如果区分姓和名那么必须设立两个独立字段;\r\n \r\n第二范式(2NF)：一个表必须有主键,即每行数据都能被唯一的区分;\r\n 备注：必须先满足第一范式;\r\n \r\n第三范式(3NF)：一个表中不能包涵其他相关表中非关键字段的信息,即数据表不能有沉余字段;\r\n 备注：必须先满足第二范式;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-597d9031d73fa474862588-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597d9031d73fa474862588-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-597d9031d73fa474862588-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597d9031d73fa474862588-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-597d9031d73fa474862588-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597d9031d73fa474862588-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-597d9031d73fa474862588-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597d9031d73fa474862588-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-597d9031d73fa474862588-1\">第一范式<span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1NF</span><span class=\"crayon-sy\">)</span>：字段值具有原子性<span class=\"crayon-sy\">,</span>不能再分<span class=\"crayon-sy\">(</span>所有关系型数据库系统都满足第一范式<span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597d9031d73fa474862588-2\"><span class=\"crayon-h\"> </span>例如：姓名字段<span class=\"crayon-sy\">,</span>其中姓和名是一个整体<span class=\"crayon-sy\">,</span>如果区分姓和名那么必须设立两个独立字段<span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-597d9031d73fa474862588-3\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597d9031d73fa474862588-4\">第二范式<span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2NF</span><span class=\"crayon-sy\">)</span>：一个表必须有主键<span class=\"crayon-sy\">,</span>即每行数据都能被唯一的区分<span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-597d9031d73fa474862588-5\"><span class=\"crayon-h\"> </span>备注：必须先满足第一范式<span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597d9031d73fa474862588-6\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-597d9031d73fa474862588-7\">第三范式<span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">3NF</span><span class=\"crayon-sy\">)</span>：一个表中不能包涵其他相关表中非关键字段的信息<span class=\"crayon-sy\">,</span>即数据表不能有沉余字段<span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597d9031d73fa474862588-8\"><span class=\"crayon-h\"> </span>备注：必须先满足第二范式<span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0019 seconds] -->\r\n<p></p>\n<div>\n<div>\n<h3>2.表字段少⽽精</h3>\n<ul>\n<li>I/O高效</li>\n<li>字段分开维护简单</li>\n<li>单表1G体积 500W⾏行评估</li>\n<li>单⾏行不超过200Byte</li>\n<li>单表不超过50个INT字段</li>\n<li>单表不超过20个CHAR(10)字段</li>\n<li>建议单表字段数控制在20个以内</li>\n<li>拆分TEXT/BLOB，TEXT类型处理性能远低于VARCHAR，强制生成硬盘临时表浪费更多空间。</li>\n</ul>\n<h4>参考资料：</h4>\n<p>高性能mysql第三版</p>\n</div>\n</div>\n<hr>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112035\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112035votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112035\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 4 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 2 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "post_url": "http://blog.jobbole.com/112035/", "tag_name": "IT技术，MySQL，数据库", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/11/dea4002e77dd3ecd398568bf746ea46c.png"], "url_object_id": "42ebcbade0688b35076d01309348c96f"},
{"title": "REST 的 6 个约束", "creat_time": "2017-07-30", "praise_count": "1", "bookmark_count": 1, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/yalishizhude\">亚里士朱德</a> 翻译。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://en.wikipedia.org/wiki/Representational_state_transfer#Client-server\">wikipedia</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>定义个一个 RESTful 系统的时候应该遵循 6 个约束。</p>\n<p>它们限制了服务端只能遵循这些约束来处理和响应客户端请求，但是遵循这些约束服务也可以获取理想的非函数化的属性，例如性能、可伸缩、简单程度、可变能力、可见度、灵活性、可信度。</p>\n<p>如果任何一个服务违背了其中一个原则，将不能被称作 RESTful 系统。</p>\n<p>标准的 REST 约束如下：</p>\n<h3 id=\"客户端-服务器\">客户端-服务器</h3>\n<p><em>参考内容：<a href=\"https://en.wikipedia.org/wiki/Client%E2%80%93server_model\" target=\"_blank\" rel=\"external\">客户端-服务器模型</a></em></p>\n<p>第一个约束是基于<strong>客户端-服务器</strong>架构背后的原则——关注点分离。通过分离用户界面和数据存储这两个关注点，提高了用户界面跨平台的可能性，通过简化服务器组件提高了其可伸缩性。这种分离对于Web来说更加重要的意义是，它使得组件能够进行独立修改和扩展，从而能够支持大量组织的网络化需求。</p>\n<h3 id=\"无状态\">无状态</h3>\n<p><em>参考内容：<a href=\"https://en.wikipedia.org/wiki/Stateless_protocol\" target=\"_blank\" rel=\"external\">无状态协议</a></em></p>\n<p>客户端-服务器通信的一个制约条件就是服务端无法存储客户端的上下文执行环境。从任何客户端发出的每个请求都包含了服务端所必要的信息，但是会话状态仍留在客户端。</p>\n<p>然而在服务端会话状态可以轻松实现跨服务调用，例如利用数据库做持久化来保存一段时间内的身份认证信息。客户端开始发送请求时，它已准备好过渡到一个新的状态。当一个或多个请求正在发送时，客户端处于过渡状态。每个应用程序状态的表示包含可在下一次客户端选择发起一个新的状态过渡使用的链接。</p>\n<h3 id=\"可缓存\">可缓存</h3>\n<p><em>参考内容：<a href=\"https://en.wikipedia.org/wiki/Web_cache\" target=\"_blank\" rel=\"external\">网页缓存</a></em></p>\n<p>互联网中的客户端和中间层服务器可以缓存响应。因此响应必须直接或间接定义自身是否可被缓存，以免客户端使用过期的响应数据来发送其它请求。良好的缓存策略可以有效减少客户端-服务器之间的交互，从而进一步提高系统的可伸缩性和性能。</p>\n<h3 id=\"分层系统\">分层系统</h3>\n<p><em>参考内容：<a href=\"https://en.wikipedia.org/w/index.php?title=Representational_state_transfer&amp;action=edit&amp;section=7\" target=\"_blank\" rel=\"external\">分层系统</a></em></p>\n<p>客户端通常无法判断它是否是直接连接到后端服务器，还是中间服务器。中间服务器可通过启用负载平衡，并通过提供共享高速缓存来提高系统的可扩展性。当然也可以强制执行安全政策。</p>\n<h3 id=\"按需代码（可选）\">按需代码（可选）</h3>\n<p><em>参考内容：<a href=\"https://en.wikipedia.org/wiki/Dynamic_web_page#Client-side_scripting\" target=\"_blank\" rel=\"external\">客户端脚本</a></em></p>\n<p>服务端可以通过传递可执行代码临时为客户端扩展或自定义功能。这方面的例子包括可编译的组件如Java applets和客户机端脚本如JavaScript。</p>\n<h3 id=\"统一的接口\">统一的接口</h3>\n<p>统一接口约束是设计任何REST服务的基础。它简化和解耦的架构，使得每个部分可以独立被修改。这个统一的接口包含了四个约束：</p>\n<h3 id=\"资源的标识\">资源的标识</h3>\n<p>各种资源都在请求中被确定，例如在使用URI的Web REST系统中，资源本身就表明它们想要被返回给客户端的格式。例如服务端可以从它的数据库发送HTML，XML或JSON格式的数据，即使这些都不是服务端的内部数据格式。</p>\n<h3 id=\"通过表述来操作资源\">通过表述来操作资源</h3>\n<p>当一个客户端持有一种资源的表述时，包括任何关联的元数据，它都有足够的信息来修改或删除该资源。</p>\n<h3 id=\"自描述的消息\">自描述的消息</h3>\n<p>每条信息都包含足够的信息来描述如何处理消息本身。例如，一个网络媒体类型本身就定义了能运行该媒体的解析器（以前被称为MIME类型）。</p>\n<h3 id=\"超媒体作为应用程序状态的引擎（HATEOAS）\">超媒体作为应用程序状态的引擎（HATEOAS）</h3>\n<p>已经初始化URI的REST客户端应用，应该就像人们访问了一个Web网站主页一样，能够使用服务器提供的动态链接，请求它所需的资源和进行所需的操作。</p>\n<p>处理客户端访问时，服务端将响应内容也包括当前可用的其它行为的超链接。没有必要对REST服务的结构或动态信息进行硬编码来响应客户端客户端。</p>\n\r\n        \r\n            <blockquote class=\"rewards\">\n        <p><strong>打赏支持我翻译更多好文章，谢谢！</strong></p>\n        <a href=\"#rewardbox\" id=\"rewards-button\" class=\"fancybox\"><span class=\"btn-bluet-blue href-style\"><i class=\"fa fa-jpy\"></i> 打赏译者</span></a>\n    </blockquote>\n\n    <div id=\"rewardbox\">\n        <h4>打赏支持我翻译更多好文章，谢谢！</h4>\n                <p>任选一种支付方式</p>\n                <p>\n                        <img src=\"http://www.jobbole.com/wp-content/uploads/2016/03/981844a17323ad7e3f25209b78bc671c1.jpg\">\n            \n                            <img src=\"http://www.jobbole.com/wp-content/uploads/2016/03/ccd097a7b57abdd91d882ff55cda32091.jpg\">\n                    </p>\n    </div>\n\n    \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112006\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112006votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112006\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/yalishizhude\">亚里士朱德</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/yalishizhude\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2017/06/4a4b7e0673565612b7c599e582face0c.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            JSP工程师，多年大型国际项目开发经验。WEB前端工程师，擅长PC端以及移动端开发。js全栈工程师，熟悉node.js、mongoDB。开发者头条top10专栏作者慕课网签约讲师个人博客：yalishizhude.github.io        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/yalishizhude\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/yalishizhude/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/yalishizhude/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 19</a> · <a title=\"我的网站\" target=\"_blank\" href=\"http://yalishizhude.github.io/\"><i class=\"fa fa-link\"></i></a> <a title=\"微博主页\" target=\"_blank\" href=\"http://weibo.com/arisjutle\"><i class=\"fa fa-weibo\"></i></a> <a title=\"QQ：381355576\" target=\"_blank\" href=\"#\"><i class=\"fa fa-qq\"></i></a> <a title=\"GitHub主页\" target=\"_blank\" href=\"https://github.com/yalishizhude\"><i class=\"fa fa-github\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "post_url": "http://blog.jobbole.com/112006/", "tag_name": "IT技术，API，Rest", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/08/544851c6c17d5b59f6fe22f223db85aa.png"], "url_object_id": "1e1a2c0afbf124146e1e745069e53328"}